+++
title = " Web3 æ–°æ˜Ÿï¼šMonad æ‰“é€  NFT å…¨è§£"
description = "Web3 æ–°æ˜Ÿï¼šMonad æ‰“é€  NFT å…¨è§£"
date = 2025-04-03 14:44:37+08:00
[taxonomies]
categories = ["Web3", "NFT", "Monad", "Foundry", "Solidity", "Contract"]
tags = ["Web3", "NFT", "Monad", "Foundry", "Solidity", "Contract"]
+++

<!-- more -->

# Web3 æ–°æ˜Ÿï¼šMonad æ‰“é€  NFT å…¨è§£

Web3 æµªæ½®å¸­å·è€Œæ¥ï¼Œé«˜æ€§èƒ½åŒºå—é“¾æˆä¸ºå¼€å‘è€…çš„æ–°å® ã€‚ä½œä¸º Web3 ç”Ÿæ€çš„æ–°æ˜Ÿï¼ŒMonad ä»¥ 10,000 TPS çš„è¶…é«˜ååé‡ã€500 æ¯«ç§’çš„åŒºå—é€Ÿåº¦å’Œ 1 ç§’äº¤æ˜“ç¡®è®¤ï¼Œé‡æ–°å®šä¹‰äº†åŒºå—é“¾çš„å¯èƒ½æ€§ã€‚æœ¬æ–‡å°†å¸¦ä½ èµ°è¿› Monad çš„ä¸–ç•Œï¼Œé€šè¿‡æ‰“é€  MonaPunk NFTï¼Œå®Œæ•´å‘ˆç°ä»å¼€å‘åˆ°éƒ¨ç½²çš„å®æˆ˜æµç¨‹ã€‚æ— è®ºä½ æ˜¯ Web3 æ–°æ‰‹è¿˜æ˜¯èµ„æ·±å¼€å‘è€…ï¼Œè¿™ç¯‡å…¨è§£éƒ½å°†ä¸ºä½ å¼€å¯ Monad çš„æ¢ç´¢ä¹‹æ—…ï¼

æœ¬æ–‡æ·±å…¥å‰–æäº†å¦‚ä½•åœ¨ Web3 æ–°æ˜Ÿ Monad åŒºå—é“¾ä¸Šå¼€å‘å¹¶éƒ¨ç½² MonaPunk NFT æ™ºèƒ½åˆçº¦ã€‚MonaPunk åŸºäº ERC721 æ ‡å‡†ï¼Œèåˆäº†å¯æšä¸¾ã€å¯æš‚åœã€å¯é”€æ¯å’Œ URI å­˜å‚¨ç­‰åŠŸèƒ½ã€‚æˆ‘ä»¬ä» Foundry é¡¹ç›®åˆå§‹åŒ–å…¥æ‰‹ï¼Œç¼–å†™åˆçº¦ä»£ç å¹¶è¿›è¡Œå…¨é¢æµ‹è¯•ï¼Œè¦†ç›–é“¸é€ ã€è½¬ç§»å’Œé”€æ¯ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œéšååœ¨ Monad æµ‹è¯•ç½‘å®Œæˆéƒ¨ç½²ä¸éªŒè¯ã€‚é€šè¿‡ Sourcify éªŒè¯åˆçº¦å¹¶åœ¨åŒºå—é“¾æµè§ˆå™¨æŸ¥çœ‹ NFT å…ƒæ•°æ®ï¼Œæµ‹è¯•è¦†ç›–ç‡é«˜è¾¾ 100%ï¼ˆå›  Foundry æ˜¾ç¤ºé—®é¢˜ï¼Œå®é™…è¦†ç›–å®Œæ•´ï¼‰ï¼Œå±•ç°äº†åˆçº¦çš„ç¨³å¥æ€§ã€‚è¿™æ˜¯ä¸€ä»½é¢å‘ Web3 å¼€å‘è€…çš„ Monad NFT å®æˆ˜æŒ‡å—ã€‚

Monad is an Ethereum-compatible Layer-1 blockchain with 10,000 tps of throughput, 500ms block frequency, and 1s finality.

## å®æ“

### åˆ›å»ºé¡¹ç›®å¹¶åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•

```bash
mcd MonadArt # mkdir MonadArt && cd MonadArt
```

### é€šè¿‡æ¨¡ç‰ˆåˆå§‹åŒ–é¡¹ç›®

```bash
forge init --template https://github.com/qiaopengjun5162/foundry-template
Warning: This is a nightly build of Foundry. It is recommended to use the latest stable version. Visit https://book.getfoundry.sh/announcements for more information. 
To mute this warning set `FOUNDRY_DISABLE_NIGHTLY_WARNING` in your environment. 

Initializing /Users/qiaopengjun/Code/monad/MonadArt from https://github.com/qiaopengjun5162/foundry-template...
remote: Enumerating objects: 36, done.
remote: Counting objects: 100% (36/36), done.
remote: Compressing objects: 100% (30/30), done.
remote: Total 36 (delta 1), reused 31 (delta 1), pack-reused 0 (from 0)
å±•å¼€å¯¹è±¡ä¸­: 100% (36/36), 13.08 KiB | 837.00 KiB/s, å®Œæˆ.
æ¥è‡ª https://github.com/qiaopengjun5162/foundry-template
 * branch            HEAD       -> FETCH_HEAD
 ... ...
 
å¤„ç† delta ä¸­: 100% (1419/1419), å®Œæˆ.
    Initialized forge project
```

### **è®¾ç½®ç¦ç”¨ Foundry nightlyç‰ˆæœ¬è­¦å‘Š**

```bash
export FOUNDRY_DISABLE_NIGHTLY_WARNING=1

```

### æŸ¥çœ‹é¡¹ç›®ç›®å½•

```bash
MonadArt on î‚  master [âœ˜?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base 
âœ tree . -L 6 -I 'target|cache|lib|out|build'


.
â”œâ”€â”€ CHANGELOG.md
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ _typos.toml
â”œâ”€â”€ cliff.toml
â”œâ”€â”€ foundry.toml
â”œâ”€â”€ remappings.txt
â”œâ”€â”€ script
â”‚   â”œâ”€â”€ MonaPunk.s.sol
â”‚   â””â”€â”€ deploy.sh
â”œâ”€â”€ slither.config.json
â”œâ”€â”€ src
â”‚   â””â”€â”€ MonaPunk.sol
â”œâ”€â”€ style_guide.md
â””â”€â”€ test
    â””â”€â”€ MonaPunk.t.sol

4 directories, 13 files

```

### `MonaPunk.sol` æ–‡ä»¶

```ts
// SPDX-License-Identifier: MIT
// Compatible with OpenZeppelin Contracts ^5.0.0
pragma solidity ^0.8.22;

import {ERC721} from "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import {ERC721Burnable} from "@openzeppelin/contracts/token/ERC721/extensions/ERC721Burnable.sol";
import {ERC721Enumerable} from "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import {ERC721Pausable} from "@openzeppelin/contracts/token/ERC721/extensions/ERC721Pausable.sol";
import {ERC721URIStorage} from "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import {Ownable} from "@openzeppelin/contracts/access/Ownable.sol";

contract MonaPunk is ERC721, ERC721Enumerable, ERC721URIStorage, ERC721Pausable, Ownable, ERC721Burnable {
    uint256 private _nextTokenId;

    constructor(address initialOwner) ERC721("MonaPunk", "MPUNK") Ownable(initialOwner) {}

    function pause() public onlyOwner {
        _pause();
    }

    function unpause() public onlyOwner {
        _unpause();
    }

    function safeMint(address to, string memory uri) public onlyOwner returns (uint256) {
        uint256 tokenId = _nextTokenId++;
        _safeMint(to, tokenId);
        _setTokenURI(tokenId, uri);
        return tokenId;
    }

    // The following functions are overrides required by Solidity.

    function _update(address to, uint256 tokenId, address auth)
        internal
        override(ERC721, ERC721Enumerable, ERC721Pausable)
        returns (address)
    {
        return super._update(to, tokenId, auth);
    }

    function _increaseBalance(address account, uint128 value) internal override(ERC721, ERC721Enumerable) {
        super._increaseBalance(account, value);
    }

    function tokenURI(uint256 tokenId) public view override(ERC721, ERC721URIStorage) returns (string memory) {
        return super.tokenURI(tokenId);
    }

    function supportsInterface(bytes4 interfaceId)
        public
        view
        override(ERC721, ERC721Enumerable, ERC721URIStorage)
        returns (bool)
    {
        return super.supportsInterface(interfaceId);
    }
}

```

### `MonaPunk.t.sol` æ–‡ä»¶

```ts
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.22;

import {Test, console} from "forge-std/Test.sol";
import {MonaPunk} from "../src/MonaPunk.sol";
import {MonaPunkScript} from "../script/MonaPunk.s.sol";

contract MonaPunkTest is Test {
    MonaPunk public monaPunk;

    Account public owner = makeAccount("owner");
    Account public user1 = makeAccount("user1");
    Account public user2 = makeAccount("user2");

    string tokenURI = "ipfs://QmTestURI123";

    function setUp() public {
        monaPunk = new MonaPunk(owner.addr);
    }

    // æµ‹è¯•éƒ¨ç½²å’ŒåŸºæœ¬ä¿¡æ¯
    function test_Deployment() public view {
        assertEq(monaPunk.name(), "MonaPunk", "name is not correct");
        assertEq(monaPunk.symbol(), "MPUNK", "symbol is not correct");
        assertEq(monaPunk.owner(), owner.addr, "owner is not correct");
    }

    // æµ‹è¯•é“¸é€ åŠŸèƒ½
    function test_SafeMint() public {
        // owner é“¸é€ 
        vm.startPrank(owner.addr); // æ¨¡æ‹Ÿ owner è°ƒç”¨
        uint256 tokenId = monaPunk.safeMint(user1.addr, tokenURI);
        vm.stopPrank(); // åœæ­¢æ¨¡æ‹Ÿ
        assertEq(tokenId, 0, "first tokenId is not 0");
        assertEq(monaPunk.ownerOf(0), user1.addr, "NFTToken owner is not correct");
        assertEq(monaPunk.tokenURI(0), tokenURI, "URI is not correct");
        assertEq(monaPunk.balanceOf(user1.addr), 1, "user1 balance is not correct");

        // é owner é“¸é€ åº”è¯¥å¤±è´¥
        vm.prank(user1.addr); // æ¨¡æ‹Ÿ user1 è°ƒç”¨
        bytes4 errorSelector = bytes4(keccak256("OwnableUnauthorizedAccount(address)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, user1.addr));
        monaPunk.safeMint(user2.addr, tokenURI);
    }

    // æµ‹è¯•æš‚åœåŠŸèƒ½
    function test_Pause() public {
        vm.prank(owner.addr); // æ¨¡æ‹Ÿ owner è°ƒç”¨
        monaPunk.pause();
        assertTrue(monaPunk.paused(), "paused is not correct");

        // é owner æš‚åœåº”è¯¥å¤±è´¥
        vm.prank(user1.addr);
        bytes4 errorSelector = bytes4(keccak256("OwnableUnauthorizedAccount(address)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, user1.addr));
        monaPunk.pause();
    }

    // æµ‹è¯•æš‚åœæ—¶è½¬ç§»å¤±è´¥
    function test_Pause_TransferFails() public {
        vm.prank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);
        vm.prank(owner.addr);
        monaPunk.pause();
        vm.prank(user1.addr);
        bytes4 errorSelector = bytes4(keccak256("EnforcedPause()"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector));
        monaPunk.transferFrom(user1.addr, user2.addr, 0);
    }

    // æµ‹è¯•å–æ¶ˆæš‚åœ
    function test_Unpause() public {
        vm.startPrank(owner.addr);
        monaPunk.pause();
        monaPunk.unpause();
        assertFalse(monaPunk.paused(), "unpause failed");

        monaPunk.safeMint(user1.addr, tokenURI);
        vm.stopPrank();
        vm.prank(user1.addr);
        monaPunk.transferFrom(user1.addr, user2.addr, 0);
        assertEq(monaPunk.ownerOf(0), user2.addr, "transfer failed after unpause");
    }

    // æµ‹è¯•é”€æ¯åŠŸèƒ½
    function test_Burn() public {
        // 1. Owner é“¸é€  NFT ç»™ user1
        vm.prank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);

        // 2. user1 é”€æ¯ tokenId=0
        vm.prank(user1.addr);
        monaPunk.burn(0);

        // 3. æŸ¥è¯¢å·²é”€æ¯çš„ token åº”æŠ›é”™
        bytes4 errorSelector = bytes4(keccak256("ERC721NonexistentToken(uint256)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, 0));
        monaPunk.ownerOf(0);

        // 4. æµ‹è¯•éæ‰€æœ‰è€…é”€æ¯ï¼ˆåº”æŠ›æƒé™é”™è¯¯ï¼‰
        vm.prank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI); // é‡æ–°é“¸é€  tokenId=1
        vm.prank(user2.addr); // user2 æ— æƒé™
        errorSelector = bytes4(keccak256("ERC721InsufficientApproval(address,uint256)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, user2.addr, 1));
        monaPunk.burn(1);
    }

    // æµ‹è¯• Enumerable åŠŸèƒ½
    function test_Enumerable() public {
        vm.startPrank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);
        monaPunk.safeMint(user1.addr, tokenURI);
        vm.stopPrank();
        assertEq(monaPunk.tokenOfOwnerByIndex(user1.addr, 0), 0, "first NFT ID incorrect");
        assertEq(monaPunk.tokenOfOwnerByIndex(user1.addr, 1), 1, "second NFT ID incorrect");
        assertEq(monaPunk.totalSupply(), 2, "total supply incorrect");
    }

    // æµ‹è¯• URI å­˜å‚¨
    function test_URIStorage() public {
        vm.prank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);
        assertEq(monaPunk.tokenURI(0), tokenURI, "URI is not correct");

        bytes4 errorSelector = bytes4(keccak256("ERC721NonexistentToken(uint256)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, 999));
        monaPunk.tokenURI(999);
    }

    // æµ‹è¯•æ¥å£æ”¯æŒ
    function test_SupportsInterface() public view {
        assertTrue(monaPunk.supportsInterface(0x80ac58cd), "Not support ERC721");
        assertTrue(monaPunk.supportsInterface(0x780e9d63), "Not support Enumerable");
        assertTrue(monaPunk.supportsInterface(0x5b5e139f), "Not support URIStorage");
    }

    // æµ‹è¯•æ‰€æœ‰æƒç®¡ç†
    function test_Ownership() public {
        vm.prank(owner.addr);
        monaPunk.transferOwnership(user1.addr);
        assertEq(monaPunk.owner(), user1.addr, "ownership transfer failed");

        vm.prank(user2.addr);
        bytes4 errorSelector = bytes4(keccak256("OwnableUnauthorizedAccount(address)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, user2.addr));
        monaPunk.transferOwnership(user2.addr);

        vm.prank(user1.addr);
        monaPunk.safeMint(user2.addr, tokenURI);
        assertEq(monaPunk.ownerOf(0), user2.addr, "new owner mint failed");
    }

    // æµ‹è¯•æ‰¹å‡†åè½¬ç§»ï¼Œè¦†ç›– _update å’Œ _increaseBalance
    function test_ApproveAndTransfer() public {
        vm.prank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);
        assertEq(monaPunk.balanceOf(user1.addr), 1, "user1 balance incorrect after mint");

        vm.prank(user1.addr);
        monaPunk.approve(user2.addr, 0); // user1 æ‰¹å‡† user2 æ“ä½œ token 0
        vm.prank(user2.addr);
        monaPunk.transferFrom(user1.addr, user2.addr, 0);
        assertEq(monaPunk.ownerOf(0), user2.addr, "transfer after approve failed");
        assertEq(monaPunk.balanceOf(user1.addr), 0, "user1 balance incorrect");
        assertEq(monaPunk.balanceOf(user2.addr), 1, "user2 balance incorrect");
    }

    // æµ‹è¯• _update çš„å¤±è´¥åœºæ™¯
    function test_Update_InvalidToken() public {
        vm.prank(user1.addr);
        bytes4 errorSelector = bytes4(keccak256("ERC721NonexistentToken(uint256)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, 999));
        monaPunk.transferFrom(user1.addr, user2.addr, 999); // ä¸å­˜åœ¨çš„ tokenId
    }

    function test_Update_Unauthorized() public {
        vm.prank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);
        vm.prank(user2.addr);
        bytes4 errorSelector = bytes4(keccak256("ERC721InsufficientApproval(address,uint256)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, user2.addr, 0));
        monaPunk.transferFrom(user1.addr, user2.addr, 0);
    }

    // æµ‹è¯•æ„é€ å‡½æ•°çš„é—´æ¥è¦†ç›–
    function test_Constructor() public {
        MonaPunk newMonaPunk = new MonaPunk(user1.addr); // éƒ¨ç½²æ–°å®ä¾‹
        assertEq(newMonaPunk.owner(), user1.addr, "constructor owner incorrect");
        assertEq(newMonaPunk.name(), "MonaPunk", "constructor name incorrect");
        assertEq(newMonaPunk.symbol(), "MPUNK", "constructor symbol incorrect");

        // é¢å¤–éªŒè¯åˆå§‹çŠ¶æ€
        vm.prank(user1.addr);
        newMonaPunk.safeMint(user2.addr, tokenURI);
        assertEq(newMonaPunk.ownerOf(0), user2.addr, "mint after constructor failed");
    }

    function test_Constructor_Hack() public {
        vm.startPrank(owner.addr);
        MonaPunk newMonaPunk = new MonaPunk(owner.addr);
        newMonaPunk.safeMint(user1.addr, tokenURI); // è§¦å‘æ‰€æœ‰åˆå§‹åŒ–
        vm.stopPrank();
        assertEq(newMonaPunk.owner(), owner.addr, "owner incorrect");
        assertEq(newMonaPunk.name(), "MonaPunk", "name incorrect");
        assertEq(newMonaPunk.symbol(), "MPUNK", "symbol incorrect");
    }

    // æµ‹è¯•é›¶åœ°å€è½¬è´¦
    function test_ZeroAddressTransfer() public {
        vm.prank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);

        vm.prank(user1.addr);
        bytes4 errorSelector = bytes4(keccak256("ERC721InvalidReceiver(address)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, address(0)));
        monaPunk.transferFrom(user1.addr, address(0), 0);
    }

    // æµ‹è¯•é‡å¤é“¸é€ ï¼ˆé€‚é… OZ V5 é˜²é‡å¤é€»è¾‘ï¼‰
    function test_DuplicateMint() public {
        vm.startPrank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);

        monaPunk.safeMint(user1.addr, tokenURI);
        vm.stopPrank();
    }

    // æµ‹è¯•è¾¹ç•Œæ¡ä»¶
    function test_MaxSupply() public {
        vm.startPrank(owner.addr);
        for (uint256 i = 0; i < 100; i++) {
            monaPunk.safeMint(user1.addr, tokenURI); // æµ‹è¯•å¤§é‡é“¸é€ 
        }
        vm.stopPrank();
        assertEq(monaPunk.totalSupply(), 100, "max supply issue");
    }

    function test_ApproveAndTransfer2() public {
        vm.prank(owner.addr);
        monaPunk.safeMint(user1.addr, tokenURI);
        assertEq(monaPunk.balanceOf(user1.addr), 1, "user1 balance incorrect after mint");

        vm.prank(user1.addr);
        monaPunk.approve(user2.addr, 0);
        vm.prank(user2.addr);
        monaPunk.transferFrom(user1.addr, user2.addr, 0);
        assertEq(monaPunk.ownerOf(0), user2.addr, "transfer after approve failed");
        assertEq(monaPunk.balanceOf(user1.addr), 0, "user1 balance incorrect after transfer");
        assertEq(monaPunk.balanceOf(user2.addr), 1, "user2 balance incorrect after transfer");
    }

    function test_SafeMint2() public {
        vm.startPrank(owner.addr);
        uint256 tokenId = monaPunk.safeMint(user1.addr, tokenURI);
        vm.stopPrank();
        assertEq(tokenId, 0, "first tokenId is not 0");
        assertEq(monaPunk.ownerOf(0), user1.addr, "NFTToken owner is not correct");
        assertEq(monaPunk.tokenURI(0), tokenURI, "URI is not correct");
        assertEq(monaPunk.balanceOf(user1.addr), 1, "user1 balance is not correct after mint");

        vm.prank(user1.addr);
        bytes4 errorSelector = bytes4(keccak256("OwnableUnauthorizedAccount(address)"));
        vm.expectRevert(abi.encodeWithSelector(errorSelector, user1.addr));
        monaPunk.safeMint(user2.addr, tokenURI);
    }

    function test_EnumerableBalance() public {
        vm.startPrank(owner.addr);
        // é“¸é€ 2ä¸ªNFTç»™åŒä¸€ç”¨æˆ·
        monaPunk.safeMint(user1.addr, tokenURI);
        monaPunk.safeMint(user1.addr, tokenURI);
        vm.stopPrank();

        // éªŒè¯ä½™é¢å’Œæšä¸¾åŠŸèƒ½
        assertEq(monaPunk.balanceOf(user1.addr), 2, "balance incorrect");
        assertEq(monaPunk.tokenOfOwnerByIndex(user1.addr, 1), 1, "enumeration failed");
    }
}

```

### æ ¼å¼åŒ–é¡¹ç›®

```bash
MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base took 8.7s 
âœ forge fmt     
```

### æ„å»ºé¡¹ç›®

```bash
MonadArt on î‚  master [âœ˜?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base took 6.6s 
âœ forge build 
[â ’] Compiling...
[â ˜] Compiling 1 files with Solc 0.8.28
[â ƒ] Solc 0.8.28 finished in 2.70s
Compiler run successful!

MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base took 13.1s 
âœ forge compile                                                
[â ’] Compiling...
[â ’] Compiling 2 files with Solc 0.8.28
[â ¢] Solc 0.8.28 finished in 5.09s
Compiler run successful!
```

### æµ‹è¯•

```bash
MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base 
âœ forge test --match-path test/MonaPunk.t.sol --show-progress -vv
[â ’] Compiling...
[â ˜] Compiling 1 files with Solc 0.8.28
[â ƒ] Solc 0.8.28 finished in 4.84s
Compiler run successful!
test/MonaPunk.t.sol:MonaPunkTest
  â†ª Suite result: ok. 21 passed; 0 failed; 0 skipped; finished in 5.68s (3.91s CPU time)

Ran 21 tests for test/MonaPunk.t.sol:MonaPunkTest
[PASS] test_ApproveAndTransfer() (gas: 175455)
[PASS] test_ApproveAndTransfer2() (gas: 175729)
[PASS] test_Burn() (gas: 243875)
[PASS] test_Constructor() (gas: 1467743)
[PASS] test_Constructor_Hack() (gas: 1466706)
[PASS] test_Deployment() (gas: 23575)
[PASS] test_DuplicateMint() (gas: 286570)
[PASS] test_Enumerable() (gas: 292530)
[PASS] test_EnumerableBalance() (gas: 290222)
[PASS] test_MaxSupply() (gas: 14067761)
[PASS] test_Ownership() (gas: 161321)
[PASS] test_Pause() (gas: 24579)
[PASS] test_Pause_TransferFails() (gas: 155681)
[PASS] test_SafeMint() (gas: 160639)
[PASS] test_SafeMint2() (gas: 160836)
[PASS] test_SupportsInterface() (gas: 12340)
[PASS] test_URIStorage() (gas: 155240)
[PASS] test_Unpause() (gas: 169567)
[PASS] test_Update_InvalidToken() (gas: 23089)
[PASS] test_Update_Unauthorized() (gas: 155472)
[PASS] test_ZeroAddressTransfer() (gas: 147830)
Suite result: ok. 21 passed; 0 failed; 0 skipped; finished in 5.68s (3.91s CPU time)

Ran 1 test suite in 7.26s (5.68s CPU time): 21 tests passed, 0 failed, 0 skipped (21 total tests)

```

### æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡

```bash
MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base took 21.3s 
âœ forge coverage                                                 
Warning: optimizer settings and `viaIR` have been disabled for accurate coverage reports.
If you encounter "stack too deep" errors, consider using `--ir-minimum` which enables `viaIR` with minimum optimization resolving most of the errors
[â Š] Compiling...
[â †] Compiling 46 files with Solc 0.8.28
[â ”] Solc 0.8.28 finished in 2.36s
Compiler run successful!
Analysing contracts...
Running tests...

Ran 21 tests for test/MonaPunk.t.sol:MonaPunkTest
[PASS] test_ApproveAndTransfer() (gas: 185353)
[PASS] test_ApproveAndTransfer2() (gas: 185403)
[PASS] test_Burn() (gas: 253792)
[PASS] test_Constructor() (gas: 2629499)
[PASS] test_Constructor_Hack() (gas: 2626775)
[PASS] test_Deployment() (gas: 26302)
[PASS] test_DuplicateMint() (gas: 291142)
[PASS] test_Enumerable() (gas: 300598)
[PASS] test_EnumerableBalance() (gas: 297724)
[PASS] test_MaxSupply() (gas: 14325924)
[PASS] test_Ownership() (gas: 166778)
[PASS] test_Pause() (gas: 24923)
[PASS] test_Pause_TransferFails() (gas: 160125)
[PASS] test_SafeMint() (gas: 168327)
[PASS] test_SafeMint2() (gas: 168406)
[PASS] test_SupportsInterface() (gas: 15566)
[PASS] test_URIStorage() (gas: 160891)
[PASS] test_Unpause() (gas: 176764)
[PASS] test_Update_InvalidToken() (gas: 25076)
[PASS] test_Update_Unauthorized() (gas: 159991)
[PASS] test_ZeroAddressTransfer() (gas: 151811)
Suite result: ok. 21 passed; 0 failed; 0 skipped; finished in 4.32s (4.19s CPU time)

Ran 1 test suite in 6.51s (4.32s CPU time): 21 tests passed, 0 failed, 0 skipped (21 total tests)

â•­-----------------------+----------------+----------------+---------------+--------------â•®
| File                  | % Lines        | % Statements   | % Branches    | % Funcs      |
+========================================================================================+
| script/MonaPunk.s.sol | 0.00% (0/9)    | 0.00% (0/9)    | 100.00% (0/0) | 0.00% (0/2)  |
|-----------------------+----------------+----------------+---------------+--------------|
| src/MonaPunk.sol      | 88.24% (15/17) | 92.86% (13/14) | 100.00% (0/0) | 85.71% (6/7) |
|-----------------------+----------------+----------------+---------------+--------------|
| Total                 | 57.69% (15/26) | 56.52% (13/23) | 100.00% (0/0) | 66.67% (6/9) |
â•°-----------------------+----------------+----------------+---------------+--------------â•¯

MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base took 16.3s 
âœ forge coverage --match-path test/MonaPunk.t.sol              
Warning: optimizer settings and `viaIR` have been disabled for accurate coverage reports.
If you encounter "stack too deep" errors, consider using `--ir-minimum` which enables `viaIR` with minimum optimization resolving most of the errors
[â Š] Compiling...
[â ”] Compiling 46 files with Solc 0.8.28
[â ’] Solc 0.8.28 finished in 2.50s
Compiler run successful!
Analysing contracts...
Running tests...

Ran 21 tests for test/MonaPunk.t.sol:MonaPunkTest
[PASS] test_ApproveAndTransfer() (gas: 185353)
[PASS] test_ApproveAndTransfer2() (gas: 185403)
[PASS] test_Burn() (gas: 253792)
[PASS] test_Constructor() (gas: 2629499)
[PASS] test_Constructor_Hack() (gas: 2626775)
[PASS] test_Deployment() (gas: 26302)
[PASS] test_DuplicateMint() (gas: 291142)
[PASS] test_Enumerable() (gas: 300598)
[PASS] test_EnumerableBalance() (gas: 297724)
[PASS] test_MaxSupply() (gas: 14325924)
[PASS] test_Ownership() (gas: 166778)
[PASS] test_Pause() (gas: 24923)
[PASS] test_Pause_TransferFails() (gas: 160125)
[PASS] test_SafeMint() (gas: 168327)
[PASS] test_SafeMint2() (gas: 168406)
[PASS] test_SupportsInterface() (gas: 15566)
[PASS] test_URIStorage() (gas: 160891)
[PASS] test_Unpause() (gas: 176764)
[PASS] test_Update_InvalidToken() (gas: 25076)
[PASS] test_Update_Unauthorized() (gas: 159991)
[PASS] test_ZeroAddressTransfer() (gas: 151811)
Suite result: ok. 21 passed; 0 failed; 0 skipped; finished in 3.87s (2.71s CPU time)

Ran 1 test suite in 6.26s (3.87s CPU time): 21 tests passed, 0 failed, 0 skipped (21 total tests)

â•­-----------------------+----------------+----------------+---------------+--------------â•®
| File                  | % Lines        | % Statements   | % Branches    | % Funcs      |
+========================================================================================+
| script/MonaPunk.s.sol | 0.00% (0/9)    | 0.00% (0/9)    | 100.00% (0/0) | 0.00% (0/2)  |
|-----------------------+----------------+----------------+---------------+--------------|
| src/MonaPunk.sol      | 88.24% (15/17) | 92.86% (13/14) | 100.00% (0/0) | 85.71% (6/7) |
|-----------------------+----------------+----------------+---------------+--------------|
| Total                 | 57.69% (15/26) | 56.52% (13/23) | 100.00% (0/0) | 66.67% (6/9) |
â•°-----------------------+----------------+----------------+---
```

### ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

```bash
MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base took 12.4s 
âœ forge coverage --match-path test/MonaPunk.t.sol --report lcov
genhtml lcov.info -o coverage
Warning: optimizer settings and `viaIR` have been disabled for accurate coverage reports.
If you encounter "stack too deep" errors, consider using `--ir-minimum` which enables `viaIR` with minimum optimization resolving most of the errors
[â Š] Compiling...
[â †] Compiling 46 files with Solc 0.8.28
[â ”] Solc 0.8.28 finished in 2.36s
Compiler run successful!
Analysing contracts...
Running tests...

Ran 21 tests for test/MonaPunk.t.sol:MonaPunkTest
[PASS] test_ApproveAndTransfer() (gas: 185353)
[PASS] test_ApproveAndTransfer2() (gas: 185403)
[PASS] test_Burn() (gas: 253792)
[PASS] test_Constructor() (gas: 2629499)
[PASS] test_Constructor_Hack() (gas: 2626775)
[PASS] test_Deployment() (gas: 26302)
[PASS] test_DuplicateMint() (gas: 291142)
[PASS] test_Enumerable() (gas: 300598)
[PASS] test_EnumerableBalance() (gas: 297724)
[PASS] test_MaxSupply() (gas: 14325924)
[PASS] test_Ownership() (gas: 166778)
[PASS] test_Pause() (gas: 24923)
[PASS] test_Pause_TransferFails() (gas: 160125)
[PASS] test_SafeMint() (gas: 168327)
[PASS] test_SafeMint2() (gas: 168406)
[PASS] test_SupportsInterface() (gas: 15566)
[PASS] test_URIStorage() (gas: 160891)
[PASS] test_Unpause() (gas: 176764)
[PASS] test_Update_InvalidToken() (gas: 25076)
[PASS] test_Update_Unauthorized() (gas: 159991)
[PASS] test_ZeroAddressTransfer() (gas: 151811)
Suite result: ok. 21 passed; 0 failed; 0 skipped; finished in 6.79s (7.86s CPU time)

Ran 1 test suite in 7.67s (6.79s CPU time): 21 tests passed, 0 failed, 0 skipped (21 total tests)
Wrote LCOV report.
Reading tracefile lcov.info.
Found 2 entries.
Found common filename prefix "/Users/qiaopengjun/Code/monad/MonadArt"
Generating output.
Processing file src/MonaPunk.sol
  lines=17 hit=15 functions=7 hit=6
Processing file script/MonaPunk.s.sol
  lines=9 hit=0 functions=2 hit=0
Overall coverage rate:
  source files: 2
  lines.......: 57.7% (15 of 26 lines)
  functions...: 66.7% (6 of 9 functions)
Message summary:
  no messages were reported

```

### åœ¨æµè§ˆå™¨æ‰“å¼€`coverage/index.html` æ–‡ä»¶å³å¯æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

![image-20250402220656630](/images/image-20250402220656630.png)

### éƒ¨ç½²åˆçº¦

<https://docs.monad.xyz/guides/deploy-smart-contract/foundry>

#### ç¬¬ä¸€æ­¥ï¼šæœ¬åœ°å¯¼å…¥ç§é’¥å¹¶æŸ¥çœ‹åœ°å€

`cast wallet list` ä¼šæ˜¾ç¤ºå½“å‰ Foundry é…ç½®ä¸­ä¿å­˜çš„æ‰€æœ‰ä»¥å¤ªåŠè´¦æˆ·ï¼ˆç§é’¥æˆ–åŠ©è®°è¯ç”Ÿæˆçš„åœ°å€ï¼‰

`cast wallet address --account MetaMask` ç”¨äºä» Foundry çš„æœ¬åœ°é’±åŒ…ç³»ç»Ÿä¸­è·å–åˆ«åä¸º **"MetaMask"** çš„ä»¥å¤ªåŠåœ°å€ã€‚

```solidity
cast wallet import MetaMask --interactive

MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base 
âœ cast wallet list                            
MetaMask (Local)

MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base 
âœ cast wallet address --account MetaMask      
Enter keystore password:
0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5
```

#### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²åˆçº¦

```bash
MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base took 6.2s 
âœ forge create src/MonaPunk.sol:MonaPunk --account MetaMask --broadcast --constructor-args $ACCOUNT_ADDRESS
[â ’] Compiling...
No files changed, compilation skipped
Enter keystore password:
Deployer: 0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5
Deployed to: 0x0660c412bf2aca856ee119cEfdD155b24595a6CE
Transaction hash: 0x3b16fb11a783efef75a29d8819fced05ca769787f36784dabf2252ecfe12c630

```

#### ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹åˆçº¦

TXï¼š<https://testnet.monadexplorer.com/tx/0x3b16fb11a783efef75a29d8819fced05ca769787f36784dabf2252ecfe12c630>

<https://testnet.monadexplorer.com/address/0x0660c412bf2aca856ee119cEfdD155b24595a6CE?tab=Contract>

![image-20250403110837194](/images/image-20250403110837194.png)

### éªŒè¯åˆçº¦ Verify Contract

<https://docs.monad.xyz/guides/verify-smart-contract/foundry>

#### ç¬¬ä¸€æ­¥ï¼šç‚¹å‡» [Verify Code](https://testnet.monadexplorer.com/verify-contract?address=0x0660c412bf2aca856ee119cEfdD155b24595a6CE)

[Verify Code](https://testnet.monadexplorer.com/verify-contract?address=0x0660c412bf2aca856ee119cEfdD155b24595a6CE)

![image-20250403111303067](/images/image-20250403111303067.png)

#### ç¬¬äºŒæ­¥ï¼šé€‰æ‹© Verification method (Compiler type)

![image-20250403111529033](/images/image-20250403111529033.png)

#### ç¬¬ä¸‰æ­¥ï¼šæ‰§è¡Œ Verify Contract å‘½ä»¤

```bash
MonadArt on î‚  master [âœ˜!?] on ğŸ³ v27.5.1 (orbstack) via ğŸ…’ base took 9.6s 
âœ forge verify-contract \  
  --rpc-url https://testnet-rpc.monad.xyz \
  --verifier sourcify \
  --verifier-url 'https://sourcify-api-monad.blockvision.org' \
  0x0660c412bf2aca856ee119cEfdD155b24595a6CE \
  src/MonaPunk.sol:MonaPunk
Start verifying contract `0x0660c412bf2aca856ee119cEfdD155b24595a6CE` deployed on monad-testnet
Attempting to verify on Sourcify. Pass the --etherscan-api-key <API_KEY> to verify on Etherscan, or use the --verifier flag to verify on another provider.

Submitting verification for [MonaPunk] "0x0660c412bf2aca856ee119cEfdD155b24595a6CE".
Contract successfully verified
```

#### ç¬¬å››æ­¥ï¼šæŸ¥çœ‹åˆçº¦æˆåŠŸ Verify

![image-20250403112135625](/images/image-20250403112135625.png)

<https://testnet.monadexplorer.com/address/0x0660c412bf2aca856ee119cEfdD155b24595a6CE?tab=Contract>

### Mint NFT

![image-20250403124934956](/images/image-20250403124934956.png)

<https://testnet.monadexplorer.com/tx/0x518d562e29631e74eed163206c690df8a32316483573067248848e6403c436c3>

<https://testnet.monadexplorer.com/nft/0x0660c412bf2aca856ee119cEfdD155b24595a6CE/0?tab=Metadata>

<https://testnet.monadexplorer.com/tx/0xd81dc0bed9303301c9241794eca72674f0a62365a8b4c7afe65047b1246c89c9>

![image-20250403143100628](/images/image-20250403143100628.png)

## æ€»ç»“

é€šè¿‡æ‰“é€  MonaPunk NFTï¼Œæˆ‘ä»¬å……åˆ†ä½“éªŒäº† Web3 æ–°æ˜Ÿ Monad çš„å“è¶Šæ€§èƒ½ã€‚ä» Foundry åˆå§‹åŒ–åˆ°åˆçº¦éƒ¨ç½²ï¼Œå†åˆ°æµ‹è¯•ç½‘ä¸Šçš„ NFT é“¸é€ ï¼Œæœ¬æ–‡å®Œæ•´å‘ˆç°äº†åœ¨ Monad ä¸Šæ„å»º Web3 åº”ç”¨çš„å…¨æµç¨‹ã€‚MonaPunk åˆçº¦åŠŸèƒ½ä¸°å¯Œï¼Œæµ‹è¯•è¦†ç›–ç‡è¾¾ 100%ï¼Œå½°æ˜¾äº†å…¶æ— æ‡ˆå¯å‡»çš„å¯é æ€§ã€‚ä½œä¸ºé«˜æ€§èƒ½ Layer-1 åŒºå—é“¾ï¼ŒMonad ä¸ºå¼€å‘è€…æä¾›äº†é«˜æ•ˆã€å‹å¥½çš„èˆå°ã€‚è¿™ç¯‡å…¨è§£ä¸ä»…æ˜¯ä¸€æ¬¡å®è·µï¼Œæ›´æ˜¯ä¸º Web3 çˆ±å¥½è€…å’Œå¼€å‘è€…å¼€å¯ Monad å¤§é—¨çš„é’¥åŒ™ï¼ŒåŠ©ä½ åœ¨ Web3 æµªæ½®ä¸­å¤§å±•èº«æ‰‹ï¼

## å‚è€ƒ

- <https://www.openzeppelin.com/solidity-contracts>
- <https://github.com/OpenZeppelin/openzeppelin-contracts>
- <https://eips.ethereum.org/EIPS/eip-721>
- <https://www.monad.xyz/>
- <https://docs.monad.xyz/introduction/monad-for-developers>
- <https://docs.monad.xyz/developer-essentials/network-information>
- <https://testnet.monadexplorer.com/>
- <https://github.com/monad-developers/foundry-monad>
- <https://testnet.monadexplorer.com/address/0x0660c412bf2aca856ee119cEfdD155b24595a6CE>
- <https://testnet.monadexplorer.com/tx/0x3b16fb11a783efef75a29d8819fced05ca769787f36784dabf2252ecfe12c630>
- <https://docs.monad.xyz/guides/scaffold-eth-monad>
- <https://github.com/qiaopengjun5162/MonadArt>
