+++
title = "Starknetå¼€å‘å®æˆ˜"
date = 2024-01-10T12:06:44+08:00
[taxonomies]
tags = ["Starknet","Cairo"]
categories = ["Starknet","Cairo"]
+++

# Starknetå¼€å‘å®æˆ˜

## ä»¥å¤ªåŠç½‘ç»œæ¶æ„

ä»¥å¤ªåŠæœ‰å…±è¯†ã€æ•°æ®å¯ç”¨æ€§ã€ç»“ç®—ã€æ‰§è¡Œå››ä¸ªæ¨¡å—ã€‚

å…±è¯†å±‚

- å…±è¯†å±‚æŒ‡çš„æ˜¯èŠ‚ç‚¹å°±åŒºå—é“¾ä¸Šå“ªäº›æ•°æ®å¯ä»¥è¢«éªŒè¯ä¸ºçœŸå®å’Œå‡†ç¡®è¾¾æˆåè®®çš„æœºåˆ¶ã€‚
- å…±è¯†åè®®å†³å®šäº†äº¤æ˜“å¦‚ä½•æ’åºï¼Œä»¥åŠæ–°åŒºå—å¦‚ä½•è¢«æ·»åŠ åˆ°é“¾ä¸Šã€‚

æ‰§è¡Œå±‚

- æ‰§è¡Œå±‚æ˜¯åŒºå—é“¾ä¸Šçš„èŠ‚ç‚¹å¦‚ä½•å¤„ç†äº¤æ˜“ï¼Œä»¥åœ¨ä¸åŒçŠ¶æ€ä¹‹é—´è¿‡æ¸¡åŒºå—é“¾ã€‚
- å‚ä¸å…±è¯†çš„èŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ä»–ä»¬çš„åŒºå—é“¾å‰¯æœ¬æ‰§è¡Œäº¤æ˜“ï¼Œä»¥ä¾¿åœ¨éªŒè¯åŒºå—ä¹‹å‰è¿›è¡Œè¯æ˜ã€‚

æ•°æ®å¯ç”¨æ€§

- åŒºå—æè®®è€…å‘å¸ƒåŒºå—çš„æ‰€æœ‰äº¤æ˜“æ•°æ®å¹¶ä¸”äº¤æ˜“æ•°æ®å¯ä¾›å…¶ä»–ç½‘ç»œå‚ä¸è€…ä½¿ç”¨çš„ä¿è¯ã€‚
- ç®€å•æ¥è®²ï¼Œæ•°æ®å¯ç”¨æ€§æ˜¯ä¸€ä¸ªé€šä¿¡æ ‡å‡†ï¼Œä»¥ä¿è¯æŸä¸ªèŠ‚ç‚¹çš„æ•°æ®å¯è¢«å¦ä¸€ä¸ªèŠ‚ç‚¹æ‰€æ¥æ”¶å¹¶éªŒè¯ä¸ºæ­£ç¡®ï¼Œä»è€Œä¿è¯å®‰å…¨ã€‚
- åŒºå—é“¾æ‰§è¡Œçš„è§„åˆ™è¦æ±‚äº¤æ˜“æ•°æ®çš„å¯ç”¨æ€§ã€‚è¿™æ„å‘³ç€åŒºå—ç”Ÿäº§è€…å¿…é¡»ä¸ºæ¯ä¸ªåŒºå—å‘å¸ƒæ•°æ®ï¼Œä¾›ç½‘ç»œå¯¹ç­‰è€…ä¸‹è½½å’Œå­˜å‚¨ï¼›è¿™äº›æ•°æ®å¿…é¡»åº”è¦æ±‚æä¾›ã€‚

ç»“ç®—å±‚

- åŒºå—é“¾æä¾›äº† "æœ€ç»ˆæ€§"--ä¿è¯å·²ç»æäº¤åˆ°é“¾çš„å†å²çš„äº¤æ˜“æ˜¯ä¸å¯é€†çš„ï¼ˆæˆ– "ä¸å¯æ”¹å˜çš„"ï¼‰ã€‚
- è¦åšåˆ°è¿™ä¸€ç‚¹ï¼ŒåŒºå—é“¾å¿…é¡»ç¡®ä¿¡äº¤æ˜“çš„æœ‰æ•ˆæ€§ã€‚å› æ­¤ï¼Œç»“ç®—åŠŸèƒ½éœ€è¦é“¾æ¥éªŒè¯äº¤æ˜“ï¼ŒéªŒè¯è¯æ˜ï¼Œå¹¶ä»²è£äº‰ç«¯ã€‚

## å®‰è£…

- <https://foundry-rs.github.io/starknet-foundry/getting-started/installation.html>
- <https://book.cairo-lang.org/ch01-01-installation.html>

```bash
curl -L https://raw.githubusercontent.com/foundry-rs/starknet-foundry/master/scripts/install.sh | sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1616  100  1616    0     0    691      0  0:00:02  0:00:02 --:--:--   691
Installing snfoundryup...
######################################################################## 100.0%

Detected your preferred bash is zsh and added snfoundryup to PATH. Run 'source /Users/qiaopengjun/.zshenv' or start a new terminal session to use snfoundryup.
Then, simply run 'snfoundryup' to install Starknet-Foundry.

~ via ğŸ…’ base took 3.3s
âœ
snfoundryup
starknet-foundry-install: retrieving latest version from https://github.com/foundry-rs/starknet-foundry...
starknet-foundry-install: downloading starknet-foundry-v0.13.1-aarch64-apple-darwin.tar.gz...
########################################################################################################################################################## 100.0%
starknet-foundry-install: installed snforge and sncast to /Users/qiaopengjun/.local/share/starknet-foundry-install/0.13.1
starknet-foundry-install: created symlink /Users/qiaopengjun/.local/bin/snforge -> /Users/qiaopengjun/.local/share/starknet-foundry-install/0.13.1/bin/snforge
starknet-foundry-install: created symlink /Users/qiaopengjun/.local/bin/sncast -> /Users/qiaopengjun/.local/share/starknet-foundry-install/0.13.1/bin/sncast

Starknet Foundry has been successfully installed and should be already available in your PATH.
Run 'snforge --version' and 'sncast --version' to verify your installation. Happy coding!

~ via ğŸ…’ base took 4.4s
âœ
snsnforge --version
sncast --version

snforge 0.13.1
sncast 0.13.1

scarb --version
scarb 2.4.0 (cba988e68 2023-12-06)
cairo: 2.4.0 (https://crates.io/crates/cairo-lang-compiler/2.4.0)
sierra: 1.4.0
```

## åˆ›å»ºé¡¹ç›®

```bash
which scarb
/Users/qiaopengjun/.local/bin/scarb

scarb new hello_world
Created `hello_world` package.

ls
hello_world

cd hello_world/

c

hello_world on î‚  main [?] via ğŸ…’ base 
âœ scarb test     
     Running cairo-test hello_world
   Compiling test(hello_world_unittest) hello_world v0.1.0 (/Users/qiaopengjun/Code/cairo/hello_world/Scarb.toml)
    Finished release target(s) in 1 second
testing hello_world ...
running 1 tests
test hello_world::tests::it_works ... ok (gas usage est.: 46860)
test result: ok. 1 passed; 0 failed; 0 ignored; 0 filtered out;

hello_world on î‚  main [?] via ğŸ…’ base 
âœ  scarb cairo-run --available-gas=200000000
   Compiling hello_world v0.1.0 (/Users/qiaopengjun/Code/cairo/hello_world/Scarb.toml)
    Finished release target(s) in 1 second
     Running hello_world
Run completed successfully, returning [987]
Remaining gas: 199953640
```

### `lib.cairo` æ–‡ä»¶

```cairo
fn main() {
    let mut x = 5;
    println!("Hello, world! {}", x);

    x = 6;
    println!("Hello, world! {}", x);
}


#[cfg(test)]
mod tests {
    #[test]
    fn it_works() {}
}

```

### è¿è¡Œ

```bash
hello_world on î‚  main [?] via ğŸ…’ base 
âœ scarb cairo-run --available-gas=200000000
   Compiling hello_world v0.1.0 (/Users/qiaopengjun/Code/cairo/hello_world/Scarb.toml)
    Finished release target(s) in 1 second
     Running hello_world
Hello, world! 5
Hello, world! 6
Run completed successfully, returning []
Remaining gas: 199661300

```

Cairo  æ²¡æœ‰åŠæ³•å¯¹ felt252 åšé™¤æ³•

### `lib.cairo` æ–‡ä»¶

```rust
const ONE_HOUR_IN_SECONDS: u32 = 3600;

#[derive(Drop)]
struct Rectangle {
    width: u64,
    height: u64
}

#[derive(Drop)]
struct Rectangle1<T> {
    width: T,
    height: T
}

trait RectangleTrait {
    fn area(self: @Rectangle) -> u64;
}

trait RectangleTrait1<T> {
    fn area(self: @Rectangle1<T>) -> T;
}

impl RectangleImpl1<T, +Mul<T>, +Copy<T>> of RectangleTrait1<T> {
    fn area(self: @Rectangle1<T>) -> T {
        *self.width * *self.height
    }
}

fn main() {
    let mut x = 5;
    println!("Hello, world! {}", x);

    x = 6;
    println!("Hello, world! {}", x);

    println!("ONE_HOUR_IN_SECONDS is {ONE_HOUR_IN_SECONDS}");

    let mut y: u16 = 10;
    y = y / 2;
    println!("y is {y}");

    let z: u256 = 10;
    let l = 5_u8;
    println!("z is {z} and l is {l}");
    println!("z + l is {}", z + l.into());
    println!("l / y is {}", l / y.try_into().unwrap());

    let x = 'Hello World';
    println!("x is {x}"); // x is 87521618088882533792115812

    let x = 25_u16;
    println!("{}", format!("https://example.com/{}", x));

    let y: ByteArray = "Hello World";
    println!("y is {y}");
    println!("{y:?}");

    println!("{}", sum_three(1, 2, 3));

    println!("{}", min(1, 2));
    println!("{}", min2(1, 2, 3));
    println!("fib: {}", fib(1, 2, 5));

    let a = array![1, 2, 3, 4, 5];
    println!("sum_array! {}", sum_array(a));
    // println!("Arr Len is {}", a.len());  error: Variable was previously moved.

    let (a, b, c) = (1, 2, 3);
    println!("sum_three: {}", sum_three(a, b, c));
    println!("A is {a}");

    let arr = array![1, 2, 3, 4, 5];
    // println!("arr len is {}", return_len(@arr));
    println!("arr len is {}", return_len(arr.span()));
    // println!("arr len {}", arr.len());  error: Variable was previously moved.
    println!("arr len {}", arr.len());
    // å¿«ç…§ä¼ å‚ @ ä¼šè·å¾—å˜é‡çš„ä¸å¯å˜å¼•ç”¨
    // å¯å˜å¼•ç”¨ä¼ å‚

    println!("sum_array2: {}", sum_array2(arr.span()));

    let mut arr = array![1, 2, 3, 4];
    println!("sum_array3: {}", sum_array3(ref arr));
    println!("arr len is {}", arr.len());

    let rectangle = Rectangle { width: 30, height: 50 };
    let area = area(@rectangle);
    println!("area is {}", area);
    println!(
        "Width is {}", rectangle.width
    ); // Variable not dropped.  Variable was previously moved.

    println!("Rectangle is {}", rectangle);

    println!("Area is {}", rectangle.area());
    let rectangle1 = Rectangle1 { width: 30_u32, height: 50 };
    println!("Area is rectangle1 {}", rectangle1.area());
}

fn sum_three(a: u32, b: u32, c: u32) -> u32 {
    a + b + c
}

fn min(a: u32, b: u32) -> u32 {
    if a < b {
        a
    } else {
        b
    }
}

fn min2(a: u32, b: u32, c: u32) -> u32 {
    if (a <= b) & (a <= c) {
        a
    } else if (b <= a) & (b <= c) {
        b
    } else {
        c
    }
}

fn fib(mut a: felt252, mut b: felt252, mut n: felt252) -> felt252 {
    loop {
        if n == 0 {
            break a;
        }
        n -= 1;
        let temp = b;
        b = a + b;
        a = temp;
    }
}

fn sum_array(mut arr: Array<u32>) -> u32 {
    let mut sum = 0_u32;

    loop {
        match arr.pop_front() {
            Option::Some(current_value) => { sum += current_value },
            Option::None => { break; },
        }
    };
    sum
}

// fn return_len(arr: Array<u32>) -> u32 {
// fn return_len(arr: @Array<u32>) -> u32 {
fn return_len(arr: Span<u32>) -> u32 {
    arr.len()
}

fn sum_array2(mut arr: Span<u32>) -> u32 {
    let mut sum: u32 = 0;

    loop {
        match arr.pop_front() {
            Option::Some(current_value) => { sum += *current_value },
            Option::None => { break; },
        }
    };
    sum
}

fn sum_array3(ref arr: Array<u32>) -> u32 {
    let mut sum: u32 = 0;

    loop {
        match arr.pop_front() {
            Option::Some(current_value) => { sum += current_value },
            Option::None => { break; },
        }
    };
    sum
}

fn area(rectangle: @Rectangle) -> u64 {
    *rectangle.width * *rectangle.height
}

impl RectangleDisplay of core::fmt::Display<Rectangle> {
    fn fmt(self: @Rectangle, ref f: core::fmt::Formatter) -> Result<(), core::fmt::Error> {
        write!(f, "width: ")?;
        core::fmt::Display::fmt(self.width, ref f)?;
        write!(f, ", height: ")?;
        core::fmt::Display::fmt(self.height, ref f)
    }
}

impl RectangleImpl of RectangleTrait {
    fn area(self: @Rectangle) -> u64 {
        *self.width * *self.height
    }
}

#[cfg(test)]
mod tests {
    use super::sum_three;

    #[test]
    fn it_works() {
        assert(sum_three(1, 2, 3) == 6, 'Sum Fail');
        assert_eq!(sum_three(1, 2, 3), 6);
        assert_eq!(sum_three(10, 20, 30), 60);
    }
}
// å½“æˆ‘ä»¬ä½¿ç”¨ç®€å•ç±»å‹ ï¼ˆu8 u16 u32ï¼‰ æ—¶ï¼Œ ä¸éœ€è¦å…³æ³¨æ‰€æœ‰æƒç±»å‹ï¼Œåªæœ‰æŠ¥é”™çš„æ—¶å€™æ‰å…³æ³¨
// å½“é‡åˆ°æ‰€æœ‰æƒçš„æ—¶å€™ï¼Œä¸æƒ³æ”¹å˜åˆ™ä½¿ç”¨ @ Span å¿«ç…§ç±»å‹  ä¿®æ”¹åˆ™ä½¿ç”¨ ref è¦æ±‚æ˜¯å¯å˜çš„å˜é‡ ä½¿ç”¨ mut 



```

### è¿è¡Œ

```bash
hello_world on î‚  main via ğŸ…’ base took 6.7s 
âœ scarb cairo-run --available-gas=200000000                                
   Compiling hello_world v0.1.0 (/Users/qiaopengjun/Code/cairo/hello_world/Scarb.toml)
    Finished release target(s) in 1 second
     Running hello_world
Hello, world! 5
Hello, world! 6
ONE_HOUR_IN_SECONDS is 3600
y is 5
z is 10 and l is 5
z + l is 15
l / y is 1
x is 87521618088882533792115812
https://example.com/25
y is Hello World
"Hello World"
6
1
1
fib: 13
sum_array! 15
sum_three: 6
A is 1
arr len is 5
arr len 5
sum_array2: 15
sum_array3: 10
arr len is 0
area is 1500
Width is 30
Rectangle is width: 30, height: 50
Area is 1500
Area is rectangle1 1500
Run completed successfully, returning []
Remaining gas: 194095080

```

## å®‰è£… starkli

- <https://github.com/xJonathanLEI/starkli>
- <https://book.starkli.rs/installation>

```bash
curl https://get.starkli.sh | sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  3574  100  3574    0     0   2064      0  0:00:01  0:00:01 --:--:--  2064
Installing starkliup...
######################################################################## 100.0%

bash detection variables (for debugging use):
- ZSH_NAME =
- bash = /bin/zsh

Run '. /Users/qiaopengjun/.starkli/env' or start a new terminal session to use starkliup.
Then, simply run starkliup to install starkli.


~ via ğŸ…’ base took 11.3s
âœ
. /Users/qiaopengjun/.starkli/env


~ via ğŸ…’ base
âœ
starkliup -v v0.2.3
Installing version v0.2.3...
Detected host triple: aarch64-apple-darwin
Downloading release file from GitHub...
########################################################################################################################################################## 100.0%
Successfully installed starkli

Generating bash completion files...
- Bash ... Done
- Zsh ... Done
Note that bash completions might not work until you start a new session.

Installation successfully completed.

~ via ğŸ…’ base took 2.5s
âœ
mkdir ~/.starknet_accounts

~ via ğŸ…’ base
âœ
starkli signer keystore new ~/.starknet_accounts/key.json
Enter password:
Created new encrypted keystore file: /Users/qiaopengjun/.starknet_accounts/key.json
Public key: 0x04bf26d3d5789369d5254c9e82278007fd2ceccb3edf3e45e74107a4fafe619a

~ via ğŸ…’ base took 8.1s
âœ
starkli -h
Starkli (/ËˆstÉ‘ËrklaÉª/), a blazing fast CLI tool for Starknet powered by starknet-rs

Usage: starkli [OPTIONS] [COMMAND]

Commands:
  selector            Calculate selector from name
  class-hash          Calculate class hash from any contract artifacts (Sierra, casm, legacy)
  to-cairo-string     Encode string into felt with the Cairo short string representation
  parse-cairo-string  Decode string from felt with the Cairo short string representation
  mont                Print the montgomery representation of a field element
  call                Call contract functions without sending transactions
  transaction         Get Starknet transaction by hash
  block-number        Get latest block number
  block-hash          Get latest block hash
  block               Get Starknet block
  block-time          Get Starknet block timestamp only
  state-update        Get state update from a certain block
  receipt             Get transaction receipt by hash
  trace               Get transaction trace by hash
  chain-id            Get Starknet network ID
  balance             Get native gas token (currently ETH) balance
  nonce               Get nonce for a certain contract
  storage             Get storage value for a slot at a contract
  class-hash-at       Get contract class hash deployed at a certain address
  class-by-hash       Get contract class by hash
  class-at            Get contract class deployed at a certain address
  syncing             Get node syncing status
  signer              Signer management commands
  account             Account management commands
  invoke              Send an invoke transaction from an account contract
  declare             Declare a contract class
  deploy              Deploy contract via the Universal Deployer Contract
  completions         Generate bash completions script
  lab                 Experimental commands for fun and profit
  help                Print this message or the help of the given subcommand(s)

Options:
  -V, --version  Print version info and exit
  -v, --verbose  Use verbose output (currently only applied to version)
  -h, --help     Print help

~ via ğŸ…’ base
âœ
starkli account -h
Account management commands

Usage: starkli account <COMMAND>

Commands:
  fetch    Fetch account config from an already deployed account contract
  deploy   Deploy account contract with a DeployAccount transaction
  oz       Create and manage OpenZeppelin account contracts
  argent   Create and manage Argent X account contracts
  braavos  Create and manage Braavos account contracts
  help     Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help

~ via ğŸ…’ base
âœ
export STARKNET_KEYSTORE=~/.starknet_accounts/key.json

~ via ğŸ…’ base
âœ
starkli account oz init  ~/.starknet_accounts/starkli.json
Enter keystore password:
Created new account config file: /Users/qiaopengjun/.starknet_accounts/starkli.json

Once deployed, this account will be available at:
    0x03886a342a2bc5a497bb3b4f3c4152c7b3778de4c638b05be7bca46b8476db2a

Deploy this account by running:
    starkli account deploy /Users/qiaopengjun/.starknet_accounts/starkli.json

~ via ğŸ…’ base took 7.5s
âœ
export STARKNET_RPC=https://starknet-testnet.public.blastapi.io

~ via ğŸ…’ base
âœ
starkli account deploy /Users/qiaopengjun/.starknet_accounts/starkli.json
Enter keystore password:
Error: JSON-RPC error: code=-32602, message="Invalid params", data={"reason":"expected value at line 1 column 491"}


~ via ğŸ…’ base
âœ
starkli -V
0.2.3 (5880a23)

~ via ğŸ…’ base
âœ
export STARKNET_RPC=https://starknet-testnet.public.blastapi.io/rpc/v0_6

~ via ğŸ…’ base
âœ
starkli account deploy /Users/qiaopengjun/.starknet_accounts/starkli.json
Enter keystore password:
The estimated account deployment fee is 0.000004431000062034 ETH. However, to avoid failure, fund at least:
    0.000006646500093051 ETH
to the following address:
    0x03886a342a2bc5a497bb3b4f3c4152c7b3778de4c638b05be7bca46b8476db2a
Press [ENTER] once you've funded the address.
Account deployment transaction: 0x0702470c421f248a6a3c3ff2c6398f433218fe0b0b18a45424860df12db35e24
Waiting for transaction 0x0702470c421f248a6a3c3ff2c6398f433218fe0b0b18a45424860df12db35e24 to confirm. If this process is interrupted, you will need to run `starkli account fetch` to update the account file.
Transaction not confirmed yet...
Transaction 0x0702470c421f248a6a3c3ff2c6398f433218fe0b0b18a45424860df12db35e24 confirmed

~ via ğŸ…’ base took 17m 41.8s
âœ
```

![image-20240112224741141](/images/image-20240112224741141.png)

![image-20240112224903698](/images/image-20240112224903698.png)

## ç›¸å…³é“¾æ¥

- <https://blastapi.io/public-api/starknet>
- <https://faucet.goerli.starknet.io/>
- <https://book.cairo-lang.org/ch01-01-installation.html>
- <https://foundry-rs.github.io/starknet-foundry/getting-started/installation.html>
- <https://testnet.starkscan.co/tx/0x0702470c421f248a6a3c3ff2c6398f433218fe0b0b18a45424860df12db35e24>
- <https://testnet.starkscan.co/contract/0x03886a342a2bc5a497bb3b4f3c4152c7b3778de4c638b05be7bca46b8476db2a>
