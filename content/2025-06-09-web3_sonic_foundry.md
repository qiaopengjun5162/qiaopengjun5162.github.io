+++
title = "æ¢ç´¢Web3æ–°é€Ÿåº¦ï¼šSonicé«˜æ€§èƒ½Layer-1ä¸Šçš„BlindAuctionæ™ºèƒ½åˆçº¦å®è·µ"
description = "æ¢ç´¢Web3æ–°é€Ÿåº¦ï¼šSonicé«˜æ€§èƒ½Layer-1ä¸Šçš„BlindAuctionæ™ºèƒ½åˆçº¦å®è·µ"
date = 2025-06-09T00:42:01Z
[taxonomies]
categories = ["Web3", "Sonic", "Foundry"]
tags = ["Web3", "Sonic", "Foundry"]
+++

<!-- more -->

# æ¢ç´¢Web3æ–°é€Ÿåº¦ï¼šSonicé«˜æ€§èƒ½Layer-1ä¸Šçš„BlindAuctionæ™ºèƒ½åˆçº¦å®è·µ

åœ¨Web3çš„æµªæ½®ä¸­ï¼ŒSonicä»¥å…¶è¶…é«˜ååé‡ï¼ˆ400,000+ TPSï¼‰å’Œäºšç§’çº§ç¡®è®¤é€Ÿåº¦ï¼Œæ­£åœ¨é‡æ–°å®šä¹‰åŒºå—é“¾çš„æ€§èƒ½è¾¹ç•Œã€‚ä½œä¸ºä¸€æ¬¾é«˜æ€§èƒ½EVM Layer-1åŒºå—é“¾ï¼ŒSonicä¸ºå»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰æä¾›äº†æ— é™å¯èƒ½ã€‚æœ¬æ–‡å°†å¸¦ä½ èµ°è¿›Sonicç”Ÿæ€ï¼Œç»“åˆä¸€ä¸ªç»å…¸çš„BlindAuctionï¼ˆç›²æ‹ï¼‰æ™ºèƒ½åˆçº¦ï¼Œæ·±å…¥è§£æå¦‚ä½•åœ¨Sonicä¸Šå¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²æ™ºèƒ½åˆçº¦ï¼Œä½“éªŒWeb3çš„æè‡´é€Ÿåº¦ä¸å®‰å…¨æ€§ï¼

Sonicæ˜¯ä¸€æ¬¾ä¸“ä¸ºDeFiæ‰“é€ çš„é«˜æ€§èƒ½EVM Layer-1åŒºå—é“¾ï¼Œæ”¯æŒè¶…400,000 TPSå’Œäºšç§’çº§äº¤æ˜“ç¡®è®¤ï¼Œç»“åˆå…¶åŸç”Ÿä»£å¸Sçš„è´¨æŠ¼ä¸æ²»ç†æœºåˆ¶ï¼Œä¸ºå¼€å‘è€…æä¾›é«˜æ•ˆã€å®‰å…¨çš„å¼€å‘ç¯å¢ƒã€‚æœ¬æ–‡é€šè¿‡å®ç°ä¸€ä¸ªBlindAuctionæ™ºèƒ½åˆçº¦ï¼Œè¯¦ç»†å±•ç¤ºäº†ä»é¡¹ç›®åˆå§‹åŒ–ã€åˆçº¦ç¼–å†™ã€å…¨é¢æµ‹è¯•åˆ°åœ¨Sonicæµ‹è¯•ç½‘éƒ¨ç½²çš„å…¨æµç¨‹ã€‚ç›²æ‹åˆçº¦é€šè¿‡åŠ å¯†å‡ºä»·ã€é˜¶æ®µæ§åˆ¶å’Œèµ„é‡‘å®‰å…¨æœºåˆ¶ï¼Œä¿éšœäº†å…¬å¹³ç«æ‹å’Œéšç§ä¿æŠ¤ã€‚æµ‹è¯•è¦†ç›–ç‡è¾¾100%ï¼Œå¹¶æˆåŠŸéƒ¨ç½²äºSonicå’ŒHoodiæµ‹è¯•ç½‘ï¼Œå±•ç°äº†Sonicåœ¨Web3å¼€å‘ä¸­çš„å¼ºå¤§æ½œåŠ›ã€‚

### ä»€ä¹ˆæ˜¯ Sonic

Sonic æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½çš„ EVM Layer-1 åŒºå—é“¾ï¼Œæ—¨åœ¨é€šè¿‡å…¶é€Ÿåº¦ã€æ¿€åŠ±æœºåˆ¶å’Œä¸–ç•Œçº§åŸºç¡€è®¾æ–½ï¼Œæ”¯æŒä¸‹ä¸€ä»£å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰åº”ç”¨çš„å‘å±•ã€‚æ ¹æ® [Sonic | The Fastest EVM Layer-1 Blockchain](https://www.soniclabs.com)ï¼Œå®ƒæä¾›è¶…è¿‡ 400,000 TPSï¼ˆæ¯ç§’äº¤æ˜“é‡ï¼‰å’Œäºšç§’çº§ç¡®è®¤ï¼Œç¡®ä¿å¿«é€Ÿã€å®‰å…¨çš„äº¤æ˜“ä½“éªŒã€‚

S ä»£å¸æ˜¯ Sonic çš„åŸç”Ÿä»£å¸ï¼Œä¸»è¦ç”¨äºæ”¯ä»˜äº¤æ˜“è´¹ç”¨ã€è´¨æŠ¼ä»¥ä¿æŠ¤ç½‘ç»œã€è¿è¡ŒéªŒè¯èŠ‚ç‚¹ä»¥åŠå‚ä¸æ²»ç†å†³ç­–ã€‚æ ¹æ® [Sonic $S Tokenomics Explained: Utility, Staking, and Rewards](https://www.bitrue.com/blog/sonic-s-tokenomics-explained-utility-staking-and-rewards)ï¼Œè¿™äº›åŠŸèƒ½å¢å¼ºäº†ç½‘ç»œçš„å»ä¸­å¿ƒåŒ–å’Œå¯æŒç»­æ€§ã€‚

## å®æ“ BlindAuction åˆçº¦

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®å¹¶åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•

```bash
mcd BlindAuction  # mkdir BlindAuction && cd BlindAuction
```

### ç¬¬äºŒæ­¥ï¼šæ ¹æ®æ¨¡ç‰ˆåˆå§‹åŒ–é¡¹ç›®

```bash
forge init --template https://github.com/qiaopengjun5162/foundry-template
```

### ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹é¡¹ç›®ç›®å½•ç»“æ„

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ tree . -L 6 -I "coverage_report|lib|.vscode|out|lcov.info|bin|cache"
.
â”œâ”€â”€ _typos.toml
â”œâ”€â”€ CHANGELOG.md
â”œâ”€â”€ cliff.toml
â”œâ”€â”€ docs
â”‚   â””â”€â”€ readme.md
â”œâ”€â”€ foundry_monad.toml
â”œâ”€â”€ foundry.toml
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ remappings.txt
â”œâ”€â”€ script
â”‚   â”œâ”€â”€ BlindAuction.s.sol
â”‚   â””â”€â”€ deploy.sh
â”œâ”€â”€ slither.config.json
â”œâ”€â”€ src
â”‚   â””â”€â”€ BlindAuction.sol
â”œâ”€â”€ style_guide.md
â””â”€â”€ test
    â””â”€â”€ BlindAuction.t.sol

5 directories, 15 files
```

### ç¬¬å››æ­¥ï¼šå®ç°åˆçº¦ BlindAuction.sol

```ts
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.30;

contract BlindAuction {
    struct Bid {
        bytes32 blindedBid;
        uint256 deposit;
    }

    address payable public beneficiary;
    uint256 public biddingEnd;
    uint256 public revealEnd;
    bool public ended;

    mapping(address => Bid[]) public bids;
    address public highestBidder;
    uint256 public highestBid;

    mapping(address => uint256) public lockedFunds;
    mapping(address => uint256) public pendingReturns;

    event AuctionEnded(address winner, uint256 highestBid);

    error TooEarly(uint256 time);
    error TooLate(uint256 time);
    error AuctionEndAlreadyCalled();
    error InvalidBidReveal();
    error FundsNotLockedCorrectly();

    modifier onlyBefore(uint256 time) {
        if (block.timestamp >= time) revert TooLate(time);
        _;
    }

    modifier onlyAfter(uint256 time) {
        if (block.timestamp <= time) revert TooEarly(time);
        _;
    }

    constructor(uint256 biddingTime, uint256 revealTime, address payable beneficiaryAddress) {
        if (beneficiaryAddress == address(0)) revert InvalidBidReveal();
        beneficiary = beneficiaryAddress;
        biddingEnd = block.timestamp + biddingTime;
        revealEnd = biddingEnd + revealTime;
    }

    function bid(bytes32 blindedBid) external payable onlyBefore(biddingEnd) {
        if (msg.value == 0) revert InvalidBidReveal();
        bids[msg.sender].push(Bid({blindedBid: blindedBid, deposit: msg.value}));
    }

    function reveal(uint256[] calldata values, bool[] calldata fakes, bytes32[] calldata secrets)
        external
        onlyAfter(biddingEnd)
        onlyBefore(revealEnd)
    {
        uint256 length = bids[msg.sender].length;
        require(values.length == length, "Values length mismatch");
        require(fakes.length == length, "Fakes length mismatch");
        require(secrets.length == length, "Secrets length mismatch");

        uint256 refund;
        for (uint256 i = 0; i < length; i++) {
            Bid storage bidToCheck = bids[msg.sender][i];

            (uint256 value, bool fake, bytes32 secret) = (values[i], fakes[i], secrets[i]);
            if (bidToCheck.blindedBid != keccak256(abi.encodePacked(value, fake, secret))) {
                continue;
            }
            refund += bidToCheck.deposit;
            if (!fake && bidToCheck.deposit >= value) {
                if (placeBid(msg.sender, value)) {
                    refund -= value;
                    lockedFunds[msg.sender] = value;
                }
            }
            bidToCheck.blindedBid = bytes32(0);
        }
        if (refund > 0) {
            (bool success,) = payable(msg.sender).call{value: refund}("");
            require(success, "Refund failed");
        }
    }

    function withdraw() external {
        uint256 amount = pendingReturns[msg.sender];
        if (amount > 0) {
            pendingReturns[msg.sender] = 0;
            (bool success,) = payable(msg.sender).call{value: amount}("");
            require(success, "Withdrawal failed");
        }
    }

    function auctionEnd() external onlyAfter(revealEnd) {
        if (ended) revert AuctionEndAlreadyCalled();
        ended = true;
        emit AuctionEnded(highestBidder, highestBid);

        // åªè½¬ç§»æœ€é«˜å‡ºä»·èµ„é‡‘ï¼Œç¡®ä¿èµ„é‡‘å·²è¢«é”å®š
        if (lockedFunds[highestBidder] != highestBid) {
            revert FundsNotLockedCorrectly();
        }
        (bool success,) = beneficiary.call{value: highestBid}("");
        require(success, "Transfer failed");
    }

    function placeBid(address bidder, uint256 value) internal returns (bool success) {
        if (value <= highestBid) {
            return false;
        }

        // ä¿å­˜å½“å‰æœ€é«˜å‡ºä»·ä¿¡æ¯
        address previousHighestBidder = highestBidder;
        uint256 previousHighestBid = highestBid;

        // æ›´æ–°æœ€é«˜å‡ºä»·
        highestBid = value;
        highestBidder = bidder;

        // é”å®šå‰ä¸€ä¸ªæœ€é«˜å‡ºä»·è€…çš„èµ„é‡‘
        if (previousHighestBidder != address(0)) {
            pendingReturns[previousHighestBidder] += previousHighestBid;
        }
        return true;
    }
}

```

è¿™ä¸ªæ™ºèƒ½åˆçº¦å®ç°äº†ä¸€ä¸ªç›²æ‹ï¼ˆBlind Auctionï¼‰ç³»ç»Ÿï¼Œåˆ†ä¸ºæŠ•æ ‡å’Œæ­ç¤ºä¸¤ä¸ªé˜¶æ®µã€‚åœ¨**æŠ•æ ‡é˜¶æ®µ**ï¼ˆ`biddingEnd`æˆªæ­¢å‰ï¼‰ï¼Œå‚ä¸è€…é€šè¿‡`bid`å‡½æ•°æäº¤åŠ å¯†çš„å‡ºä»·å“ˆå¸Œå€¼`blindedBid`å¹¶é™„å¸¦èµ„é‡‘æŠ¼é‡‘ã€‚è¿›å…¥**æ­ç¤ºé˜¶æ®µ**ï¼ˆ`biddingEnd`åˆ°`revealEnd`ï¼‰ï¼Œå‚ä¸è€…è°ƒç”¨`reveal`å‡½æ•°å…¬å¼€å®é™…å‡ºä»·é‡‘é¢ã€éªŒè¯ç å’ŒçœŸä¼ªæ ‡å¿—ï¼Œåˆçº¦æ ¡éªŒå“ˆå¸ŒåŒ¹é…åï¼Œè‹¥å‡ºä»·çœŸå®ä¸”æŠ¼é‡‘å……è¶³ï¼Œåˆ™æ¿€æ´»`placeBid`æ›´æ–°æœ€é«˜å‡ºä»·ï¼ˆåŸæœ€é«˜å‡ºä»·è€…èµ„é‡‘è¿›å…¥å¾…é€€æ¬¾`pendingReturns`ï¼‰ã€‚æ‹å–ç»“æŸåï¼Œé€šè¿‡`auctionEnd`å°†æœ€é«˜å‡ºä»·èµ„é‡‘ï¼ˆéœ€é€šè¿‡`lockedFunds`æ ¡éªŒï¼‰è½¬ç»™å—ç›Šäºº`beneficiary`ï¼Œå…¶ä»–å‚ä¸è€…å¯é€šè¿‡`withdraw`æå–é€€æ¬¾ã€‚å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š

1. **éšç§ä¿æŠ¤**ï¼šæŠ•æ ‡é˜¶æ®µéšè—å®é™…å‡ºä»·
2. **èµ„é‡‘å®‰å…¨**ï¼šæœ€é«˜å‡ºä»·èµ„é‡‘é”å®šæœºåˆ¶
3. **é”™è¯¯å¤„ç†**ï¼šè‡ªå®šä¹‰é”™è¯¯ç±»å‹ï¼ˆå¦‚æ—¶é—´æ ¡éªŒã€èµ„é‡‘éªŒè¯ï¼‰
4. **é˜¶æ®µæ§åˆ¶**ï¼šä¿®é¥°å™¨ï¼ˆ`onlyBefore`/`onlyAfter`ï¼‰ä¸¥æ ¼åˆ’åˆ†æŠ•æ ‡ã€æ­ç¤ºå’Œç»“æŸæ—¶æ®µ

ç¤ºä¾‹æµç¨‹ï¼šAæäº¤åŠ å¯†å‡ºä»·ï¼ˆå®é™…100ETHï¼‰å¹¶è´¨æŠ¼120ETH â†’ æ­ç¤ºé˜¶æ®µAéªŒè¯å‡ºä»· â†’ è‹¥æˆä¸ºæœ€é«˜å‡ºä»·ï¼Œ100ETHè¢«é”å®šã€20ETHé€€å› â†’ æ‹å–ç»“æŸå—ç›Šäººè·å¾—100ETHã€‚

è¿™æ˜¯ä¸€ä¸ªå¯†å°æ‹å–ï¼ˆç›²æ‹ï¼‰æ™ºèƒ½åˆçº¦ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯è®©ç«æ ‡è€…åœ¨ä¸æš´éœ²å‡ºä»·çš„å‰æä¸‹ç«ä»·ã€‚

```mermaid
sequenceDiagram
    participant ç«æ ‡è€… as ç«æ ‡è€…
    participant åˆçº¦ as BlindAuction
    participant å—ç›Šäºº as å—ç›Šäºº

    ç«æ ‡è€…->>åˆçº¦: 1. æäº¤åŠ å¯†å‡ºä»·ï¼ˆblindedBidï¼‰
    Note right of åˆçº¦: å‡ºä»·é˜¶æ®µï¼ˆæ‰€æœ‰äººåªçœ‹åˆ°å“ˆå¸Œå€¼ï¼‰
    loop éšè—ç«ä»·
        åˆçº¦->>åˆçº¦: å­˜å‚¨åŠ å¯†å‡ºä»·å’ŒæŠ¼é‡‘
    end
    
    ç«æ ‡è€…->>åˆçº¦: 2. æ­ç¤ºçœŸå®å‡ºä»·ï¼ˆrevealï¼‰
    Note right of åˆçº¦: æ­ç¤ºé˜¶æ®µï¼ˆæäº¤çœŸå®å€¼+å¯†ç ï¼‰
    alt æœ‰æ•ˆå‡ºä»·
        åˆçº¦->>åˆçº¦: æ£€æŸ¥å“ˆå¸ŒåŒ¹é…
        åˆçº¦->>åˆçº¦: æ›´æ–°æœ€é«˜å‡ºä»·
    else æ— æ•ˆå‡ºä»·
        åˆçº¦->>ç«æ ‡è€…: é€€è¿˜æŠ¼é‡‘
    end

    åˆçº¦->>å—ç›Šäºº: 3. ç»“æŸæ‹å–ï¼ˆauctionEndï¼‰
    Note left of å—ç›Šäºº: è·å¾—æœ€é«˜å‡ºä»·é‡‘é¢
    åˆçº¦->>ç«æ ‡è€…: é€€è¿˜è½æ ‡è€…æŠ¼é‡‘
```

![image-20250608212821417](/images/image-20250608212821417.png)

### ä¸‰å¤§æ ¸å¿ƒé˜¶æ®µ

#### 1. å¯†å°å‡ºä»·é˜¶æ®µ

- ç«æ ‡è€…æäº¤ keccak256(çœŸå®å‡ºä»·+å¯†ç )
- æ‰€æœ‰å‡ºä»·å®Œå…¨åŒ¿åï¼ˆè¿åˆçº¦éƒ½çœ‹ä¸åˆ°çœŸå®é‡‘é¢ï¼‰

#### 2. æ­ç¤ºé˜¶æ®µ

- ç«æ ‡è€…æäº¤çœŸå®å‡ºä»·å’Œå¯†ç 
- åˆçº¦éªŒè¯ï¼škeccak256(æäº¤å€¼) = åŸå§‹å“ˆå¸Œ
- æš´éœ²ä¼ªè£…å‡ºä»·ï¼ˆfake bidsï¼‰ç›´æ¥é€€è¿˜æŠ¼é‡‘

#### 3. ç»“ç®—é˜¶æ®µ

- æœ€é«˜å‡ºä»·è½¬è´¦ç»™å—ç›Šäºº
- å…¶ä»–ç«æ ‡è€…é€šè¿‡ withdraw() å–å›æŠ¼é‡‘

```mermaid
graph LR
    A[åŠ å¯†æäº¤] --> B[å“ˆå¸Œç›²æ‹]
    C[å¤šé‡éªŒè¯] --> D[é˜²ä½œå¼Šæœºåˆ¶]
    E[èµ„é‡‘å®‰å…¨] --> F[ç‹¬ç«‹é€€æ¬¾é€šé“]
    
    B -.-> |ä»»ä½•äººæ— æ³•é¢„çŸ¥å‡ºä»·| G(å…¬å¹³ç«æ‹)
    D -.-> |æ— æ•ˆæŠ¥ä»·è‡ªåŠ¨é€€è¿˜| H(é˜²æ¬ºè¯ˆ)
    F -.-> |å¤±è´¥ç«ä»·åŸè·¯è¿”è¿˜| I(èµ„é‡‘å®‰å…¨)
```

![image-20250608212843778](/images/image-20250608212843778.png)

ğŸ’¡ å°±åƒã€Œæš—æ‹ã€æ¸¸æˆï¼š

1. æ‰€æœ‰äººæŠŠå‡ºä»·å¯†å°åœ¨ä¿¡å°é‡Œæäº¤
2. åŒæ—¶å¼€å°éªŒè¯çœŸå®å‡ºä»·
3. åªæœ‰æœ€é«˜å‡ºä»·ä»˜æ¬¾ï¼Œå…¶ä»–äººæ‹¿å›æŠ¼é‡‘
   å®Œç¾è§£å†³ä¼ ç»Ÿæ‹å–çš„è·Ÿæ‹ç­–ç•¥é—®é¢˜ï¼

## æµ‹è¯•åˆçº¦

### ç¬¬ä¸€æ­¥ï¼šç¼–å†™æµ‹è¯•æ–‡ä»¶ BlindAuction.t.sol

```ts
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.30;

import {Test, console} from "forge-std/Test.sol";
import {BlindAuction} from "../src/BlindAuction.sol";

contract BlindAuctionTest is Test {
    BlindAuction public auction;
    address payable public beneficiary = payable(address(0xBEEF));
    uint256 public constant BIDDING_TIME = 1 hours;
    uint256 public constant REVEAL_TIME = 1 hours;

    // Test accounts
    address public bidder1 = makeAddr("bidder1");
    address public bidder2 = makeAddr("bidder2");
    address public bidder3 = makeAddr("bidder3");

    /**
     * Account bidder1 = makeAccount("bidder1");
     * Account bidder2 = makeAccount("bidder2");
     * Account bidder3 = makeAccount("bidder3");
     *
     *
     * // ä½¿ç”¨è´¦æˆ·ç”Ÿæˆå™¨åˆ›å»ºå¯è¿½è¸ªçš„æµ‹è¯•è´¦æˆ·
     * address public bidder1 = makeAddr("bidder1");
     * address public bidder2 = makeAddr("bidder2");
     * address public bidder3 = makeAddr("bidder3");
     */
    function setUp() public {
        auction = new BlindAuction(BIDDING_TIME, REVEAL_TIME, beneficiary);
    }

    // ================ æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• ================ //
    function testContractInitialization() public view {
        assertEq(auction.beneficiary(), beneficiary);
        assertEq(auction.biddingEnd(), block.timestamp + BIDDING_TIME);
        assertEq(auction.revealEnd(), block.timestamp + BIDDING_TIME + REVEAL_TIME);
        assertFalse(auction.ended());
    }

    function testValidBid() public {
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, "secret"));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);

        assertEq(address(auction).balance, 1 ether);
    }

    function testRevealSingleValidBid() public {
        // Submit bid
        uint256 value = 1 ether;
        bytes32 secret = keccak256("secret");
        bytes32 blindedBid = keccak256(abi.encodePacked(value, false, secret));

        vm.deal(bidder1, 2 ether);
        vm.prank(bidder1);
        auction.bid{value: value}(blindedBid);

        // Move to reveal phase
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // Reveal bid
        uint256[] memory values = new uint256[](1);
        bool[] memory fakes = new bool[](1);
        bytes32[] memory secrets = new bytes32[](1);
        (values[0], fakes[0], secrets[0]) = (value, false, secret);

        vm.prank(bidder1);
        auction.reveal(values, fakes, secrets);

        assertEq(auction.highestBidder(), bidder1);
        assertEq(auction.highestBid(), value);
    }

    // åŸºç¡€çŠ¶æ€æµ‹è¯•
    function testInitialState() public view {
        assertEq(auction.beneficiary(), beneficiary);
        assertEq(auction.biddingEnd(), block.timestamp + BIDDING_TIME);
        assertEq(auction.revealEnd(), block.timestamp + BIDDING_TIME + REVEAL_TIME);
        assertFalse(auction.ended());
    }

    // æœ‰æ•ˆå‡ºä»·æµ‹è¯•
    function testBidBeforeEnd() public {
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, "secret"));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);

        assertEq(address(auction).balance, 1 ether);
    }

    // è¶…æ—¶å‡ºä»·æµ‹è¯•
    function test_RevertWhen_BidAfterBiddingEnd() public {
        vm.warp(block.timestamp + BIDDING_TIME + 1); // æ—¶é—´æ—…è¡Œåˆ°å‡ºä»·ç»“æŸå
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, "secret"));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.TooLate.selector, auction.biddingEnd()));
        auction.bid{value: 1 ether}(blindedBid);
    }

    // å•æ­ç¤ºæµ‹è¯•
    function testRevealSingleBid() public {
        // Place bid
        uint256 value = 1 ether;
        bool fake = false;
        bytes32 secret = keccak256("secret");
        bytes32 blindedBid = keccak256(abi.encodePacked(value, fake, secret));

        vm.deal(bidder1, 2 ether);
        vm.prank(bidder1);
        auction.bid{value: value}(blindedBid);

        // Move to reveal phase
        vm.warp(block.timestamp + BIDDING_TIME + 1); // è¿›å…¥æ­ç¤ºé˜¶æ®µ

        // Reveal // å‡†å¤‡æ­ç¤ºå‚æ•°
        uint256[] memory values = new uint256[](1);
        bool[] memory fakes = new bool[](1);
        bytes32[] memory secrets = new bytes32[](1);
        values[0] = value;
        fakes[0] = fake;
        secrets[0] = secret;

        vm.prank(bidder1);
        auction.reveal(values, fakes, secrets);

        assertEq(auction.highestBidder(), bidder1);
        assertEq(auction.highestBid(), value);
    }

    // æ··åˆæ­ç¤ºæµ‹è¯•ï¼ˆçœŸå®å‡ºä»·+è™šå‡å‡ºä»·ï¼‰
    function testRevealWithFakeBid() public {
        // è®¾ç½®å‡ºä»·å‚æ•°
        // Place real bid
        uint256 realValue = 1 ether;
        bool realFake = false;
        bytes32 realSecret = keccak256("real");
        bytes32 realBlindedBid = keccak256(abi.encodePacked(realValue, realFake, realSecret));

        // Place fake bid
        uint256 fakeValue = 2 ether;
        bool fakeFake = true;
        bytes32 fakeSecret = keccak256("fake");
        bytes32 fakeBlindedBid = keccak256(abi.encodePacked(fakeValue, fakeFake, fakeSecret));

        vm.deal(bidder1, realValue + fakeValue);
        vm.startPrank(bidder1);
        // åœ¨è½¬è´¦å‰è®°å½•åˆå§‹ä½™é¢
        uint256 initialTotalBalance = bidder1.balance;
        assertEq(initialTotalBalance, realValue + fakeValue);
        auction.bid{value: realValue}(realBlindedBid);
        auction.bid{value: fakeValue}(fakeBlindedBid);
        vm.stopPrank();

        // Move to reveal phase
        vm.warp(block.timestamp + BIDDING_TIME + 1); // è¿›å…¥æ­ç¤ºé˜¶æ®µ
        // å‡†å¤‡æ­ç¤ºå‚æ•°
        // Reveal both bids
        uint256[] memory values = new uint256[](2);
        bool[] memory fakes = new bool[](2);
        bytes32[] memory secrets = new bytes32[](2);
        (values[0], fakes[0], secrets[0]) = (realValue, false, realSecret);
        (values[1], fakes[1], secrets[1]) = (fakeValue, true, fakeSecret);

        uint256 initialBalance = bidder1.balance;
        assertEq(initialBalance, 0);
        vm.prank(bidder1);
        auction.reveal(values, fakes, secrets);

        // Should only place the real bid
        assertEq(auction.highestBidder(), bidder1);
        assertEq(auction.highestBid(), realValue);

        assertEq(bidder1.balance, initialTotalBalance - realValue);
    }

    // ææ¬¾åŠŸèƒ½æµ‹è¯•
    function testWithdraw() public {
        // è®¾ç½®ä¸¤ä¸ªç«æ ‡è€…
        // Setup two bidders where bidder2 outbids bidder1
        uint256 value1 = 1 ether;
        bytes32 secret1 = keccak256("secret1");
        bytes32 blindedBid1 = keccak256(abi.encodePacked(value1, false, secret1));

        uint256 value2 = 2 ether;
        bytes32 secret2 = keccak256("secret2");
        bytes32 blindedBid2 = keccak256(abi.encodePacked(value2, false, secret2));

        // æäº¤å‡ºä»·
        vm.deal(bidder1, value1);
        vm.deal(bidder2, value2);

        vm.prank(bidder1);
        auction.bid{value: value1}(blindedBid1);
        vm.prank(bidder2);
        auction.bid{value: value2}(blindedBid2);

        // Move to reveal phase and reveal
        vm.warp(block.timestamp + BIDDING_TIME + 1); // è¿›å…¥æ­ç¤ºé˜¶æ®µ
        // æ­ç¤ºå‡ºä»·
        uint256[] memory values1 = new uint256[](1);
        bool[] memory fakes1 = new bool[](1);
        bytes32[] memory secrets1 = new bytes32[](1);
        values1[0] = value1;
        fakes1[0] = false;
        secrets1[0] = secret1;
        vm.prank(bidder1);
        auction.reveal(values1, fakes1, secrets1);

        uint256[] memory values2 = new uint256[](1);
        bool[] memory fakes2 = new bool[](1);
        bytes32[] memory secrets2 = new bytes32[](1);
        values2[0] = value2;
        fakes2[0] = false;
        secrets2[0] = secret2;
        vm.prank(bidder2);
        auction.reveal(values2, fakes2, secrets2);

        // bidder1 should have pending return
        uint256 initialBalance = bidder1.balance;
        vm.prank(bidder1);
        auction.withdraw();
        assertEq(bidder1.balance, initialBalance + value1);
    }

    // ææ¬¾åŠŸèƒ½æµ‹è¯•
    function testWithdraw2() public {
        // è®¾ç½®ä¸¤ä¸ªç«æ ‡è€…
        uint256 value1 = 1 ether;
        bytes32 secret1 = keccak256("secret1");
        bytes32 blindedBid1 = keccak256(abi.encodePacked(value1, false, secret1));

        uint256 value2 = 2 ether;
        bytes32 secret2 = keccak256("secret2");
        bytes32 blindedBid2 = keccak256(abi.encodePacked(value2, false, secret2));

        // æäº¤å‡ºä»·
        vm.deal(bidder1, value1);
        vm.deal(bidder2, value2);
        vm.prank(bidder1);
        auction.bid{value: value1}(blindedBid1);
        vm.prank(bidder2);
        auction.bid{value: value2}(blindedBid2);

        vm.warp(block.timestamp + BIDDING_TIME + 1); // è¿›å…¥æ­ç¤ºé˜¶æ®µ

        // æ­ç¤ºå‡ºä»·
        vm.prank(bidder1);
        auction.reveal(_toArray(value1), _toArray(false), _toArray(secret1));
        vm.prank(bidder2);
        auction.reveal(_toArray(value2), _toArray(false), _toArray(secret2));

        // ææ¬¾éªŒè¯
        uint256 initialBalance = bidder1.balance;
        vm.prank(bidder1);
        auction.withdraw();
        assertEq(bidder1.balance, initialBalance + value1); // éªŒè¯é€€æ¬¾é‡‘é¢
    }

    function test_RevertWhen_AuctionEndBeforeRevealEnd() public {
        vm.warp(block.timestamp + BIDDING_TIME + 1);
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.TooEarly.selector, auction.revealEnd()));
        auction.auctionEnd();
    }

    // é‡å¤ç»“æŸæ‹å–æµ‹è¯•
    function test_RevertWhen_AuctionEndTwice() public {
        // Setup and complete auction
        uint256 value = 1 ether;
        bytes32 secret = keccak256("secret");
        bytes32 blindedBid = keccak256(abi.encodePacked(value, false, secret));

        vm.deal(bidder1, value);
        vm.prank(bidder1);
        auction.bid{value: value}(blindedBid);

        vm.warp(block.timestamp + BIDDING_TIME + 1);

        uint256[] memory values = new uint256[](1);
        bool[] memory fakes = new bool[](1);
        bytes32[] memory secrets = new bytes32[](1);
        values[0] = value;
        fakes[0] = false;
        secrets[0] = secret;
        vm.prank(bidder1);
        auction.reveal(values, fakes, secrets);

        // vm.warp(block.timestamp + REVEAL_TIME + 1);
        vm.warp(auction.biddingEnd() + auction.revealEnd() + 1);
        auction.auctionEnd();

        // Second call should fail
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.AuctionEndAlreadyCalled.selector));

        auction.auctionEnd();
    }

    // æ— æ•ˆæ­ç¤ºæµ‹è¯•
    function testRevealInvalidBid() public {
        // Place bid with invalid reveal data
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, "real"));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);

        // Move to reveal phase
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // Try to reveal with wrong data
        uint256[] memory values = new uint256[](1);
        bool[] memory fakes = new bool[](1);
        bytes32[] memory secrets = new bytes32[](1);
        values[0] = 1 ether;
        fakes[0] = false;
        secrets[0] = keccak256("wrong");

        uint256 initialBalance = bidder1.balance;
        vm.prank(bidder1);
        auction.reveal(values, fakes, secrets);

        // Should refund deposit but not place bid
        assertEq(auction.highestBidder(), address(0));
        assertEq(auction.highestBid(), 0);
        assertEq(bidder1.balance, initialBalance);
    }

    function testMultipleBidsSingleReveal() public {
        // è®°å½•åˆå§‹ä½™é¢
        uint256 initialTotalBalance = bidder1.balance;

        // å®šä¹‰ bytes32 ç±»å‹çš„ secret
        bytes32 secret1 = keccak256(abi.encodePacked("secret1"));
        bytes32 secret2 = keccak256(abi.encodePacked("secret2"));

        // è®¡ç®—æ­£ç¡®çš„å“ˆå¸Œå€¼
        bytes32 realBidHash = keccak256(abi.encodePacked(uint256(1 ether), false, secret1));
        bytes32 fakeBidHash = keccak256(abi.encodePacked(uint256(2 ether), true, secret2));

        // æäº¤ä¸¤ä¸ªå‡ºä»·
        vm.deal(bidder1, 3 ether);
        vm.startPrank(bidder1);
        auction.bid{value: 1 ether}(realBidHash); // çœŸå®å‡ºä»·
        auction.bid{value: 2 ether}(fakeBidHash); // è™šå‡å‡ºä»·
        vm.stopPrank();

        // ç¡®è®¤èµ„é‡‘å·²è½¬å…¥åˆçº¦
        assertEq(address(auction).balance, 3 ether, "Contract should receive 3 ether");

        // è¿›å…¥æ­ç¤ºé˜¶æ®µ
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // å‡†å¤‡æ­ç¤ºæ•°æ® - ç¡®ä¿é¡ºåºä¸å‡ºä»·ä¸€è‡´
        uint256[] memory values = new uint256[](2);
        bool[] memory fakes = new bool[](2);
        bytes32[] memory secrets = new bytes32[](2);

        // ç¬¬ä¸€ä¸ªå‡ºä»·ï¼šçœŸå®å‡ºä»·1 ETH
        values[0] = 1 ether;
        fakes[0] = false;
        secrets[0] = secret1; // ä½¿ç”¨ç›¸åŒçš„ bytes32 secret

        // ç¬¬äºŒä¸ªå‡ºä»·ï¼šè™šå‡å‡ºä»·2 ETH
        values[1] = 2 ether;
        fakes[1] = true;
        secrets[1] = secret2; // ä½¿ç”¨ç›¸åŒçš„ bytes32 secret

        // æ‰§è¡Œæ­ç¤º
        vm.prank(bidder1);
        auction.reveal(values, fakes, secrets);

        // éªŒè¯ç»“æœ
        assertEq(auction.highestBidder(), bidder1, "Highest bidder should be bidder1");
        assertEq(auction.highestBid(), 1 ether, "Highest bid should be 1 ether");

        // éªŒè¯èµ„é‡‘æµåŠ¨
        assertEq(
            bidder1.balance,
            initialTotalBalance + 2 ether, // åˆå§‹ä½™é¢ + è™šå‡å‡ºä»·é€€æ¬¾
            "Balance after reveal should include fake bid refund"
        );

        // éªŒè¯åˆçº¦é”å®šèµ„é‡‘
        assertEq(address(auction).balance, 1 ether, "Contract should keep 1 ether (real bid)");

        // éªŒè¯é”å®šèµ„é‡‘è®°å½•
        assertEq(auction.lockedFunds(bidder1), 1 ether, "Bidder1 should have 1 ether locked");
    }

    // ================ è¾¹ç•Œæ¡ä»¶æµ‹è¯• ================ //

    function testLowestPossibleBid() public {
        vm.deal(bidder1, 1 wei);
        vm.prank(bidder1);
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 wei), false, "min"));
        auction.bid{value: 1 wei}(blindedBid);

        assertEq(address(auction).balance, 1 wei);
    }

    function testInsufficientDepositForBid() public {
        uint256 value = 1 ether;
        bytes32 secret = keccak256("insufficient");
        bytes32 blindedBid = keccak256(abi.encodePacked(value, false, secret));

        vm.deal(bidder1, value - 1 wei); // Send 1 wei less than required
        vm.prank(bidder1);
        auction.bid{value: value - 1 wei}(blindedBid);

        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // Prepare reveal data
        uint256[] memory values = new uint256[](1);
        bool[] memory fakes = new bool[](1);
        bytes32[] memory secrets = new bytes32[](1);
        (values[0], fakes[0], secrets[0]) = (value, false, secret);

        vm.prank(bidder1);
        auction.reveal(values, fakes, secrets);

        // Bid should not be accepted
        assertEq(auction.highestBidder(), address(0));
        assertEq(auction.highestBid(), 0);
    }

    function testBidNotHigherThanCurrent() public {
        // Submit first bid (1 ETH)
        uint256 value1 = 1 ether;
        bytes32 secret1 = keccak256("first");
        bytes32 blindedBid1 = keccak256(abi.encodePacked(value1, false, secret1));

        // Submit second bid (0.5 ETH, lower)
        uint256 value2 = 0.5 ether;
        bytes32 secret2 = keccak256("second");
        bytes32 blindedBid2 = keccak256(abi.encodePacked(value2, false, secret2));

        vm.deal(bidder1, value1);
        vm.deal(bidder2, value2);

        vm.prank(bidder1);
        auction.bid{value: value1}(blindedBid1);
        vm.prank(bidder2);
        auction.bid{value: value2}(blindedBid2);

        // Move to reveal phase
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // Reveal first bid
        vm.prank(bidder1);
        auction.reveal(_toArray(value1), _toArray(false), _toArray(secret1));

        // Reveal second bid
        uint256 initialBalance = bidder2.balance;
        vm.prank(bidder2);
        auction.reveal(_toArray(value2), _toArray(false), _toArray(secret2));

        // Validate state
        assertEq(auction.highestBidder(), bidder1);
        assertEq(auction.highestBid(), value1);
        assertEq(bidder2.balance, initialBalance + value2); // Full refund
    }

    // ================ å¼‚å¸¸å¤„ç†æµ‹è¯• ================ //
    function testInvalidReveal() public {
        // Submit valid bid
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, "valid"));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);

        // Move to reveal phase
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // Try to reveal with invalid data
        uint256[] memory values = new uint256[](1);
        bool[] memory fakes = new bool[](1);
        bytes32[] memory secrets = new bytes32[](1);
        (values[0], fakes[0], secrets[0]) = (1 ether, false, keccak256("invalid"));

        uint256 initialBalance = bidder1.balance;
        vm.prank(bidder1);
        auction.reveal(values, fakes, secrets);

        // Should not accept invalid reveal
        assertEq(auction.highestBidder(), address(0));
        assertEq(auction.highestBid(), 0);
        assertEq(bidder1.balance, initialBalance); // Deposit remains in contract
    }

    function testWithdrawFunds() public {
        // Setup two bidders
        uint256 value1 = 1 ether;
        uint256 value2 = 2 ether;
        address loser = bidder1;
        address winner = bidder2;

        // è®°å½•åˆå§‹ä½™é¢
        uint256 initialLoserTotalBalance = loser.balance;
        uint256 initialWinnerTotalBalance = winner.balance;

        // åˆ†é…èµ„é‡‘
        vm.deal(loser, value1);
        vm.deal(winner, value2);

        vm.prank(loser);
        auction.bid{value: value1}(keccak256(abi.encodePacked(value1, false, "loser")));
        vm.prank(winner);
        auction.bid{value: value2}(keccak256(abi.encodePacked(value2, false, "winner")));

        // Reveal period
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // Reveal
        vm.prank(loser);
        auction.reveal(_toArray(value1), _toArray(false), _toArray(keccak256("loser")));
        vm.prank(winner);
        auction.reveal(_toArray(value2), _toArray(false), _toArray(keccak256("winner")));

        // æå–èµ„é‡‘
        vm.prank(loser);
        auction.withdraw();
        // éªŒè¯ç»“æœ
        assertEq(
            loser.balance,
            initialLoserTotalBalance, // åˆå§‹ä½™é¢ + å¤±è´¥è€…æå–èµ„é‡‘
            "Loser should receive full refund"
        );

        // éªŒè¯èƒœè€…æ— æ³•æå–èµ„é‡‘
        uint256 initialWinnerBalance = winner.balance;
        vm.prank(winner);
        auction.withdraw();
        assertEq(winner.balance, initialWinnerBalance, "Winner should not withdraw before auction end");
        assertEq(initialWinnerTotalBalance, winner.balance, "Winner should not withdraw before auction end");
    }

    function testWithdrawNothing() public {
        uint256 initialBalance = bidder1.balance;
        vm.prank(bidder1);
        auction.withdraw(); // Attempt to withdraw with no pending funds

        assertEq(bidder1.balance, initialBalance); // Balance unchanged
        assertEq(auction.pendingReturns(bidder1), 0); // No pending returns
    }

    // é‡å¤ç»“æŸæ‹å–æµ‹è¯•
    function test_RevertWhen_AuctionEndTwice2() public {
        // å®Œæ•´å®Œæˆæ‹å–
        _completeAuction(bidder1, 1 ether);
        vm.warp(auction.biddingEnd() + auction.revealEnd() + 1);
        auction.auctionEnd(); // ç¬¬ä¸€æ¬¡æˆåŠŸç»“æŸ

        vm.expectRevert(abi.encodeWithSelector(BlindAuction.AuctionEndAlreadyCalled.selector));
        // ç¬¬äºŒæ¬¡é¢„æœŸå¤±è´¥
        auction.auctionEnd();
    }

    // ================ æ—¶é—´å’ŒçŠ¶æ€æµ‹è¯• ================ //
    function testEarlyBidAttempt() public {
        // ä½¿ç”¨åˆçº¦çš„ç»å¯¹ç»“æŸæ—¶é—´è®¡ç®—
        uint256 biddingEnd = auction.biddingEnd();
        vm.warp(biddingEnd + 1); // ç²¾ç¡®è®¾ç½®æ—¶é—´
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, "late"));
        vm.deal(bidder1, 1 ether);

        vm.expectRevert(abi.encodeWithSelector(BlindAuction.TooLate.selector, auction.biddingEnd()));

        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);
    }

    function testEarlyRevealAttempt() public {
        // Try to reveal before bidding ends
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.TooEarly.selector, auction.biddingEnd()));

        vm.prank(bidder1);
        auction.reveal(new uint256[](0), new bool[](0), new bytes32[](0));
    }

    function testEarlyAuctionEndAttempt() public {
        // Try to end auction before reveal ends
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        vm.expectRevert(abi.encodeWithSelector(BlindAuction.TooEarly.selector, auction.revealEnd()));

        auction.auctionEnd();
    }

    function testDoubleAuctionEndAttempt() public {
        // Complete auction
        _completeAuction(bidder1, 1 ether);
        vm.warp(block.timestamp + REVEAL_TIME + 1);
        auction.auctionEnd(); // Valid end

        // Attempt to end again
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.AuctionEndAlreadyCalled.selector));
        auction.auctionEnd();
    }

    function testDoubleAuctionEndAttempt2() public {
        // Complete auction
        _completeAuction(bidder1, 1 ether);
        vm.warp(block.timestamp + REVEAL_TIME + 1);
        auction.auctionEnd(); // Valid end

        // Attempt to end again
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.AuctionEndAlreadyCalled.selector));
        auction.auctionEnd();
    }

    function testZeroValueBid() public {
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.InvalidBidReveal.selector));

        vm.prank(bidder1);
        auction.bid{value: 0}(keccak256("zero"));
    }

    function testInvalidConstructorParams() public {
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.InvalidBidReveal.selector));
        new BlindAuction(0, 0, payable(address(0)));
    }

    function testInvalidTimeParams() public {
        new BlindAuction(0, REVEAL_TIME, beneficiary); // biddingTime ä¸º 0
    }

    function testRevealWithMismatchedArrays() public {
        // Submit a bid
        bytes32 secret = keccak256("secret");
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, secret));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);

        // Move to reveal phase
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // Provide mismatched arrays
        uint256[] memory values = new uint256[](1);
        bool[] memory fakes = new bool[](2); // Length mismatch
        bytes32[] memory secrets = new bytes32[](1);
        values[0] = 1 ether;
        fakes[0] = false;
        fakes[1] = true;
        secrets[0] = secret;

        vm.prank(bidder1);
        vm.expectRevert("Fakes length mismatch"); // Match contract's error
        auction.reveal(values, fakes, secrets);
    }

    function testAuctionEndWithUnLockedFunds() public {
        // Submit a bid
        bytes32 secret = keccak256("secret");
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, secret));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);

        // Move to reveal phase and reveal the bid
        vm.warp(block.timestamp + BIDDING_TIME + 1);
        vm.prank(bidder1);
        auction.reveal(_toArray(1 ether), _toArray(false), _toArray(secret));

        // Correctly set lockedFunds[bidder1] to 0
        bytes32 slot = keccak256(abi.encode(bidder1, uint256(7))); // Slot 7 for lockedFunds
        vm.store(address(auction), slot, bytes32(0));

        // Move past reveal phase to auction end phase
        vm.warp(auction.revealEnd() + 1);
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.FundsNotLockedCorrectly.selector));
        auction.auctionEnd();
    }

    function testAuctionEndWithUnLockedFunds2() public {
        // Submit a bid
        bytes32 secret = keccak256("secret");
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, secret));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);

        // Move to reveal phase and reveal the bid
        vm.warp(block.timestamp + BIDDING_TIME + 1);
        vm.prank(bidder1);
        auction.reveal(_toArray(1 ether), _toArray(false), _toArray(secret));

        // éªŒè¯é”å®šèµ„é‡‘æ˜¯å¦æ­£ç¡®è®¾ç½®
        assertEq(auction.lockedFunds(bidder1), 1 ether, "Funds should be locked initially");

        // æ‰‹åŠ¨ä¿®æ”¹é”å®šèµ„é‡‘ä¸º0ï¼ˆæ¨¡æ‹Ÿæœªé”å®šçŠ¶æ€ï¼‰
        bytes32 slot = keccak256(abi.encode(bidder1, uint256(7))); // Slot 7 for lockedFunds
        vm.store(address(auction), slot, bytes32(0));
        assertEq(auction.lockedFunds(bidder1), 0, "Funds should be unlocked after manipulation");

        // Move past reveal phase to auction end phase
        vm.warp(auction.revealEnd() + 1);

        // ä¿®æ”¹ä¸ºæ£€æŸ¥è‡ªå®šä¹‰é”™è¯¯
        vm.expectRevert(abi.encodeWithSelector(BlindAuction.FundsNotLockedCorrectly.selector));
        auction.auctionEnd();
    }

    // æµ‹è¯• reveal å‡½æ•°ä¸­ bidToCheck.blindedBid ä¸åŒ¹é…çš„æƒ…å†µ
    function testRevealWithNonMatchingBid() public {
        bytes32 secret = keccak256("secret");
        bytes32 blindedBid = keccak256(abi.encodePacked(uint256(1 ether), false, secret));
        vm.deal(bidder1, 1 ether);
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(blindedBid);

        // è¿›å…¥æ­ç¤ºé˜¶æ®µ
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // ä½¿ç”¨ä¸åŒ¹é…çš„ç§˜å¯†æ­ç¤º
        bytes32 wrongSecret = keccak256("wrong");
        vm.prank(bidder1);
        auction.reveal(_toArray(1 ether), _toArray(false), _toArray(wrongSecret));

        // éªŒè¯å‡ºä»·æ²¡æœ‰è¢«æ¥å—
        assertEq(auction.highestBid(), 0);
        assertEq(auction.highestBidder(), address(0));
    }

    // æµ‹è¯•æœ€å¤§å¯èƒ½çš„å‡ºä»·
    function testMaximumBid() public {
        uint256 maxBid = type(uint256).max;
        bytes32 secret = keccak256("max");
        bytes32 blindedBid = keccak256(abi.encodePacked(maxBid, false, secret));

        vm.deal(bidder1, maxBid);
        vm.prank(bidder1);
        auction.bid{value: maxBid}(blindedBid);

        // è¿›å…¥æ­ç¤ºé˜¶æ®µ
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // æ­ç¤ºå‡ºä»·
        vm.prank(bidder1);
        auction.reveal(_toArray(maxBid), _toArray(false), _toArray(secret));

        // éªŒè¯
        assertEq(auction.highestBid(), maxBid);
        assertEq(auction.highestBidder(), bidder1);
    }

    // æµ‹è¯•åˆšå¥½ç­‰äºå½“å‰æœ€é«˜å‡ºä»·çš„æƒ…å†µ
    function testBidEqualToCurrent() public {
        // å‡†å¤‡é˜¶æ®µ
        bytes32 secret1 = keccak256("secret1");
        bytes32 secret2 = keccak256("secret2");

        // åˆå§‹èµ„é‡‘åˆ†é…
        vm.deal(bidder1, 1 ether);
        vm.deal(bidder2, 1 ether);

        // è®°å½•åˆå§‹ä½™é¢
        uint256 initialBidder2Balance = bidder2.balance;
        assertEq(initialBidder2Balance, 1 ether, "Bidder2 should start with 1 ETH");

        // ç¬¬ä¸€é˜¶æ®µï¼šbidder1 æäº¤å‡ºä»·
        vm.prank(bidder1);
        auction.bid{value: 1 ether}(keccak256(abi.encodePacked(uint256(1 ether), false, secret1)));

        // ç¬¬äºŒé˜¶æ®µï¼šbidder2 æäº¤ç›¸åŒé‡‘é¢çš„å‡ºä»·
        vm.prank(bidder2);
        auction.bid{value: 1 ether}(keccak256(abi.encodePacked(uint256(1 ether), false, secret2)));

        // è¿›å…¥æ­ç¤ºé˜¶æ®µ
        vm.warp(block.timestamp + BIDDING_TIME + 1);

        // æ­ç¤º bidder1 çš„å‡ºä»·
        vm.prank(bidder1);
        auction.reveal(_toArray(1 ether), _toArray(false), _toArray(secret1));

        // æ­ç¤º bidder2 çš„å‡ºä»·
        uint256 bidder2BalanceBeforeReveal = bidder2.balance;
        assertEq(bidder2BalanceBeforeReveal, 0);
        vm.prank(bidder2);
        auction.reveal(_toArray(1 ether), _toArray(false), _toArray(secret2));

        // éªŒè¯çŠ¶æ€
        assertEq(auction.highestBid(), 1 ether, "Highest bid should be 1 ether");
        assertEq(auction.highestBidder(), bidder1, "Highest bidder should be bidder1");

        // éªŒè¯ bidder2 çš„èµ„é‡‘æµåŠ¨
        assertEq(
            bidder2.balance,
            initialBidder2Balance, // 1 ETH (åˆå§‹) - 1 ETH (å‡ºä»·) + 1 ETH (é€€è¿˜) = 1 ETH
            "Bidder2 should have their initial balance restored"
        );

        // éªŒè¯åˆçº¦èµ„é‡‘
        assertEq(
            address(auction).balance,
            1 ether, // åªé”å®š bidder1 çš„ 1 ETH
            "Contract should keep only the winning bid"
        );
    }

    // ================ è¾…åŠ©å‡½æ•° ================ //

    function _completeAuction(address bidder, uint256 amount) private {
        bytes32 secret = keccak256("secret");
        bytes32 blindedBid = keccak256(abi.encodePacked(amount, false, secret));

        vm.deal(bidder, amount);
        vm.prank(bidder);
        auction.bid{value: amount}(blindedBid);

        vm.warp(block.timestamp + BIDDING_TIME + 1);
        vm.prank(bidder);
        auction.reveal(_toArray(amount), _toArray(false), _toArray(secret));
    }

    // è¾…åŠ©å‡½æ•°ï¼šå•å€¼è½¬æ•°ç»„
    function _toArray(uint256 value) private pure returns (uint256[] memory) {
        uint256[] memory arr = new uint256[](1);
        arr[0] = value;
        return arr;
    }

    function _toArray(bool value) private pure returns (bool[] memory) {
        bool[] memory arr = new bool[](1);
        arr[0] = value;
        return arr;
    }

    function _toArray(bytes32 value) private pure returns (bytes32[] memory) {
        bytes32[] memory arr = new bytes32[](1);
        arr[0] = value;
        return arr;
    }
}

```

### ç¬¬äºŒæ­¥ï¼šæ ¼å¼åŒ–

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ forge fmt                     
```

### ç¬¬ä¸‰æ­¥ï¼šç¼–è¯‘æ„å»º

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ forge build
[â Š] Compiling...
[â ‘] Compiling 2 files with Solc 0.8.30
[â ˜] Solc 0.8.30 finished in 4.68s
Compiler run successful!
```

### ç¬¬å››æ­¥ï¼šè¿è¡Œæµ‹è¯•

#### ğŸ” å‘½ä»¤ç»„æˆ

`forge test --match-path test/BlindAuction.t.sol --show-progress -vv`

|                  å‚æ•°                  |             ä½œç”¨             |
| :------------------------------------: | :--------------------------: |
| `--match-path test/BlindAuction.t.sol` |      åªè¿è¡ŒæŒ‡å®šæµ‹è¯•æ–‡ä»¶      |
|           `--show-progress`            |      æ˜¾ç¤ºå®æ—¶æµ‹è¯•è¿›åº¦æ¡      |
|                 `-vv`                  | äºŒçº§è¯¦ç»†è¾“å‡ºï¼ˆæ˜¾ç¤ºæµ‹è¯•æ—¥å¿—ï¼‰ |

#### `-vv` è¯¦ç»†çº§åˆ«

| ç­‰çº§ |  å‚æ•°   |      è¾“å‡ºå†…å®¹       |
| :--: | :-----: | :-----------------: |
|  0   | (é»˜è®¤)  |   ä»…æ˜¾ç¤ºæµ‹è¯•ç»“æœ    |
|  1   |  `-v`   | + æµ‹è¯•åç§°å’Œgasæ¶ˆè€— |
|  2   |  `-vv`  | + æµ‹è¯•ä¸­çš„æ—¥å¿—äº‹ä»¶  |
|  3   | `-vvv`  |     + è°ƒç”¨è·Ÿè¸ª      |
|  4   | `-vvvv` |   + æ‰€æœ‰EVMæ“ä½œç    |

#### å®æ“æµ‹è¯•

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) took 5.4s 
âœ forge test --match-path test/BlindAuction.t.sol --show-progress -vv
[â Š] Compiling...
No files changed, compilation skipped
test/BlindAuction.t.sol:BlindAuctionTest
  â†ª Suite result: ok. 35 passed; 0 failed; 0 skipped; finished in 2.18ms (8.25ms CPU time)

Ran 35 tests for test/BlindAuction.t.sol:BlindAuctionTest
[PASS] testAuctionEndWithUnLockedFunds() (gas: 170279)
[PASS] testAuctionEndWithUnLockedFunds2() (gas: 174449)
[PASS] testBidBeforeEnd() (gas: 88215)
[PASS] testBidEqualToCurrent() (gas: 244936)
[PASS] testBidNotHigherThanCurrent() (gas: 241619)
[PASS] testContractInitialization() (gas: 22742)
[PASS] testDoubleAuctionEndAttempt() (gas: 205465)
[PASS] testDoubleAuctionEndAttempt2() (gas: 206037)
[PASS] testEarlyAuctionEndAttempt() (gas: 12730)
[PASS] testEarlyBidAttempt() (gas: 23932)
[PASS] testEarlyRevealAttempt() (gas: 15961)
[PASS] testInitialState() (gas: 23270)
[PASS] testInsufficientDepositForBid() (gas: 114082)
[PASS] testInvalidConstructorParams() (gas: 36681)
[PASS] testInvalidReveal() (gas: 103195)
[PASS] testInvalidTimeParams() (gas: 563733)
[PASS] testLowestPossibleBid() (gas: 88618)
[PASS] testMaximumBid() (gas: 145588)
[PASS] testMultipleBidsSingleReveal() (gas: 220472)
[PASS] testRevealInvalidBid() (gas: 102865)
[PASS] testRevealSingleBid() (gas: 145732)
[PASS] testRevealSingleValidBid() (gas: 145094)
[PASS] testRevealWithFakeBid() (gas: 214187)
[PASS] testRevealWithMismatchedArrays() (gas: 94287)
[PASS] testRevealWithNonMatchingBid() (gas: 101956)
[PASS] testValidBid() (gas: 88699)
[PASS] testWithdraw() (gas: 265392)
[PASS] testWithdraw2() (gas: 265592)
[PASS] testWithdrawFunds() (gas: 191965)
[PASS] testWithdrawNothing() (gas: 17560)
[PASS] testZeroValueBid() (gas: 14224)
[PASS] test_RevertWhen_AuctionEndBeforeRevealEnd() (gas: 12344)
[PASS] test_RevertWhen_AuctionEndTwice() (gas: 207804)
[PASS] test_RevertWhen_AuctionEndTwice2() (gas: 207373)
[PASS] test_RevertWhen_BidAfterBiddingEnd() (gas: 23782)
Suite result: ok. 35 passed; 0 failed; 0 skipped; finished in 2.18ms (8.25ms CPU time)

Ran 1 test suite in 142.20ms (2.18ms CPU time): 35 tests passed, 0 failed, 0 skipped (35 total tests)


```

### ç¬¬äº”æ­¥ï¼šæŸ¥çœ‹æ™ºèƒ½åˆçº¦æµ‹è¯•è¦†ç›–ç‡

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ forge coverage                                                     
Warning: optimizer settings and `viaIR` have been disabled for accurate coverage reports.
If you encounter "stack too deep" errors, consider using `--ir-minimum` which enables `viaIR` with minimum optimization resolving most of the errors
[â Š] Compiling...
[â ‘] Compiling 22 files with Solc 0.8.30
[â ˜] Solc 0.8.30 finished in 1.65s
Compiler run successful!
Analysing contracts...
Running tests...

Ran 35 tests for test/BlindAuction.t.sol:BlindAuctionTest
[PASS] testAuctionEndWithUnLockedFunds() (gas: 175316)
[PASS] testAuctionEndWithUnLockedFunds2() (gas: 181065)
[PASS] testBidBeforeEnd() (gas: 88940)
[PASS] testBidEqualToCurrent() (gas: 253921)
[PASS] testBidNotHigherThanCurrent() (gas: 249468)
[PASS] testContractInitialization() (gas: 25174)
[PASS] testDoubleAuctionEndAttempt() (gas: 210338)
[PASS] testDoubleAuctionEndAttempt2() (gas: 210360)
[PASS] testEarlyAuctionEndAttempt() (gas: 13287)
[PASS] testEarlyBidAttempt() (gas: 25533)
[PASS] testEarlyRevealAttempt() (gas: 17071)
[PASS] testInitialState() (gas: 25152)
[PASS] testInsufficientDepositForBid() (gas: 118696)
[PASS] testInvalidConstructorParams() (gas: 38832)
[PASS] testInvalidReveal() (gas: 106754)
[PASS] testInvalidTimeParams() (gas: 1261059)
[PASS] testLowestPossibleBid() (gas: 88984)
[PASS] testMaximumBid() (gas: 149529)
[PASS] testMultipleBidsSingleReveal() (gas: 229644)
[PASS] testRevealInvalidBid() (gas: 106739)
[PASS] testRevealSingleBid() (gas: 149516)
[PASS] testRevealSingleValidBid() (gas: 149476)
[PASS] testRevealWithFakeBid() (gas: 221561)
[PASS] testRevealWithMismatchedArrays() (gas: 97317)
[PASS] testRevealWithNonMatchingBid() (gas: 105808)
[PASS] testValidBid() (gas: 88961)
[PASS] testWithdraw() (gas: 272707)
[PASS] testWithdraw2() (gas: 272942)
[PASS] testWithdrawFunds() (gas: 198804)
[PASS] testWithdrawNothing() (gas: 18989)
[PASS] testZeroValueBid() (gas: 13986)
[PASS] test_RevertWhen_AuctionEndBeforeRevealEnd() (gas: 13244)
[PASS] test_RevertWhen_AuctionEndTwice() (gas: 212700)
[PASS] test_RevertWhen_AuctionEndTwice2() (gas: 212603)
[PASS] test_RevertWhen_BidAfterBiddingEnd() (gas: 24601)
Suite result: ok. 35 passed; 0 failed; 0 skipped; finished in 2.82ms (14.73ms CPU time)

Ran 1 test for script/BlindAuction.s.sol:BlindAuctionScriptTest
[PASS] testDeployScript() (gas: 2910346)
Suite result: ok. 1 passed; 0 failed; 0 skipped; finished in 3.00ms (2.26ms CPU time)

Ran 2 test suites in 142.51ms (5.82ms CPU time): 36 tests passed, 0 failed, 0 skipped (36 total tests)

â•­---------------------------+-----------------+----------------+----------------+-----------------â•®
| File                      | % Lines         | % Statements   | % Branches     | % Funcs         |
+=================================================================================================+
| script/BlindAuction.s.sol | 100.00% (9/9)   | 100.00% (7/7)  | 100.00% (0/0)  | 100.00% (2/2)   |
|---------------------------+-----------------+----------------+----------------+-----------------|
| src/BlindAuction.sol      | 100.00% (56/56) | 98.33% (59/60) | 76.00% (19/25) | 100.00% (8/8)   |
|---------------------------+-----------------+----------------+----------------+-----------------|
| Total                     | 100.00% (65/65) | 98.51% (66/67) | 76.00% (19/25) | 100.00% (10/10) |
â•°---------------------------+-----------------+----------------+----------------+-----------------â•¯

```

### ç¬¬å…­æ­¥ï¼šç”Ÿæˆ**ç²¾ç®€ç‰ˆè¦†ç›–ç‡æ‘˜è¦æŠ¥å‘Š**

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) took 2.1s 
âœ forge coverage --report summary
Warning: optimizer settings and `viaIR` have been disabled for accurate coverage reports.
If you encounter "stack too deep" errors, consider using `--ir-minimum` which enables `viaIR` with minimum optimization resolving most of the errors
[â Š] Compiling...
[â ‘] Compiling 22 files with Solc 0.8.30
[â ƒ] Solc 0.8.30 finished in 1.71s
Compiler run successful!
Analysing contracts...
Running tests...

Ran 1 test for script/BlindAuction.s.sol:BlindAuctionScriptTest
[PASS] testDeployScript() (gas: 2910346)
Suite result: ok. 1 passed; 0 failed; 0 skipped; finished in 6.91ms (3.04ms CPU time)

Ran 35 tests for test/BlindAuction.t.sol:BlindAuctionTest
[PASS] testAuctionEndWithUnLockedFunds() (gas: 175316)
[PASS] testAuctionEndWithUnLockedFunds2() (gas: 181065)
[PASS] testBidBeforeEnd() (gas: 88940)
[PASS] testBidEqualToCurrent() (gas: 253921)
[PASS] testBidNotHigherThanCurrent() (gas: 249468)
[PASS] testContractInitialization() (gas: 25174)
[PASS] testDoubleAuctionEndAttempt() (gas: 210338)
[PASS] testDoubleAuctionEndAttempt2() (gas: 210360)
[PASS] testEarlyAuctionEndAttempt() (gas: 13287)
[PASS] testEarlyBidAttempt() (gas: 25533)
[PASS] testEarlyRevealAttempt() (gas: 17071)
[PASS] testInitialState() (gas: 25152)
[PASS] testInsufficientDepositForBid() (gas: 118696)
[PASS] testInvalidConstructorParams() (gas: 38832)
[PASS] testInvalidReveal() (gas: 106754)
[PASS] testInvalidTimeParams() (gas: 1261059)
[PASS] testLowestPossibleBid() (gas: 88984)
[PASS] testMaximumBid() (gas: 149529)
[PASS] testMultipleBidsSingleReveal() (gas: 229644)
[PASS] testRevealInvalidBid() (gas: 106739)
[PASS] testRevealSingleBid() (gas: 149516)
[PASS] testRevealSingleValidBid() (gas: 149476)
[PASS] testRevealWithFakeBid() (gas: 221561)
[PASS] testRevealWithMismatchedArrays() (gas: 97317)
[PASS] testRevealWithNonMatchingBid() (gas: 105808)
[PASS] testValidBid() (gas: 88961)
[PASS] testWithdraw() (gas: 272707)
[PASS] testWithdraw2() (gas: 272942)
[PASS] testWithdrawFunds() (gas: 198804)
[PASS] testWithdrawNothing() (gas: 18989)
[PASS] testZeroValueBid() (gas: 13986)
[PASS] test_RevertWhen_AuctionEndBeforeRevealEnd() (gas: 13244)
[PASS] test_RevertWhen_AuctionEndTwice() (gas: 212700)
[PASS] test_RevertWhen_AuctionEndTwice2() (gas: 212603)
[PASS] test_RevertWhen_BidAfterBiddingEnd() (gas: 24601)
Suite result: ok. 35 passed; 0 failed; 0 skipped; finished in 7.21ms (24.18ms CPU time)

Ran 2 test suites in 162.36ms (14.12ms CPU time): 36 tests passed, 0 failed, 0 skipped (36 total tests)

â•­---------------------------+-----------------+----------------+----------------+-----------------â•®
| File                      | % Lines         | % Statements   | % Branches     | % Funcs         |
+=================================================================================================+
| script/BlindAuction.s.sol | 100.00% (9/9)   | 100.00% (7/7)  | 100.00% (0/0)  | 100.00% (2/2)   |
|---------------------------+-----------------+----------------+----------------+-----------------|
| src/BlindAuction.sol      | 100.00% (56/56) | 98.33% (59/60) | 76.00% (19/25) | 100.00% (8/8)   |
|---------------------------+-----------------+----------------+----------------+-----------------|
| Total                     | 100.00% (65/65) | 98.51% (66/67) | 76.00% (19/25) | 100.00% (10/10) |
â•°---------------------------+-----------------+----------------+----------------+-----------------â•¯

```

### ç¬¬ä¸ƒæ­¥ï¼šç”ŸæˆLCOVæ ¼å¼çš„è¯¦ç»†æµ‹è¯•æŠ¥å‘Š

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ forge coverage --report lcov 
Warning: optimizer settings and `viaIR` have been disabled for accurate coverage reports.
If you encounter "stack too deep" errors, consider using `--ir-minimum` which enables `viaIR` with minimum optimization resolving most of the errors
[â Š] Compiling...
[â ‘] Compiling 22 files with Solc 0.8.30
[â ˜] Solc 0.8.30 finished in 1.67s
Compiler run successful!
Analysing contracts...
Running tests...

Ran 1 test for script/BlindAuction.s.sol:BlindAuctionScriptTest
[PASS] testDeployScript() (gas: 2910346)
Suite result: ok. 1 passed; 0 failed; 0 skipped; finished in 6.43ms (2.30ms CPU time)

Ran 35 tests for test/BlindAuction.t.sol:BlindAuctionTest
[PASS] testAuctionEndWithUnLockedFunds() (gas: 175316)
[PASS] testAuctionEndWithUnLockedFunds2() (gas: 181065)
[PASS] testBidBeforeEnd() (gas: 88940)
[PASS] testBidEqualToCurrent() (gas: 253921)
[PASS] testBidNotHigherThanCurrent() (gas: 249468)
[PASS] testContractInitialization() (gas: 25174)
[PASS] testDoubleAuctionEndAttempt() (gas: 210338)
[PASS] testDoubleAuctionEndAttempt2() (gas: 210360)
[PASS] testEarlyAuctionEndAttempt() (gas: 13287)
[PASS] testEarlyBidAttempt() (gas: 25533)
[PASS] testEarlyRevealAttempt() (gas: 17071)
[PASS] testInitialState() (gas: 25152)
[PASS] testInsufficientDepositForBid() (gas: 118696)
[PASS] testInvalidConstructorParams() (gas: 38832)
[PASS] testInvalidReveal() (gas: 106754)
[PASS] testInvalidTimeParams() (gas: 1261059)
[PASS] testLowestPossibleBid() (gas: 88984)
[PASS] testMaximumBid() (gas: 149529)
[PASS] testMultipleBidsSingleReveal() (gas: 229644)
[PASS] testRevealInvalidBid() (gas: 106739)
[PASS] testRevealSingleBid() (gas: 149516)
[PASS] testRevealSingleValidBid() (gas: 149476)
[PASS] testRevealWithFakeBid() (gas: 221561)
[PASS] testRevealWithMismatchedArrays() (gas: 97317)
[PASS] testRevealWithNonMatchingBid() (gas: 105808)
[PASS] testValidBid() (gas: 88961)
[PASS] testWithdraw() (gas: 272707)
[PASS] testWithdraw2() (gas: 272942)
[PASS] testWithdrawFunds() (gas: 198804)
[PASS] testWithdrawNothing() (gas: 18989)
[PASS] testZeroValueBid() (gas: 13986)
[PASS] test_RevertWhen_AuctionEndBeforeRevealEnd() (gas: 13244)
[PASS] test_RevertWhen_AuctionEndTwice() (gas: 212700)
[PASS] test_RevertWhen_AuctionEndTwice2() (gas: 212603)
[PASS] test_RevertWhen_BidAfterBiddingEnd() (gas: 24601)
Suite result: ok. 35 passed; 0 failed; 0 skipped; finished in 6.67ms (18.18ms CPU time)

Ran 2 test suites in 151.92ms (13.10ms CPU time): 36 tests passed, 0 failed, 0 skipped (36 total tests)
Wrote LCOV report.

```

### ç¬¬å…«æ­¥ï¼šåˆ›å»ºHTMLæŠ¥å‘Š

å°† `lcov.info` æ ¼å¼çš„è¦†ç›–ç‡æ•°æ®è½¬æ¢ä¸º **å¯äº¤äº’çš„HTMLæŠ¥å‘Š**ï¼Œè¾“å‡ºåˆ° `coverage_report` ç›®å½•ã€‚

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) took 2.2s 
âœ genhtml lcov.info -o coverage_report # brew install lcov

Reading tracefile lcov.info.
Found 2 entries.
Found common filename prefix "/Users/qiaopengjun/Code/Sonic/BlindAuction"
Generating output.
Processing file src/BlindAuction.sol
  lines=56 hit=56 functions=8 hit=8
Processing file script/BlindAuction.s.sol
  lines=9 hit=9 functions=2 hit=2
Overall coverage rate:
  source files: 2
  lines.......: 100.0% (65 of 65 lines)
  functions...: 100.0% (10 of 10 functions)
Message summary:
  no messages were reported

```

### ç¬¬ä¹æ­¥ï¼šæŸ¥çœ‹æŠ¥å‘Š

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ open coverage_report/index.html
```

![image-20250607212439890](/images/image-20250607212439890.png)

##### æ¨èç”¨æ³•

```bash
# ç»„åˆå‘½ä»¤ï¼šç”ŸæˆLCOVå¹¶ç«‹å³è½¬æ¢ä¸ºHTML
forge coverage --report lcov && genhtml lcov.info -o coverage && open coverage/index.html
```

å¯ä»¥çœ‹åˆ°æµ‹è¯•è¦†ç›–ç‡å®Œç¾å®ç°100%è¦†ç›–ï¼

## éƒ¨ç½²åˆçº¦

### ç¬¬ä¸€æ­¥ï¼šå®ç°éƒ¨ç½²è„šæœ¬ `src/BlindAuction.sol`

```ts
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.30;

import {Script, console} from "forge-std/Script.sol";
import {BlindAuction} from "../src/BlindAuction.sol";
import {Test} from "forge-std/Test.sol";

contract BlindAuctionScript is Script {
    BlindAuction public auction;

    function setUp() public {}

    function run() public {
        // 1. åŠ è½½é…ç½®
        uint256 deployerPrivateKey = vm.envUint("PRIVATE_KEY");
        address beneficiary = vm.addr(deployerPrivateKey);
        uint256 biddingTime = 1 hours;
        uint256 revealTime = 1 hours;
        // 2. éƒ¨ç½²åˆçº¦
        vm.startBroadcast(deployerPrivateKey);

        auction = new BlindAuction(biddingTime, revealTime, payable(beneficiary));
        console.log("BlindAuction deployed at:", address(auction));

        vm.stopBroadcast();

        // 3. å†™å…¥éƒ¨ç½²ä¿¡æ¯åˆ°æ–‡ä»¶
        string memory path = "./deployments/BlindAuction.json";
        string memory finalJson = string.concat(
            "{",
            "\"deploy\": {",
            "\"address\": \"",
            vm.toString(address(auction)),
            "\",",
            "\"chainId\": ",
            vm.toString(block.chainid),
            ",",
            "\"beneficiary\": \"",
            vm.toString(beneficiary),
            "\",",
            "\"config\": {",
            "\"time\": \"",
            vm.toString(biddingTime),
            ",",
            vm.toString(revealTime),
            "\"" "}",
            "}",
            "}"
        );
        vm.writeJson(finalJson, path);
        console.log("Deployment info saved to: %s", path);
    }
}

// åœ¨ BlindAuction.s.sol ä¸­æ·»åŠ æµ‹è¯•
contract BlindAuctionScriptTest is Test {
    function testDeployScript() public {
        // æ¨¡æ‹Ÿéƒ¨ç½²è„šæœ¬æ‰§è¡Œ
        BlindAuctionScript script = new BlindAuctionScript();
        script.setUp();
        script.run();

        // éªŒè¯åˆçº¦éƒ¨ç½²æˆåŠŸ
        assertTrue(address(script.auction()) != address(0));
    }
}

```

### ç¬¬äºŒæ­¥ï¼š.env ç¯å¢ƒå˜é‡æ–‡ä»¶

```bash
PRIVATE_KEY=
HOODI_RPC_URL=https://eth-hoodi.g.alchemy.com/v2/
SONIC_RPC_URL=https://sonic-blaze.g.alchemy.com/v2/

ETHERSCAN_API_KEY=
SONICSCAN_API_KEY=
RPC_URL=https://rpc.blaze.soniclabs.com
ACCOUNT_ADDRESS=

LOCAL_RPC_URL=http://127.0.0.1:8545
LOCAL_PRIVATE_KEY=0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
```

### ç¬¬ä¸‰æ­¥ï¼šFoundry.toml é…ç½®æ–‡ä»¶

```toml
[profile.default]
src = "src"
out = "out"
libs = ["lib"]
solc = "0.8.30"
# See more config options https://github.com/foundry-rs/foundry/blob/master/crates/config/README.md#all-options
optimizer = true
optimizer_runs = 200
build_info = true
extra_output = ["storageLayout"]
fs_permissions = [{ access = "read-write", path = "./" }]
gas_reports = ["*"]
via_ir = true
evm_version = "cancun"

[rpc_endpoints]
hoodi = "${HOODI_RPC_URL}"
sonic = "${SONIC_RPC_URL}"
local = "${LOCAL_RPC_URL}"  

[etherscan]
hoodi = { key = "${ETHERSCAN_API_KEY}" }
sonic = { key = "${SONICSCAN_API_KEY}" }

[profile.ci.fuzz]
runs = 10_000

```

### ç¬¬å››æ­¥ï¼šå¯åŠ¨æœ¬åœ°èŠ‚ç‚¹

`anvil` æ˜¯ **ä¸€é”®å¯åŠ¨æœ¬åœ°ä»¥å¤ªåŠå¼€å‘èŠ‚ç‚¹**ï¼Œé»˜è®¤ç«¯å£ `8545`ï¼Œé¢„è£…æµ‹è¯•è´¦æˆ·å’Œæ— é™ETHï¼Œä¸“ä¸ºæ™ºèƒ½åˆçº¦å¼€å‘å’Œè°ƒè¯•è®¾è®¡ã€‚ğŸš€

```bash
anvil


                             _   _
                            (_) | |
      __ _   _ __   __   __  _  | |
     / _` | | '_ \  \ \ / / | | | |
    | (_| | | | | |  \ V /  | | | |
     \__,_| |_| |_|   \_/   |_| |_|

    1.2.2-stable (73ac79f067 2025-06-01T14:56:45.336809000Z)
    *************************************

Available Accounts
==================

(0) 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000.000000000000000000 ETH)
(1) 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (10000.000000000000000000 ETH)
(2) 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC (10000.000000000000000000 ETH)
(3) 0x90F79bf6EB2c4f870365E785982E1f101E93b906 (10000.000000000000000000 ETH)
(4) 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 (10000.000000000000000000 ETH)
(5) 0x9965507D1a55bcC2695C58ba16FB37d819B0A4dc (10000.000000000000000000 ETH)
(6) 0x976EA74026E726554dB657fA54763abd0C3a0aa9 (10000.000000000000000000 ETH)
(7) 0x14dC79964da2C08b23698B3D3cc7Ca32193d9955 (10000.000000000000000000 ETH)
(8) 0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f (10000.000000000000000000 ETH)
(9) 0xa0Ee7A142d267C1f36714E4a8F75612F20a79720 (10000.000000000000000000 ETH)

Private Keys
==================

(0) ******************************************************************
(1) ******************************************************************
(2) ******************************************************************
(3) ******************************************************************
(4) ******************************************************************
(5) ******************************************************************
(6) ******************************************************************
(7) ******************************************************************
(8) ******************************************************************
(9) ******************************************************************

Wallet
==================
Mnemonic:          test test test test test test test test test test test junk
Derivation path:   m/44'/60'/0'/0/


Chain ID
==================

31337

Base Fee
==================

1000000000

Gas Limit
==================

30000000

Genesis Timestamp
==================

1749355398

Genesis Number
==================

0

Listening on *********:8545

```

### ç¬¬äº”æ­¥ï¼šæœ¬åœ°éƒ¨ç½²åˆçº¦

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ source .env     

BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ forge clean && forge build                                                  
[â Š] Compiling...
[â ¢] Compiling 22 files with Solc 0.8.30
[â ”] Solc 0.8.30 finished in 6.27s
Compiler run successful!

BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) took 6.8s 
âœ forge script BlindAuctionScript --rpc-url $LOCAL_RPC_URL --broadcast -vvvvv 
[â Š] Compiling...
No files changed, compilation skipped
Traces:
  [132] BlindAuctionScript::setUp()
    â””â”€ â† [Stop]

  [580049] BlindAuctionScript::run()
    â”œâ”€ [0] VM::envUint("LOCAL_PRIVATE_KEY") [staticcall]
    â”‚   â””â”€ â† [Return] <env var value>
    â”œâ”€ [0] VM::addr(<pk>) [staticcall]
    â”‚   â””â”€ â† [Return] 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
    â”œâ”€ [0] VM::startBroadcast(<pk>)
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [528230] â†’ new BlindAuction@0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
    â”‚   â””â”€ â† [Return] 2305 bytes of code
    â”œâ”€ [0] console::log("BlindAuction deployed at:", BlindAuction: [0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0]) [staticcall]
    â”‚   â””â”€ â† [Stop]
    â”œâ”€ [0] VM::stopBroadcast()
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [0] VM::toString(BlindAuction: [0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0]) [staticcall]
    â”‚   â””â”€ â† [Return] "0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0"
    â”œâ”€ [0] VM::toString(31337 [3.133e4]) [staticcall]
    â”‚   â””â”€ â† [Return] "31337"
    â”œâ”€ [0] VM::toString(0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266) [staticcall]
    â”‚   â””â”€ â† [Return] "0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266"
    â”œâ”€ [0] VM::toString(3600) [staticcall]
    â”‚   â””â”€ â† [Return] "3600"
    â”œâ”€ [0] VM::toString(3600) [staticcall]
    â”‚   â””â”€ â† [Return] "3600"
    â”œâ”€ [0] VM::writeJson("{\"deploy\": {\"address\": \"0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0\",\"chainId\": 31337,\"beneficiary\": \"0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\",\"config\": {\"time\": \"3600,3600\"}}}", "./deployments/BlindAuction.json")
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [0] console::log("Deployment info saved to: %s", "./deployments/BlindAuction.json") [staticcall]
    â”‚   â””â”€ â† [Stop]
    â””â”€ â† [Return]


Script ran successfully.

== Logs ==
  BlindAuction deployed at: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
  Deployment info saved to: ./deployments/BlindAuction.json

## Setting up 1 EVM.
==========================
Simulated On-chain Traces:

  [528230] â†’ new BlindAuction@0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
    â””â”€ â† [Return] 2305 bytes of code


==========================

Chain 31337

Estimated gas price: 1.760361369 gwei

Estimated total gas used for script: 808186

Estimated amount required: 0.001422699413366634 ETH

==========================

##### anvil-hardhat
âœ…  [Success] Hash: 0x79712641ba70bd6fd8b77906b810413827ec2b40d84fb45f6976968be210ae31
Contract Address: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
Block: 3
Paid: 0.000481628258678234 ETH (621682 gas * 0.774718037 gwei)

âœ… Sequence #1 on anvil-hardhat | Total Paid: 0.000481628258678234 ETH (621682 gas * avg 0.774718037 gwei)
                                                                                                                 

==========================

ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.

Transactions saved to: /Users/qiaopengjun/Code/Sonic/BlindAuction/broadcast/BlindAuction.s.sol/31337/run-latest.json

Sensitive values saved to: /Users/qiaopengjun/Code/Sonic/BlindAuction/cache/BlindAuction.s.sol/31337/run-latest.json

```

æœ¬åœ°éƒ¨ç½²åˆçº¦æˆåŠŸï¼

### ç¬¬å…­æ­¥ï¼šHoodi æµ‹è¯•ç½‘éƒ¨ç½²

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) took 8.6s 
âœ forge build                                                                          
[â ’] Compiling...
No files changed, compilation skipped

BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ source .env                                                                          

BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ forge script BlindAuctionScript --rpc-url $HOODI_RPC_URL --broadcast --verify -vvvvv 
[â Š] Compiling...
No files changed, compilation skipped
Traces:
  [132] BlindAuctionScript::setUp()
    â””â”€ â† [Stop]

  [580049] BlindAuctionScript::run()
    â”œâ”€ [0] VM::envUint("PRIVATE_KEY") [staticcall]
    â”‚   â””â”€ â† [Return] <env var value>
    â”œâ”€ [0] VM::addr(<pk>) [staticcall]
    â”‚   â””â”€ â† [Return] 0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5
    â”œâ”€ [0] VM::startBroadcast(<pk>)
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [528230] â†’ new BlindAuction@0x62E00a47aB4444f0bF39bB9047ced14A02022517
    â”‚   â””â”€ â† [Return] 2305 bytes of code
    â”œâ”€ [0] console::log("BlindAuction deployed at:", BlindAuction: [0x62E00a47aB4444f0bF39bB9047ced14A02022517]) [staticcall]
    â”‚   â””â”€ â† [Stop]
    â”œâ”€ [0] VM::stopBroadcast()
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [0] VM::toString(BlindAuction: [0x62E00a47aB4444f0bF39bB9047ced14A02022517]) [staticcall]
    â”‚   â””â”€ â† [Return] "0x62E00a47aB4444f0bF39bB9047ced14A02022517"
    â”œâ”€ [0] VM::toString(560048 [5.6e5]) [staticcall]
    â”‚   â””â”€ â† [Return] "560048"
    â”œâ”€ [0] VM::toString(0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5) [staticcall]
    â”‚   â””â”€ â† [Return] "0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5"
    â”œâ”€ [0] VM::toString(3600) [staticcall]
    â”‚   â””â”€ â† [Return] "3600"
    â”œâ”€ [0] VM::toString(3600) [staticcall]
    â”‚   â””â”€ â† [Return] "3600"
    â”œâ”€ [0] VM::writeJson("{\"deploy\": {\"address\": \"0x62E00a47aB4444f0bF39bB9047ced14A02022517\",\"chainId\": 560048,\"beneficiary\": \"0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5\",\"config\": {\"time\": \"3600,3600\"}}}", "./deployments/BlindAuction.json")
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [0] console::log("Deployment info saved to: %s", "./deployments/BlindAuction.json") [staticcall]
    â”‚   â””â”€ â† [Stop]
    â””â”€ â† [Return]


Script ran successfully.

== Logs ==
  BlindAuction deployed at: 0x62E00a47aB4444f0bF39bB9047ced14A02022517
  Deployment info saved to: ./deployments/BlindAuction.json

## Setting up 1 EVM.
==========================
Simulated On-chain Traces:

  [528230] â†’ new BlindAuction@0x62E00a47aB4444f0bF39bB9047ced14A02022517
    â””â”€ â† [Return] 2305 bytes of code


==========================

Chain 560048

Estimated gas price: 1.851505002 gwei

Estimated total gas used for script: 808186

Estimated amount required: 0.001496360421546372 ETH

==========================

##### hoodi
âœ…  [Success] Hash: 0xe9e360cf818edcae409cbd77fb3844933b734812b36000c6befdfdefebfa89c0
Contract Address: 0x62E00a47aB4444f0bF39bB9047ced14A02022517
Block: 559069
Paid: 0.000668443054994 ETH (621682 gas * 1.075217 gwei)

âœ… Sequence #1 on hoodi | Total Paid: 0.000668443054994 ETH (621682 gas * avg 1.075217 gwei)
                                                                                                                                                                            

==========================

ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.
##
Start verification for (1) contracts
Start verifying contract `0x62E00a47aB4444f0bF39bB9047ced14A02022517` deployed on hoodi
EVM version: cancun
Compiler version: 0.8.30
Optimizations:    200
Constructor args: 0000000000000000000000000000000000000000000000000000000000000e100000000000000000000000000000000000000000000000000000000000000e10000000000000000000000000750ea21c1e98cced0d4557196b6f4a5974ccb6f5

Submitting verification for [src/BlindAuction.sol:BlindAuction] 0x62E00a47aB4444f0bF39bB9047ced14A02022517.
Warning: Could not detect the deployment.; waiting 5 seconds before trying again (4 tries remaining)

Submitting verification for [src/BlindAuction.sol:BlindAuction] 0x62E00a47aB4444f0bF39bB9047ced14A02022517.
Warning: Could not detect the deployment.; waiting 5 seconds before trying again (3 tries remaining)

Submitting verification for [src/BlindAuction.sol:BlindAuction] 0x62E00a47aB4444f0bF39bB9047ced14A02022517.
Submitted contract for verification:
        Response: `OK`
        GUID: `cs8hqcue8rwcdyuf7trjsppaf2kwt3wqeiucivbfqv7ruisjbq`
        URL: https://hoodi.etherscan.io/address/0x62e00a47ab4444f0bf39bb9047ced14a02022517
Contract verification status:
Response: `OK`
Details: `Pass - Verified`
Contract successfully verified
All (1) contracts were verified!

Transactions saved to: /Users/qiaopengjun/Code/Sonic/BlindAuction/broadcast/BlindAuction.s.sol/560048/run-latest.json

Sensitive values saved to: /Users/qiaopengjun/Code/Sonic/BlindAuction/cache/BlindAuction.s.sol/560048/run-latest.json

```

### ç¬¬ä¸ƒæ­¥ï¼šHoodi æµè§ˆå™¨æŸ¥çœ‹åˆçº¦

åˆçº¦åœ°å€ï¼š0x62E00a47aB4444f0bF39bB9047ced14A02022517

<https://hoodi.etherscan.io/address/0x62e00a47ab4444f0bf39bb9047ced14a02022517#code>

![image-20250608130311312](/images/image-20250608130311312.png)

Hoodi æµ‹è¯•ç½‘éƒ¨ç½²åˆçº¦æˆåŠŸï¼

### ç¬¬å…«æ­¥ï¼šSonic æµ‹è¯•ç½‘éƒ¨ç½²

```bash
BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) took 37.7s 
âœ forge build                                                                          
[â ’] Compiling...
No files changed, compilation skipped

BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ source .env                                                                          

BlindAuction on î‚  main [âœ˜!?] on ğŸ³ v28.2.2 (orbstack) 
âœ forge script BlindAuctionScript --rpc-url $SONIC_RPC_URL --broadcast --verify -vvvvv 
[â Š] Compiling...
No files changed, compilation skipped
Warning: EIP-3855 is not supported in one or more of the RPCs used.
Unsupported Chain IDs: 57054.
Contracts deployed with a Solidity version equal or higher than 0.8.20 might not work properly.
For more information, please see https://eips.ethereum.org/EIPS/eip-3855
Traces:
  [132] BlindAuctionScript::setUp()
    â””â”€ â† [Stop]

  [580049] BlindAuctionScript::run()
    â”œâ”€ [0] VM::envUint("PRIVATE_KEY") [staticcall]
    â”‚   â””â”€ â† [Return] <env var value>
    â”œâ”€ [0] VM::addr(<pk>) [staticcall]
    â”‚   â””â”€ â† [Return] 0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5
    â”œâ”€ [0] VM::startBroadcast(<pk>)
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [528230] â†’ new BlindAuction@0x0660c412bf2aca856ee119cEfdD155b24595a6CE
    â”‚   â””â”€ â† [Return] 2305 bytes of code
    â”œâ”€ [0] console::log("BlindAuction deployed at:", BlindAuction: [0x0660c412bf2aca856ee119cEfdD155b24595a6CE]) [staticcall]
    â”‚   â””â”€ â† [Stop]
    â”œâ”€ [0] VM::stopBroadcast()
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [0] VM::toString(BlindAuction: [0x0660c412bf2aca856ee119cEfdD155b24595a6CE]) [staticcall]
    â”‚   â””â”€ â† [Return] "0x0660c412bf2aca856ee119cEfdD155b24595a6CE"
    â”œâ”€ [0] VM::toString(57054 [5.705e4]) [staticcall]
    â”‚   â””â”€ â† [Return] "57054"
    â”œâ”€ [0] VM::toString(0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5) [staticcall]
    â”‚   â””â”€ â† [Return] "0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5"
    â”œâ”€ [0] VM::toString(3600) [staticcall]
    â”‚   â””â”€ â† [Return] "3600"
    â”œâ”€ [0] VM::toString(3600) [staticcall]
    â”‚   â””â”€ â† [Return] "3600"
    â”œâ”€ [0] VM::writeJson("{\"deploy\": {\"address\": \"0x0660c412bf2aca856ee119cEfdD155b24595a6CE\",\"chainId\": 57054,\"beneficiary\": \"0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5\",\"config\": {\"time\": \"3600,3600\"}}}", "./deployments/BlindAuction.json")
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [0] console::log("Deployment info saved to: %s", "./deployments/BlindAuction.json") [staticcall]
    â”‚   â””â”€ â† [Stop]
    â””â”€ â† [Return]


Script ran successfully.

== Logs ==
  BlindAuction deployed at: 0x0660c412bf2aca856ee119cEfdD155b24595a6CE
  Deployment info saved to: ./deployments/BlindAuction.json

## Setting up 1 EVM.
==========================
Simulated On-chain Traces:

  [528230] â†’ new BlindAuction@0x0660c412bf2aca856ee119cEfdD155b24595a6CE
    â””â”€ â† [Return] 2305 bytes of code


==========================

Chain 57054

Estimated gas price: 2.200000001 gwei

Estimated total gas used for script: 808186

Estimated amount required: 0.001778009200808186 S

==========================

##### sonic-blaze
âœ…  [Success] Hash: 0x36488ae38b05109c63450b7bc6148b637ba3267829166116bae5264f821dbfc5
Contract Address: 0x0660c412bf2aca856ee119cEfdD155b24595a6CE
Block: 44854158
Paid: 0.000640332000640332 ETH (640332 gas * 1.000000001 gwei)

âœ… Sequence #1 on sonic-blaze | Total Paid: 0.000640332000640332 ETH (640332 gas * avg 1.000000001 gwei)
                                                                                                                                                                            

==========================

ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.
##
Start verification for (1) contracts
Start verifying contract `0x0660c412bf2aca856ee119cEfdD155b24595a6CE` deployed on sonic-blaze
EVM version: cancun
Compiler version: 0.8.30
Optimizations:    200
Constructor args: 0000000000000000000000000000000000000000000000000000000000000e100000000000000000000000000000000000000000000000000000000000000e10000000000000000000000000750ea21c1e98cced0d4557196b6f4a5974ccb6f5

Submitting verification for [src/BlindAuction.sol:BlindAuction] 0x0660c412bf2aca856ee119cEfdD155b24595a6CE.
Submitted contract for verification:
        Response: `OK`
        GUID: `sfleeiw4rkbrmcs2p2gsezzuds8rdx6riq22rk2vfiigulgire`
        URL: https://testnet.sonicscan.org/address/0x0660c412bf2aca856ee119cefdd155b24595a6ce
Contract verification status:
Response: `NOTOK`
Details: `Pending in queue`
Warning: Verification is still pending...; waiting 15 seconds before trying again (7 tries remaining)
Contract verification status:
Response: `OK`
Details: `Pass - Verified`
Contract successfully verified
All (1) contracts were verified!

Transactions saved to: /Users/qiaopengjun/Code/Sonic/BlindAuction/broadcast/BlindAuction.s.sol/57054/run-latest.json

Sensitive values saved to: /Users/qiaopengjun/Code/Sonic/BlindAuction/cache/BlindAuction.s.sol/57054/run-latest.json

```

### ç¬¬ä¹æ­¥ï¼šSonic æµè§ˆå™¨æŸ¥çœ‹åˆçº¦

åˆçº¦åœ°å€ï¼š0x0660c412bf2aca856ee119cEfdD155b24595a6CE

<https://testnet.sonicscan.org/address/0x0660c412bf2aca856ee119cefdd155b24595a6ce#code>

![image-20250608131322852](/images/image-20250608131322852.png)

Sonic æµ‹è¯•ç½‘éƒ¨ç½²åˆçº¦æˆåŠŸï¼

## æ€»ç»“

Sonicä»¥å…¶å“è¶Šçš„æ€§èƒ½å’ŒEVMå…¼å®¹æ€§ï¼Œä¸ºWeb3å¼€å‘è€…æä¾›äº†ç†æƒ³çš„å¼€å‘å¹³å°ã€‚æœ¬æ–‡é€šè¿‡BlindAuctionæ™ºèƒ½åˆçº¦çš„å®è·µï¼Œå±•ç¤ºäº†Sonicåœ¨æ”¯æŒå¤æ‚DeFiåº”ç”¨å¼€å‘ä¸­çš„é«˜æ•ˆæ€§ä¸å¯é æ€§ã€‚ä»åˆçº¦è®¾è®¡åˆ°æµ‹è¯•è¦†ç›–ï¼Œå†åˆ°å¤šç½‘ç»œéƒ¨ç½²ï¼Œæ•´ä¸ªæµç¨‹éªŒè¯äº†Sonicçš„é«˜ååé‡ã€ä½å»¶è¿Ÿå’Œå®‰å…¨ç‰¹æ€§ã€‚æ— è®ºä½ æ˜¯åŒºå—é“¾å¼€å‘è€…è¿˜æ˜¯Web3çˆ±å¥½è€…ï¼ŒSonicéƒ½å€¼å¾—ä¸€è¯•ï¼å¿«æ¥åŠ å…¥Sonicç”Ÿæ€ï¼Œæ¢ç´¢Web3çš„æ— é™å¯èƒ½å§ï¼

## å‚è€ƒ

- <https://learnblockchain.cn/docs/foundry/i18n/zh/reference/forge/forge-coverage.html>
- <https://www.rareskills.io/post/foundry-forge-coverage>
- <https://github.com/foundry-rs/foundry>
- <https://getfoundry.sh/forge/reference/forge-coverage/>
- <https://testnet.soniclabs.com/account>
- <https://testnet.sonicscan.org/>
- <https://linktr.ee/soniclabs>
- <https://github.com/foundry-rs/foundry/blob/master/crates/config/README.md#all-options>
- <https://hoodi.etherscan.io/address/0x62e00a47ab4444f0bf39bb9047ced14a02022517#code>
- <https://testnet.sonicscan.org/address/0x0660c412bf2aca856ee119cefdd155b24595a6ce#code>
- <https://command-not-found.com/genhtml>
- <https://www.bitrue.com/blog/sonic-s-tokenomics-explained-utility-staking-and-rewards>
