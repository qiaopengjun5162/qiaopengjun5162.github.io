+++
title = "Goè¯­è¨€ï¼ˆGolangï¼‰æ•°æ®åº“ç¼–ç¨‹"
date = 2023-05-09T16:23:42+08:00
[taxonomies]
tags = ["Go"]
categories = ["Go"]
+++

# Go æ•°æ®åº“ç¼–ç¨‹

## ä¸€ã€è¿æ¥æ•°æ®åº“

### å‡†å¤‡è¿æ¥åˆ°æ•°æ®åº“

- è¦æƒ³è¿æ¥åˆ° SQL æ•°æ®åº“ï¼Œé¦–å…ˆéœ€è¦åŠ è½½ç›®æ ‡æ•°æ®åº“çš„é©±åŠ¨ï¼Œé©±åŠ¨é‡Œé¢åŒ…å«ç€äºè¯¥æ•°æ®åº“äº¤äº’çš„é€»è¾‘ã€‚
- sql.Open()
  - æ•°æ®åº“é©±åŠ¨çš„åç§°
  - æ•°æ®æºåç§°
  - å¾—åˆ°ä¸€ä¸ªæŒ‡å‘ sql.DB è¿™ä¸ª struct çš„æŒ‡é’ˆ
- sql.DB æ˜¯ç”¨æ¥æ“ä½œæ•°æ®åº“çš„ï¼Œå®ƒä»£è¡¨äº†0ä¸ªæˆ–è€…å¤šä¸ªåº•å±‚è¿æ¥çš„æ± ï¼Œè¿™äº›è¿æ¥ç”±sql åŒ…æ¥ç»´æŠ¤ï¼Œsql åŒ…ä¼šè‡ªåŠ¨çš„åˆ›å»ºå’Œé‡Šæ”¾è¿™äº›è¿æ¥
  - å®ƒå¯¹äºå¤šä¸ª goroutine å¹¶å‘çš„ä½¿ç”¨æ˜¯å®‰å…¨çš„

```go
package main

import (
  "context"
  "database/sql"
  "fmt"
  "log"
  
  _ "github.com/denisenkom/go-mssqldb"
)

var db *sql.DB

const (
  server = "xxxx.database.windows.net"
  port = 1433
  user = "xxxxx"
  password = "xxxxx"
  database = "go-db"
)

func main() {
  connStr := fmt.Sprintf("server=%s;user id=%s;password=%s;port=%d;database=%s;",
                        server, user, password, port, database)
  
  db, err := sql.Open("sqlserver", connStr)
  if err != nil {
    log.Fataln(err.Error())
  }
  
  ctx := context.Background()
  
  err = db.PingContext(ctx)
  if err != nil {
    log.Fataln(err.Error())
  }
  
  fmt.Println("Connected!")
}
```

### Note

- Open() å‡½æ•°å¹¶ä¸ä¼šè¿æ¥æ•°æ®åº“ï¼Œç”šè‡³ä¸ä¼šéªŒè¯å…¶å‚æ•°ã€‚å®ƒåªæ˜¯æŠŠåç»­è¿æ¥åˆ°æ•°æ®åº“æ‰€å¿…éœ€çš„ structs ç»™è®¾ç½®å¥½äº†
- è€ŒçœŸæ­£çš„è¿æ¥æ˜¯åœ¨è¢«éœ€è¦çš„æ—¶å€™æ‰è¿›è¡Œæ‡’è®¾ç½®çš„
- sql.DB ä¸éœ€è¦è¿›è¡Œå…³é—­ï¼ˆå½“ç„¶ä½ æƒ³å…³é—­ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰
- å®ƒå°±æ˜¯ç”¨æ¥å¤„ç†æ•°æ®åº“çš„ï¼Œè€Œä¸æ˜¯å®é™…çš„è¿æ¥
- è¿™ä¸ªæŠ½è±¡åŒ…å«äº†æ•°æ®åº“è¿æ¥çš„æ± ï¼Œè€Œä¸”ä¼šå¯¹æ­¤è¿›è¡Œç»´æŠ¤
- åœ¨ä½¿ç”¨ sql.DB çš„æ—¶å€™ï¼Œå¯ä»¥å®šä¹‰å®ƒçš„å…¨å±€å˜é‡è¿›è¡Œä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å°†å®ƒä¼ é€’åˆ°å‡½æ•°/æ–¹æ³•é‡Œã€‚

### å¦‚ä½•è·å¾—é©±åŠ¨

- æ­£å¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ sql.Register() å‡½æ•°ã€æ•°æ®åº“é©±åŠ¨çš„åç§°å’Œä¸€ä¸ªå®ç°äº† driver.Driver æ¥å£çš„ structï¼Œæ¥æ³¨å†Œæ•°æ®åº“çš„é©±åŠ¨ã€‚ä¾‹å¦‚ï¼š
  - sql.Register("sqlserver", &drv{})
- ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­å´æ²¡å†™è¿™å¥è¯ï¼Œä¸ºä»€ä¹ˆï¼Ÿ
  - å› ä¸º Sql Server çš„é©±åŠ¨ï¼Œæ˜¯åœ¨è¿™ä¸ªåŒ…è¢«å¼•å…¥çš„æ—¶å€™è¿›è¡Œäº†è‡ªæˆ‘æ³¨å†Œ

### é©±åŠ¨è‡ªåŠ¨æ³¨å†Œ

- å½“ go-mssqldb åŒ…è¢«å¼•å…¥çš„æ—¶å€™ï¼Œå®ƒçš„ init å‡½æ•°å°†ä¼šè¿è¡Œå¹¶è¿›è¡Œè‡ªæˆ‘æ³¨å†Œï¼ˆåœ¨ Go è¯­è¨€é‡Œï¼Œæ¯ä¸ªåŒ…çš„ init å‡½æ•°éƒ½ä¼šåœ¨è‡ªåŠ¨çš„è°ƒç”¨ï¼‰
- åœ¨å¼•å…¥ go-mssqldb åŒ…çš„æ—¶å€™ï¼ŒæŠŠè¯¥åŒ…çš„åè®¾ç½®ä¸ºä¸‹åˆ’çº¿ _ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸ç›´æ¥ä½¿ç”¨æ•°æ®åº“é©±åŠ¨ï¼ˆåªéœ€è¦å®ƒçš„â€å‰¯ä½œç”¨â€œï¼‰ï¼Œæˆ‘ä»¬åªä½¿ç”¨ database/sql
  - è¿™æ ·ï¼Œå¦‚æœæœªæ¥å‡çº§é©±åŠ¨ï¼Œä¹Ÿæ— éœ€æ”¹å˜ä»£ç 
- Go è¯­è¨€æ²¡æœ‰æä¾›å®˜æ–¹çš„æ•°æ®åº“é©±åŠ¨ï¼Œæ‰€æœ‰çš„æ•°æ®åº“é©±åŠ¨éƒ½æ˜¯ç¬¬ä¸‰æ–¹é©±åŠ¨ï¼Œä½†æ˜¯å®ƒä»¬éƒ½éµå¾ª sql.driver åŒ…é‡Œé¢å®šä¹‰çš„æ¥å£

### å®‰è£…æ•°æ®åº“é©±åŠ¨

- è¿™æ˜¯å®‰è£… Microsoft SQL Server æ•°æ®åº“é©±åŠ¨çš„ä¾‹å­ï¼š
- go get github.com/denisenkom/go-mssqldb

### func(*DB) PingContext

- ä¸Šä¾‹ä¸­çš„ db.PingContext() å‡½æ•°æ˜¯ç”¨æ¥éªŒè¯ä¸æ•°æ®åº“çš„è¿æ¥æ˜¯å¦ä»ç„¶æœ‰æ•ˆï¼Œå¦‚æœ‰å¿…è¦åˆ™å»ºç«‹ä¸€ä¸ªè¿æ¥ã€‚
- è¿™ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ª Context ï¼ˆä¸Šä¸‹æ–‡ï¼‰ç±»å‹çš„å‚æ•°ï¼Œè¿™ç§ç±»å‹å¯ä»¥æºå¸¦æˆªæ­¢æ—¶é—´ã€å–æ¶ˆä¿¡å·å’Œå…¶å®ƒè¯·æ±‚èŒƒå›´çš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥æ¨ªè·¨ API è¾¹ç•Œå’Œè¿›ç¨‹ã€‚
- ä¸Šä¾‹ä¸­ï¼Œåˆ›å»º context ä½¿ç”¨çš„æ˜¯ context.Background() å‡½æ•°ã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªé nil çš„ç©º Contextã€‚å®ƒä¸ä¼šè¢«å–æ¶ˆï¼Œå®ƒæ²¡æœ‰å€¼ï¼Œæ²¡æœ‰æˆªæ­¢æ—¶é—´ã€‚
- å®ƒé€šå¸¸ç”¨åœ¨ main å‡½æ•°ã€åˆå§‹åŒ–æˆ–æµ‹è¯•ä¸­ï¼Œä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ Contextã€‚

### Exercises

- ä½¿ç”¨ PostgreSQL å»ºç«‹æ•°æ®åº“ï¼Œä½¿ç”¨ Go è¯­è¨€è¿›è¡Œè¿æ¥ï¼Œå¹¶ Ping ä¸€ä¸‹ã€‚
- ä½¿ç”¨ SQLite å»ºç«‹æ•°æ®åº“ï¼Œä½¿ç”¨ Go è¯­è¨€è¿›è¡Œè¿æ¥ï¼Œå¹¶ Ping ä¸€ä¸‹ã€‚

### è¿æ¥MySQL

<https://github.com/go-sql-driver/mysql>

```bash
go get -u github.com/go-sql-driver/mysql
```

åˆ›å»ºç›®å½•

```~/Code/go via ğŸ¹ v1.20.3 via ğŸ…’ base
âœ mcd go_sql_demo

Code/go/go_sql_demo via ğŸ¹ v1.20.3 via ğŸ…’ base
âœ go mod init go_sql_demo
go: creating new go.mod: module go_sql_demo

Code/go/go_sql_demo via ğŸ¹ v1.20.3 via ğŸ…’ base
âœ c

Code/go/go_sql_demo via ğŸ¹ v1.20.3 via ğŸ…’ base
âœ
```

main.go

```go
package main

import (
 "database/sql"
 "fmt"

 _ "github.com/go-sql-driver/mysql"
)

// å®šä¹‰ä¸€ä¸ªå…¨å±€å¯¹è±¡db
var db *sql.DB

// å®šä¹‰ä¸€ä¸ªåˆå§‹åŒ–æ•°æ®åº“çš„å‡½æ•°
func initDB() (err error) {
 // DSN:Data Source Name
 dsn := "root:12345678@tcp(127.0.0.1:3306)/db_xuanke?charset=utf8mb4&parseTime=True"
 // ä¸ä¼šæ ¡éªŒè´¦å·å¯†ç æ˜¯å¦æ­£ç¡®
 // æ³¨æ„ï¼ï¼ï¼è¿™é‡Œä¸è¦ä½¿ç”¨:=ï¼Œæˆ‘ä»¬æ˜¯ç»™å…¨å±€å˜é‡èµ‹å€¼ï¼Œç„¶ååœ¨mainå‡½æ•°ä¸­ä½¿ç”¨å…¨å±€å˜é‡db
 db, err = sql.Open("mysql", dsn)
 if err != nil {
  return err
 }
 // å°è¯•ä¸æ•°æ®åº“å»ºç«‹è¿æ¥ï¼ˆæ ¡éªŒdsnæ˜¯å¦æ­£ç¡®ï¼‰
 err = db.Ping()
 if err != nil {
  return err
 }
 return nil
}

func main() {
 err := initDB() // è°ƒç”¨è¾“å‡ºåŒ–æ•°æ®åº“çš„å‡½æ•°
 if err != nil {
  fmt.Printf("init db failed,err:%v\n", err)
  return
 }
 fmt.Println("connect to database")
}

```

## äºŒã€CRUD

### æŸ¥è¯¢

- sql.DB ç±»å‹ä¸Šç”¨äºæŸ¥è¯¢çš„æ–¹æ³•æœ‰ï¼š
  - Query
  - QueryRow
  - QueryContext
  - QueryRowContext

### Query

- è¿”å›çš„ç±»å‹æ˜¯ï¼štype Rows struct {}
- Rows çš„æ–¹æ³•ï¼š
  - `func (rs *Rows) Close() error`
  - `func (rs *Rows) ColumnTypes() ([]*ColumnType, error)`
  - `func (rs *Rows) Columns() ([]string, error)`
  - `func (rs *Rows) Err() error`
  - `func (rs *Rows) Next() bool`
  - `func (rs *Rows) NextResultSet() bool`
  - `func (rs *Rows) Scan(dest ...interface{}) error`

### QueryRow

- è¿”å›ç±»å‹æ˜¯ï¼štype Row struct {}
- Row çš„æ–¹æ³•æœ‰ï¼š
  - `func (r *Row) Err() error`
  - `func (r *Row) Scan(dest ...interface{}) error`

<https://pkg.go.dev/database/sql@go1.20.4>

services.go æ–‡ä»¶

```go
package main

func getOne(id int) (a app, err error) {
  a = app{}
  log.Println(db == nil)
  err = db.QueryRow("SELECT Id, Name, Status, Level, [Order] FROM dbo.App WHERE Id=@Id",     sql.Named("Id", id)).Scan(
    &a.ID, &a.name, &a.status, &a.level, &a.order)
  return
}

func getMany(id int) (apps []app, err error) {
  rows, err = db.Query("SELECT Id, Name, Status, Level, [Order] FROM dbo.App WHERE Id>@Id",     sql.Named("Id", id))
  for rows.Next() {
    a := app{}
    err = rows.Scan(&a.ID, &a.name, &a.status, &a.level, &a.order)
    if err != nil {
      log.Fatalln(err.Error())
    }
    apps = append(apps, a)
  }
  return
}
```

models.go æ–‡ä»¶

```go
package main

type app struct {
  ID int
  name string
  status int
  level int
  order int
}
```

main.go æ–‡ä»¶

```go
package main

import (
  "context"
  "database/sql"
  "fmt"
  "log"
  
  _ "github.com/denisenkom/go-mssqldb"
)

var db *sql.DB

const (
  server = "xxxx.database.windows.net"
  port = 1433
  user = "xxxxx"
  password = "xxxxx"
  database = "go-db"
)

func main() {
  connStr := fmt.Sprintf("server=%s;user id=%s;password=%s;port=%d;database=%s;",
                        server, user, password, port, database)
  
  var err error
  db, err = sql.Open("sqlserver", connStr)
  if err != nil {
    log.Fataln(err.Error())
  }
  
  ctx := context.Background()
  
  err = db.PingContext(ctx)
  if err != nil {
    log.Fataln(err.Error())
  }
  
  fmt.Println("Connected!")
  
  log.Println(db == nil)
  // æŸ¥è¯¢ä¸€ç¬”
  one, err := getOne(103)
  if err != nil {
    log.Fatal(err.Error())
  }
  fmt.Println(one)
  
  apps, err := getMany(103)
  if err != nil {
    log.Fatalln(err.Error())
  }
  
  fmt.Println(apps)
}
```

### æ›´æ–°

- sql.DB ç±»å‹ä¸Šç”¨äºæ›´æ–°ï¼ˆæ‰§è¡Œå‘½ä»¤ï¼‰çš„æ–¹æ³•æœ‰ï¼š
  - Exec
  - ExecContext

services.go æ–‡ä»¶

```go
func (a *app) Update() (err error) {
  _, err = db.Exec("UPDATE dbo.App SET Name=@Name, [Order]=@Order WHERE Id=@Id",
        sql.Named("Name", a.name), sql.Named("Order", a.order), sql.Named("Id", a.ID))
  if err != nil {
    log.Fatalln(err.Error())
  }
  return
}
```

main.go æ–‡ä»¶

```go
a, _ := getOne(103)
fmt.Println(a)
a.name += " 1234"
a.order++

err = a.Update()
if err != nil {
  log.Fatalln(err.Error())
}
a1, _ := getOne(103)
fmt.Println(a1)
```

### åˆ é™¤

services.go æ–‡ä»¶

```go
func (a *app) Delete() (err error) {
  _, err = db.Exec("DELETE FROM dbo.App WHERE Id=@Id", sql.Named("Id", a.ID))
  if err != nil {
    log.Fatalln(err.Error())
  }
  return
}
```

### å…¶å®ƒ

- Ping
- PingContext
- Prepare
- PrepareContext
- Transactions
  - Begin
  - Begin Tx

services.go æ–‡ä»¶

```go
func (a *app) Insert() (err error) {
  statement := `INSERT INTO dbo.App
  (Name, NickName, Status, Level, [Order], Pinyin) 
  VALUES (@Name, 'Nick', &Status, @Level, @Order, '...');
  SELEÃ‡T isNull(SCOPE_IDENTITY(), -1);`
  stmt, err := db.Prepare(statement)
  if err ï¼= nil {
    log.Fatalln(err.Error())
  }
  defer stmt.Close()
  err = stmt.QueryRow(
    sql.Named("Name", a.name), sql.Named("Status", a.status), 
    sql.Named("Level", a.level),
    sql.Named("Order", a.order)).Scan(&a.ID)
  
  if err != nil {
    log.Fatalln(err.Error())
  }
  
  return
}
```

main.go æ–‡ä»¶

```go
a := app {
  name: "Test",
  order: 1123,
  level: 10,
  status: 1,
}

err = a.Insert()
if err != nil {
  log.Fatalln(err.Error())
}

one, _ := getOne(a.ID)
fmt.Println(one)
```

## ä¸‰ã€MySQL CRUD å®è·µ

åœ¨MySQLä¸­åˆ›å»ºä¸€ä¸ªåä¸º`sql_test`çš„æ•°æ®åº“

```sql
mysql> create database sql_test;
Query OK, 1 row affected (0.01 sec)

mysql> use sql_test;
Database changed
mysql> CREATE TABLE `user` (
    ->     `id` BIGINT(20) NOT NULL AUTO_INCREMENT,
    ->     `name` VARCHAR(20) DEFAULT '',
    ->     `age` INT(11) DEFAULT '0',
    ->     PRIMARY KEY(`id`)
    -> )ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4;
Query OK, 0 rows affected, 2 warnings (0.02 sec)

mysql> show tables;
+--------------------+
| Tables_in_sql_test |
+--------------------+
| user               |
+--------------------+
1 row in set (0.01 sec)

mysql>
```

main.go æ–‡ä»¶

```go
package main

import (
 "database/sql"
 "fmt"

 _ "github.com/go-sql-driver/mysql"
)

// å®šä¹‰ä¸€ä¸ªå…¨å±€å¯¹è±¡db
var db *sql.DB

// å®šä¹‰ä¸€ä¸ªåˆå§‹åŒ–æ•°æ®åº“çš„å‡½æ•°
func initDB() (err error) {
 // DSN:Data Source Name
 dsn := "root:12345678@tcp(127.0.0.1:3306)/sql_test?charset=utf8mb4&parseTime=True"
 // ä¸ä¼šæ ¡éªŒè´¦å·å¯†ç æ˜¯å¦æ­£ç¡®
 // æ³¨æ„ï¼ï¼ï¼è¿™é‡Œä¸è¦ä½¿ç”¨:=ï¼Œæˆ‘ä»¬æ˜¯ç»™å…¨å±€å˜é‡èµ‹å€¼ï¼Œç„¶ååœ¨mainå‡½æ•°ä¸­ä½¿ç”¨å…¨å±€å˜é‡db
 db, err = sql.Open("mysql", dsn)
 if err != nil {
  return err
 }
 // å°è¯•ä¸æ•°æ®åº“å»ºç«‹è¿æ¥ï¼ˆæ ¡éªŒdsnæ˜¯å¦æ­£ç¡®ï¼‰
 err = db.Ping()
 if err != nil {
  return err
 }
 return nil
}

func main() {
 err := initDB() // è°ƒç”¨è¾“å‡ºåŒ–æ•°æ®åº“çš„å‡½æ•°
 if err != nil {
  fmt.Printf("init db failed,err:%v\n", err)
  return
 }
 fmt.Println("connect to database")

 // one, err := queryRowDemo(1)
 // if err != nil {
 //  log.Fatal(err.Error())
 // }
 // fmt.Println(one)

 // u := user{
 //  name: "å°ä¹”1",
 //  age:  13,
 //  id:   0,
 // }
 // err = u.insertRowDemo()
 // if err != nil {
 //  log.Fatalln(err.Error())
 // }

 // u, _ := queryRowDemo(1)
 // fmt.Println("u:", u)
 // u.name = "è²‚è‰"
 // u.age = 16

 // err = u.updateRowDemo()
 // if err != nil {
 //  log.Fatalln(err.Error())
 // }

 // u1, _ := queryRowDemo(1)
 // fmt.Println("u1:", u1)

 last_row, _ := queryMultiRowDemo(0)
 fmt.Println("last_row:", last_row)

 // var u = new(user)
 // u.id = 3
 // err = u.deleteRowDemo()
 // if err != nil {
 //  log.Fatalln(err.Error())
 // }
}

```

services.go æ–‡ä»¶

```go
package main

import (
 "fmt"
)

// æŸ¥è¯¢å•æ¡æ•°æ®ç¤ºä¾‹
func queryRowDemo(id int) (u user, err error) {
 sqlStr := "select id, name, age from user where id=?"
 // éå¸¸é‡è¦ï¼šç¡®ä¿QueryRowä¹‹åè°ƒç”¨Scanæ–¹æ³•ï¼Œå¦åˆ™æŒæœ‰çš„æ•°æ®åº“é“¾æ¥ä¸ä¼šè¢«é‡Šæ”¾
 err = db.QueryRow(sqlStr, id).Scan(&u.id, &u.name, &u.age)
 if err != nil {
  fmt.Printf("scan failed, err:%v\n", err)
  return
 }
 fmt.Printf("id:%d name:%s age:%d\n", u.id, u.name, u.age)
 return
}

// æŸ¥è¯¢å¤šæ¡æ•°æ®ç¤ºä¾‹
func queryMultiRowDemo(id int) (u user, err error) {
 sqlStr := "select id, name, age from user where id > ?"
 rows, err := db.Query(sqlStr, id)
 if err != nil {
  fmt.Printf("query failed, err:%v\n", err)
  return
 }
 // éå¸¸é‡è¦ï¼šå…³é—­rowsé‡Šæ”¾æŒæœ‰çš„æ•°æ®åº“é“¾æ¥
 defer rows.Close()
 // å¾ªç¯è¯»å–ç»“æœé›†ä¸­çš„æ•°æ®
 for rows.Next() {
  err = rows.Scan(&u.id, &u.name, &u.age)
  if err != nil {
   fmt.Printf("scan failed, err:%v\n", err)
   return
  }
  fmt.Printf("id:%d name:%s age:%d\n", u.id, u.name, u.age)
 }
 return
}

// æ’å…¥æ•°æ®
func (u *user) insertRowDemo() (err error) {
 sqlStr := "insert into user(name, age) values (?,?)"
 ret, err := db.Exec(sqlStr, u.name, u.age)
 if err != nil {
  fmt.Printf("insert failed, err:%v\n", err)
  return
 }
 theID, err := ret.LastInsertId() // æ–°æ’å…¥æ•°æ®çš„id
 if err != nil {
  fmt.Printf("get lastinsert ID failed, err:%v\n", err)
  return
 }
 fmt.Printf("insert success, the id is %d.\n", theID)
 return
}

// æ›´æ–°æ•°æ®
func (u *user) updateRowDemo() (err error) {
 sqlStr := "update user set age=? where id = ?"
 ret, err := db.Exec(sqlStr, u.age, u.id)
 if err != nil {
  fmt.Printf("update failed, err:%v\n", err)
  return
 }
 n, err := ret.RowsAffected() // æ“ä½œå½±å“çš„è¡Œæ•°
 if err != nil {
  fmt.Printf("get RowsAffected failed, err:%v\n", err)
  return
 }
 fmt.Printf("update success, affected rows:%d\n", n)
 return
}

// åˆ é™¤æ•°æ®
func (u *user) deleteRowDemo() (err error) {
 sqlStr := "delete from user where id = ?"
 ret, err := db.Exec(sqlStr, u.id)
 if err != nil {
  fmt.Printf("delete failed, err:%v\n", err)
  return
 }
 n, err := ret.RowsAffected() // æ“ä½œå½±å“çš„è¡Œæ•°
 if err != nil {
  fmt.Printf("get RowsAffected failed, err:%v\n", err)
  return
 }
 fmt.Printf("delete success, affected rows:%d\n", n)
 return
}

```

models.go æ–‡ä»¶

```go
package main

type user struct {
 id   int
 age  int
 name string
}

```

è¿è¡Œ

```bash
Code/go/go_sql_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ go build . && ./go_sql_demo
connect to database
id:1 name:å°ä¹” age:16
id:2 name:å°ä¹” age:12
last_row: {2 12 å°ä¹”}

Code/go/go_sql_demo via ğŸ¹ v1.20.3 via ğŸ…’ base took 3.3s 
âœ 
```
