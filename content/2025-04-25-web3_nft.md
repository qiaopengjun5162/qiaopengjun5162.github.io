+++
title = "Web3å®æˆ˜ï¼šæ‰“é€ å±äºä½ çš„NFTæ•°å­—èµ„äº§"
description = "Web3å®æˆ˜ï¼šæ‰“é€ å±äºä½ çš„NFTæ•°å­—èµ„äº§"
date = 2025-04-25T13:41:12Z
[taxonomies]
categories = ["Web3", "NFT", "Solidity", "æ™ºèƒ½åˆçº¦", "Ethereum"]
tags = ["Web3", "NFT", "Solidity", "æ™ºèƒ½åˆçº¦", "Ethereum"]
+++

<!-- more -->

# Web3å®æˆ˜ï¼šæ‰“é€ å±äºä½ çš„NFTæ•°å­—èµ„äº§

Web3æ—¶ä»£ï¼ŒNFTï¼ˆéåŒè´¨åŒ–ä»£å¸ï¼‰æ­£é‡å¡‘æ•°å­—æ‰€æœ‰æƒçš„æœªæ¥ã€‚æ— è®ºæ˜¯ç‹¬ä¸€æ— äºŒçš„è‰ºæœ¯å“è¿˜æ˜¯è™šæ‹Ÿèµ„äº§ï¼ŒERC721æ ‡å‡†è®©ä½ è½»æ¾å®ç°NFTçš„åˆ›å»ºä¸ç®¡ç†ã€‚æœ¬æ–‡é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„å®æˆ˜æ¡ˆä¾‹ï¼Œå¸¦ä½ æ·±å…¥Solidityæ™ºèƒ½åˆçº¦å¼€å‘ï¼Œå¿«é€Ÿéƒ¨ç½²å±äºä½ çš„NFTä»£å¸ï¼Œè§£é”Web3å¼€å‘çš„æ— é™å¯èƒ½ã€‚å‡†å¤‡å¥½åŠ å…¥è¿™åœºæ•°å­—èµ„äº§é©å‘½äº†å—ï¼Ÿ

æœ¬æ–‡é€šè¿‡ä¸€ä¸ªåŸºäºOpenZeppelinçš„ERC721æ™ºèƒ½åˆçº¦MyERC721Tokenï¼Œå±•ç¤ºäº†NFTå¼€å‘çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬åˆçº¦ç¼–å†™ã€éƒ¨ç½²è„šæœ¬ã€Sepoliaæµ‹è¯•ç½‘éƒ¨ç½²åŠéªŒè¯ã€‚åˆçº¦æ”¯æŒURIå­˜å‚¨ã€å¯é”€æ¯ã€æŠ•ç¥¨å’ŒEIP712ç­¾åç­‰åŠŸèƒ½ï¼Œé€‚åˆWeb3å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹ã€‚æ–‡ç« è¿˜æ¶µç›–éƒ¨ç½²é—®é¢˜ä¼˜åŒ–ä¸å®ç”¨å»ºè®®ï¼Œä¸ºæ‰“é€ ä¸ªæ€§åŒ–NFTé¡¹ç›®æä¾›æ¸…æ™°æŒ‡å¼•ã€‚

## MyERC721Token å®æ“

### åˆçº¦ä»£ç 

```ts
// SPDX-License-Identifier: MIT
// Compatible with OpenZeppelin Contracts ^5.0.0
pragma solidity ^0.8.20;

import "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Burnable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/cryptography/EIP712.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Votes.sol";

contract MyERC721Token is ERC721, ERC721URIStorage, ERC721Burnable, Ownable, EIP712, ERC721Votes {
    uint256 private _nextTokenId;

    constructor(address initialOwner)
        ERC721("MyERC721Token", "MTK721")
        Ownable(initialOwner)
        EIP712("MyERC721Token", "1")
    {}

    function safeMint(address to, string memory uri) public onlyOwner {
        uint256 tokenId = _nextTokenId++;
        _safeMint(to, tokenId);
        _setTokenURI(tokenId, uri);
    }

    // The following functions are overrides required by Solidity.

    function _update(address to, uint256 tokenId, address auth)
        internal
        override(ERC721, ERC721Votes)
        returns (address)
    {
        return super._update(to, tokenId, auth);
    }

    function _increaseBalance(address account, uint128 value) internal override(ERC721, ERC721Votes) {
        super._increaseBalance(account, value);
    }

    function tokenURI(uint256 tokenId) public view override(ERC721, ERC721URIStorage) returns (string memory) {
        return super.tokenURI(tokenId);
    }

    function supportsInterface(bytes4 interfaceId) public view override(ERC721, ERC721URIStorage) returns (bool) {
        return super.supportsInterface(interfaceId);
    }
}

```

### MyERC721Token æ™ºèƒ½åˆçº¦ä»£ç çš„è§£é‡Š

1. å¤´éƒ¨å’Œè®¸å¯è¯

```solidity
// SPDX-License-Identifier: MIT
// Compatible with OpenZeppelin Contracts ^5.0.0
pragma solidity ^0.8.20;
```

- **SPDX-License-Identifier: MIT**ï¼šå£°æ˜ä»£ç é‡‡ç”¨MITè®¸å¯è¯ï¼Œå…è®¸å¼€æºä½¿ç”¨ï¼Œå‡ ä¹æ— é™åˆ¶ï¼Œä¾¿äºç¤¾åŒºå…±äº«å’Œå¤ç”¨ã€‚
- **Compatible with OpenZeppelin Contracts ^5.0.0**ï¼šè¡¨æ˜åˆçº¦ä¸OpenZeppelinåˆçº¦åº“5.0.0åŠä»¥ä¸Šç‰ˆæœ¬å…¼å®¹ï¼Œç¡®ä¿ä¾èµ–çš„åº“åŠŸèƒ½ä¸€è‡´ã€‚
- **pragma solidity ^0.8.20**ï¼šæŒ‡å®šSolidityç¼–è¯‘å™¨ç‰ˆæœ¬ä¸º0.8.20æˆ–å…¼å®¹ç‰ˆæœ¬ï¼Œ^å…è®¸å°ç‰ˆæœ¬æ›´æ–°ï¼Œä»¥ä¿è¯å®‰å…¨æ€§å’Œæ–°ç‰¹æ€§æ”¯æŒã€‚

2. å¯¼å…¥åº“

```ts
import "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721URIStorage.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Burnable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/cryptography/EIP712.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Votes.sol";
```

è¿™äº›è¡Œå¯¼å…¥äº†OpenZeppelinçš„æ ‡å‡†åŒ–ã€ç»è¿‡å®¡è®¡çš„åˆçº¦åº“ï¼Œä¸ºNFTåˆçº¦æ‰©å±•åŠŸèƒ½ï¼š

- **ERC721.sol**ï¼šERC721æ ‡å‡†çš„å®ç°ï¼Œæä¾›NFTæ ¸å¿ƒåŠŸèƒ½ï¼Œå¦‚æ‰€æœ‰æƒç®¡ç†ã€è½¬ç§»ç­‰ã€‚
- **ERC721URIStorage.sol**ï¼šæ‰©å±•åŠŸèƒ½ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªNFTçš„å…ƒæ•°æ®URIï¼ˆå¦‚æŒ‡å‘JSONæ–‡ä»¶çš„é“¾æ¥ï¼ŒåŒ…å«å›¾ç‰‡ã€æè¿°ç­‰ï¼‰ã€‚
- **ERC721Burnable.sol**ï¼šæ·»åŠ â€œé”€æ¯â€åŠŸèƒ½ï¼Œå…è®¸æ°¸ä¹…åˆ é™¤NFTï¼Œå‡å°‘æµé€šé‡ã€‚
- **Ownable.sol**ï¼šå®ç°è®¿é—®æ§åˆ¶ï¼Œé™åˆ¶ç‰¹å®šåŠŸèƒ½ï¼ˆå¦‚é“¸é€ ï¼‰ä»…é™åˆçº¦æ‹¥æœ‰è€…è°ƒç”¨ã€‚
- **EIP712.sol**ï¼šæ”¯æŒEIP-712æ ‡å‡†ï¼Œç”¨äºç»“æ„åŒ–æ•°æ®ç­¾åï¼Œå¯å®ç°æ— gasäº¤æ˜“ï¼ˆå¦‚ç­¾åæˆæƒï¼‰ã€‚
- **ERC721Votes.sol**ï¼šä¸ºNFTæ·»åŠ æ²»ç†åŠŸèƒ½ï¼Œå…è®¸NFTæŒæœ‰è€…å‚ä¸æŠ•ç¥¨ï¼ˆå¦‚`DAO`æ²»ç†ï¼‰ã€‚

3. åˆçº¦å®šä¹‰å’Œç»§æ‰¿

```ts
contract MyERC721Token is ERC721, ERC721URIStorage, ERC721Burnable, Ownable, EIP712, ERC721Votes {
```

- å®šä¹‰åˆçº¦åä¸º MyERC721Tokenï¼Œé€šè¿‡å¤šé‡ç»§æ‰¿æ•´åˆå¤šä¸ªOpenZeppelinæ¨¡å—ï¼š
  - ERC721ï¼šæä¾›NFTåŸºæœ¬åŠŸèƒ½ã€‚
  - ERC721URIStorageï¼šæ”¯æŒå­˜å‚¨å’ŒæŸ¥è¯¢NFTå…ƒæ•°æ®ã€‚
  - ERC721Burnableï¼šæ”¯æŒé”€æ¯NFTã€‚
  - Ownableï¼šé™åˆ¶åŠŸèƒ½è®¿é—®ï¼Œä»…é™åˆçº¦æ‹¥æœ‰è€…ã€‚
  - EIP712ï¼šæ”¯æŒç­¾åéªŒè¯ã€‚
  - ERC721Votesï¼šæ”¯æŒNFTç”¨äºæ²»ç†æŠ•ç¥¨ã€‚
- è¿™ç§æ¨¡å—åŒ–ç»§æ‰¿æ–¹å¼åˆ©ç”¨OpenZeppelinçš„æ ‡å‡†åŒ–ä»£ç ï¼Œå‡å°‘å¼€å‘æ—¶é—´å¹¶æé«˜å®‰å…¨æ€§ã€‚

4. **çŠ¶æ€å˜é‡**

```ts
uint256 private _nextTokenId;
```

- _nextTokenId æ˜¯ä¸€ä¸ªç§æœ‰å˜é‡ï¼Œç”¨äºè·Ÿè¸ªä¸‹ä¸€ä¸ªå¯ç”¨çš„NFTä»£å¸IDã€‚
- æ¯æ¬¡é“¸é€ æ–°NFTæ—¶ï¼Œ_nextTokenId è‡ªå¢ï¼Œç¡®ä¿æ¯ä¸ªNFTæœ‰å”¯ä¸€IDã€‚

5. æ„é€ å‡½æ•°

```ts
constructor(address initialOwner)
    ERC721("MyERC721Token", "MTK721")
    Ownable(initialOwner)
    EIP712("MyERC721Token", "1")
{}
```

- **ä½œç”¨**ï¼šåˆå§‹åŒ–åˆçº¦ï¼Œè®¾ç½®NFTåç§°ã€ç¬¦å·ã€æ‹¥æœ‰è€…å’ŒEIP-712å‚æ•°ã€‚
- **å‚æ•°**ï¼š
  - initialOwnerï¼šæŒ‡å®šåˆçº¦çš„åˆå§‹æ‹¥æœ‰è€…åœ°å€ï¼Œæ‹¥æœ‰ç‰¹æ®Šæƒé™ï¼ˆå¦‚é“¸é€ NFTï¼‰ã€‚
- **åˆå§‹åŒ–**ï¼š
  - ERC721("MyERC721Token", "MTK721")ï¼šè®¾ç½®NFTåç§°ä¸ºâ€œMyERC721Tokenâ€ï¼Œç¬¦å·ä¸ºâ€œMTK721â€ï¼ˆç±»ä¼¼ä»£å¸çš„ç®€å†™ï¼‰ã€‚
  - Ownable(initialOwner)ï¼šå°†åˆçº¦æ‰€æœ‰æƒåˆ†é…ç»™ initialOwnerã€‚
  - EIP712("MyERC721Token", "1")ï¼šåˆå§‹åŒ–EIP-712ç­¾ååŸŸï¼Œåç§°ä¸ºâ€œMyERC721Tokenâ€ï¼Œç‰ˆæœ¬ä¸ºâ€œ1â€ï¼Œç”¨äºç­¾åéªŒè¯ã€‚
- **ç©ºå‡½æ•°ä½“**ï¼š{} è¡¨ç¤ºæ„é€ å‡½æ•°ä»…æ‰§è¡Œåˆå§‹åŒ–ï¼Œæ— é¢å¤–é€»è¾‘ã€‚

6. é“¸é€ å‡½æ•°

```ts
function safeMint(address to, string memory uri) public onlyOwner {
    uint256 tokenId = _nextTokenId++;
    _safeMint(to, tokenId);
    _setTokenURI(tokenId, uri);
}
```

- **ä½œç”¨**ï¼šé“¸é€ æ–°çš„NFTå¹¶åˆ†é…ç»™æŒ‡å®šåœ°å€ï¼ŒåŒæ—¶è®¾ç½®å…ƒæ•°æ®URIã€‚
- **å‚æ•°**ï¼š
  - toï¼šæ¥æ”¶NFTçš„åœ°å€ã€‚
  - uriï¼šNFTçš„å…ƒæ•°æ®é“¾æ¥ï¼ˆé€šå¸¸æŒ‡å‘å­˜å‚¨å›¾ç‰‡ã€åç§°ç­‰ä¿¡æ¯çš„JSONæ–‡ä»¶ï¼‰ã€‚
- **ä¿®é¥°ç¬¦**ï¼š
  - onlyOwnerï¼šé™åˆ¶ä»…åˆçº¦æ‹¥æœ‰è€…å¯è°ƒç”¨æ­¤å‡½æ•°ï¼ˆæ¥è‡ª Ownable æ¨¡å—ï¼‰ã€‚
- **é€»è¾‘**ï¼š
  - uint256 tokenId = _nextTokenId++ï¼šè·å–å½“å‰_nextTokenId ä½œä¸ºæ–°NFTçš„IDï¼Œå¹¶è‡ªå¢ã€‚
  - _safeMint(to, tokenId)ï¼šè°ƒç”¨ERC721çš„_safeMint å‡½æ•°ï¼Œé“¸é€ NFTå¹¶åˆ†é…ç»™ toï¼ˆå®‰å…¨æ£€æŸ¥æ¥æ”¶è€…æ˜¯å¦æ”¯æŒERC721ï¼‰ã€‚
  - _setTokenURI(tokenId, uri)ï¼šè®¾ç½®NFTçš„å…ƒæ•°æ®URIï¼Œå­˜å‚¨åœ¨ ERC721URIStorage ä¸­ã€‚
- **ç”¨é€”**ï¼šè¿™æ˜¯åˆ›å»ºNFTçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå…è®¸æ‹¥æœ‰è€…é“¸é€ æ–°ä»£å¸å¹¶å…³è”å…ƒæ•°æ®ã€‚

7. é‡å†™å‡½æ•°

ä»¥ä¸‹å‡½æ•°æ˜¯Solidityè¦æ±‚çš„é‡å†™ï¼Œç”¨äºè§£å†³å¤šé‡ç»§æ‰¿ä¸­çš„å†²çªï¼Œç¡®ä¿åŠŸèƒ½æ­£ç¡®å®ç°ï¼š

7.1 **æ›´æ–°å‡½æ•°**

```ts
function _update(address to, uint256 tokenId, address auth)
    internal
    override(ERC721, ERC721Votes)
    returns (address)
{
    return super._update(to, tokenId, auth);
}
```

- **ä½œç”¨**ï¼šå¤„ç†NFTçš„è½¬ç§»æˆ–é”€æ¯é€»è¾‘ï¼Œéœ€åŒæ—¶å…¼å®¹ ERC721 å’Œ ERC721Votesã€‚
- **å‚æ•°**ï¼š
  - toï¼šNFTè½¬ç§»çš„ç›®æ ‡åœ°å€ã€‚
  - tokenIdï¼šNFTçš„IDã€‚
  - authï¼šæˆæƒåœ°å€ï¼ˆé€šå¸¸ä¸ºè°ƒç”¨è€…ï¼‰ã€‚
- **é‡å†™**ï¼šoverride(ERC721, ERC721Votes) è¡¨ç¤ºé‡å†™ä¸¤ä¸ªçˆ¶åˆçº¦çš„ _update å‡½æ•°ï¼Œè§£å†³ç»§æ‰¿å†²çªã€‚
- **é€»è¾‘**ï¼šè°ƒç”¨çˆ¶ç±»çš„ _update æ–¹æ³•ï¼Œä¿æŒé»˜è®¤è¡Œä¸ºï¼ŒåŒæ—¶æ›´æ–°æŠ•ç¥¨æƒé‡ï¼ˆç”¨äºæ²»ç†ï¼‰ã€‚

7.2 **ä½™é¢æ›´æ–°å‡½æ•°**

```ts
function _increaseBalance(address account, uint128 value) internal override(ERC721, ERC721Votes) {
    super._increaseBalance(account, value);
}
```

- **ä½œç”¨**ï¼šæ›´æ–°è´¦æˆ·çš„NFTä½™é¢ï¼Œå…¼å®¹ `ERC721` å’Œ `ERC721Votes`ã€‚
- **å‚æ•°**ï¼š
  - accountï¼šè´¦æˆ·åœ°å€ã€‚
  - valueï¼šå¢åŠ çš„ä½™é¢ï¼ˆé€šå¸¸ä¸º1ï¼Œè¡¨ç¤ºä¸€ä¸ªNFTï¼‰ã€‚
- **é‡å†™**ï¼šè§£å†³å¤šé‡ç»§æ‰¿å†²çªï¼Œè°ƒç”¨çˆ¶ç±»çš„ _increaseBalance æ–¹æ³•ï¼Œç¡®ä¿ä½™é¢å’ŒæŠ•ç¥¨æƒé‡åŒæ­¥æ›´æ–°ã€‚

7.3 **å…ƒæ•°æ®æŸ¥è¯¢å‡½æ•°**

```ts
function tokenURI(uint256 tokenId) public view override(ERC721, ERC721URIStorage) returns (string memory) {
    return super.tokenURI(tokenId);
}
```

- **ä½œç”¨**ï¼šè¿”å›æŒ‡å®šNFTçš„å…ƒæ•°æ®URIã€‚
- **å‚æ•°**ï¼š
  - tokenIdï¼šNFTçš„IDã€‚
- **é‡å†™**ï¼šå…¼å®¹ ERC721 å’Œ ERC721URIStorageï¼Œä¼˜å…ˆä½¿ç”¨ ERC721URIStorage çš„å®ç°ï¼ˆæ”¯æŒå­˜å‚¨URIï¼‰ã€‚
- **é€»è¾‘**ï¼šè°ƒç”¨çˆ¶ç±»çš„ tokenURI æ–¹æ³•ï¼Œè¿”å›å­˜å‚¨çš„URIã€‚

7.4 **æ¥å£æ”¯æŒå‡½æ•°**

```solidity
function supportsInterface(bytes4 interfaceId) public view override(ERC721, ERC721URIStorage) returns (bool) {
    return super.supportsInterface(interfaceId);
}
```

- **ä½œç”¨**ï¼šæ£€æŸ¥åˆçº¦æ˜¯å¦æ”¯æŒç‰¹å®šæ¥å£ï¼ˆå¦‚ERC721æˆ–æ‰©å±•æ¥å£ï¼‰ã€‚
- **å‚æ•°**ï¼š
  - interfaceIdï¼šæ¥å£çš„æ ‡è¯†ç¬¦ï¼ˆåŸºäºERC-165æ ‡å‡†ï¼‰ã€‚
- **é‡å†™**ï¼šå…¼å®¹ ERC721 å’Œ `ERC721URIStorage`ï¼Œç¡®ä¿æ­£ç¡®æŠ¥å‘Šæ”¯æŒçš„æ¥å£ã€‚
- **é€»è¾‘**ï¼šè°ƒç”¨çˆ¶ç±»çš„ `supportsInterface` æ–¹æ³•ï¼Œè¿”å›æ˜¯å¦æ”¯æŒæŒ‡å®šæ¥å£ã€‚

8. åŠŸèƒ½æ€»ç»“

- **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - é“¸é€ NFTï¼ˆsafeMintï¼‰ï¼šä»…é™æ‹¥æœ‰è€…é“¸é€ ï¼Œè®¾ç½®å…ƒæ•°æ®URIã€‚
  - å…ƒæ•°æ®ç®¡ç†ï¼šé€šè¿‡ `ERC721URIStorage` å­˜å‚¨å’ŒæŸ¥è¯¢NFTå…ƒæ•°æ®ã€‚
  - é”€æ¯NFTï¼šé€šè¿‡ `ERC721Burnable` æ”¯æŒé”€æ¯åŠŸèƒ½ã€‚
  - è®¿é—®æ§åˆ¶ï¼šé€šè¿‡ `Ownable` é™åˆ¶å…³é”®æ“ä½œã€‚
  - æ²»ç†æ”¯æŒï¼šé€šè¿‡ `ERC721Votes` å…è®¸NFTç”¨äºæŠ•ç¥¨ã€‚
  - ç­¾åæ”¯æŒï¼šé€šè¿‡ `EIP712` å¯ç”¨ç»“æ„åŒ–æ•°æ®ç­¾åã€‚
- **è®¾è®¡äº®ç‚¹**ï¼š
  - ä½¿ç”¨`OpenZeppelin`çš„æ¨¡å—åŒ–åº“ï¼Œä»£ç å®‰å…¨ä¸”æ˜“äºæ‰©å±•ã€‚
  - æ”¯æŒå¤šç§é«˜çº§åŠŸèƒ½ï¼ˆå¦‚æŠ•ç¥¨ã€ç­¾åï¼‰ï¼Œé€‚ç”¨äºå¤æ‚NFTé¡¹ç›®ã€‚
  - é€šè¿‡é‡å†™å‡½æ•°è§£å†³å¤šé‡ç»§æ‰¿å†²çªï¼Œä¿è¯åŠŸèƒ½ä¸€è‡´æ€§ã€‚

9. **æ½œåœ¨ç”¨ä¾‹**

- **NFTå¸‚åœº**ï¼šå¯ç”¨äºæ•°å­—è‰ºæœ¯ã€æ”¶è—å“æˆ–æ¸¸æˆèµ„äº§çš„NFTåˆ›å»ºã€‚
- **å»ä¸­å¿ƒåŒ–æ²»ç†**ï¼šNFTæŒæœ‰è€…å¯é€šè¿‡ `ERC721Votes` å‚ä¸DAOæŠ•ç¥¨ã€‚
- **å…ƒæ•°æ®ç®¡ç†**ï¼šé€šè¿‡URIå­˜å‚¨NFTçš„åŠ¨æ€å†…å®¹ï¼ˆå¦‚å›¾ç‰‡ã€å±æ€§ï¼‰ã€‚
- **ç­¾åæˆæƒ**ï¼šæ”¯æŒEIP-712çš„ç­¾åæœºåˆ¶ï¼Œå¯å®ç°æ— gasäº¤æ˜“æˆ–æˆæƒã€‚

10. **æ³¨æ„äº‹é¡¹**

- **æƒé™ç®¡ç†**ï¼šonlyOwner é™åˆ¶äº† safeMintï¼Œéœ€ç¡®ä¿æ‹¥æœ‰è€…åœ°å€å®‰å…¨ã€‚
- **Gasæˆæœ¬**ï¼šå¤šé‡ç»§æ‰¿å’Œæ‰©å±•åŠŸèƒ½å¯èƒ½å¢åŠ éƒ¨ç½²å’Œè°ƒç”¨æˆæœ¬ï¼Œéœ€ä¼˜åŒ–ã€‚
- **å…ƒæ•°æ®å­˜å‚¨**ï¼šURIé€šå¸¸æŒ‡å‘IPFSæˆ–ä¸­å¿ƒåŒ–æœåŠ¡å™¨ï¼Œéœ€ä¿è¯é“¾æ¥çš„æŒä¹…æ€§ã€‚
- **æµ‹è¯•ç½‘éªŒè¯**ï¼šå¦‚æ–‡ç« æ‰€ç¤ºï¼Œåˆçº¦å·²åœ¨Sepoliaæµ‹è¯•ç½‘éƒ¨ç½²ï¼Œå»ºè®®åœ¨ä¸»ç½‘éƒ¨ç½²å‰å……åˆ†æµ‹è¯•ã€‚

MyERC721Token æ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢çš„ERC721 NFTæ™ºèƒ½åˆçº¦ï¼Œé›†æˆäº†é“¸é€ ã€é”€æ¯ã€å…ƒæ•°æ®ç®¡ç†ã€æ²»ç†æŠ•ç¥¨å’Œç­¾åéªŒè¯ç­‰åŠŸèƒ½ã€‚é€šè¿‡OpenZeppelinçš„æ ‡å‡†åŒ–åº“ï¼Œä»£ç å®‰å…¨å¯é ï¼Œé€‚åˆWeb3å¼€å‘è€…å¿«é€Ÿæ„å»ºNFTé¡¹ç›®ã€‚ç†è§£å…¶ç»“æ„å’Œé€»è¾‘ï¼Œæœ‰åŠ©äºæ·±å…¥æŒæ¡Solidityå¼€å‘å’ŒWeb3ç”Ÿæ€çš„NFTåº”ç”¨ã€‚

### éƒ¨ç½²è„šæœ¬

```ts
// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Script, console} from "forge-std/Script.sol";
import {MyERC721Token} from "../src/MyERC721Token.sol";

contract MyERC721TokenScript is Script {
    MyERC721Token public my721token;

    function setUp() public {}

    function run() public {
        vm.startBroadcast();

        my721token = new MyERC721Token(msg.sender);
        console.log("MyERC721Token deployed to:", address(my721token));

        vm.stopBroadcast();
    }
}

```

### éƒ¨ç½²åˆçº¦

```bash
NFTMarketHub on î‚  main [!?] via â¬¢ v22.1.0 via ğŸ…’ base took 1m 18.6s
âœ source .env

NFTMarketHub on î‚  main [!?] via â¬¢ v22.1.0 via ğŸ…’ base
âœ forge script --chain sepolia script/MyERC721Token.s.sol:MyERC721TokenScript --rpc-url $SEPOLIA_RPC_URL --broadcast --account MetaMask --verify -vvvv

[â Š] Compiling...
[â ”] Compiling 1 files with Solc 0.8.20
[â ’] Solc 0.8.20 finished in 1.44s
Compiler run successful!
Enter keystore password:
Traces:
  [2119248] MyERC721TokenScript::run()
    â”œâ”€ [0] VM::startBroadcast()
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [2072840] â†’ new MyERC721Token@0xC39B0eE94143C457449e16829837FD59d722933C
    â”‚   â”œâ”€ emit OwnershipTransferred(previousOwner: 0x0000000000000000000000000000000000000000, newOwner: DefaultSender: [0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38])
    â”‚   â””â”€ â† [Return] 10002 bytes of code
    â”œâ”€ [0] console::log("MyERC721Token deployed to:", MyERC721Token: [0xC39B0eE94143C457449e16829837FD59d722933C]) [staticcall]
    â”‚   â””â”€ â† [Stop]
    â”œâ”€ [0] VM::stopBroadcast()
    â”‚   â””â”€ â† [Return]
    â””â”€ â† [Stop]


Script ran successfully.

== Logs ==
  MyERC721Token deployed to: 0xC39B0eE94143C457449e16829837FD59d722933C

## Setting up 1 EVM.
==========================
Simulated On-chain Traces:

  [2072840] â†’ new MyERC721Token@0xC39B0eE94143C457449e16829837FD59d722933C
    â”œâ”€ emit OwnershipTransferred(previousOwner: 0x0000000000000000000000000000000000000000, newOwner: DefaultSender: [0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38])
    â””â”€ â† [Return] 10002 bytes of code


==========================

Chain 11155111

Estimated gas price: 10.85383427 gwei

Estimated total gas used for script: 2990587

Estimated amount required: 0.03245933566801649 ETH

==========================

##### sepolia
âœ…  [Success]Hash: 0x8e5b0e3a9df4e5231b88d28af9c0e6e903bf7afac027a2ee54bf5faaf67b40c0
Contract Address: 0xC39B0eE94143C457449e16829837FD59d722933C
Block: 6326900
Paid: 0.012441733790006772 ETH (2301162 gas * 5.406717906 gwei)

âœ… Sequence #1 on sepolia | Total Paid: 0.012441733790006772 ETH (2301162 gas * avg 5.406717906 gwei)


==========================

ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.
##
Start verification for (1) contracts
Start verifying contract `0xC39B0eE94143C457449e16829837FD59d722933C` deployed on sepolia

Submitting verification for [src/MyERC721Token.sol:MyERC721Token] 0xC39B0eE94143C457449e16829837FD59d722933C.

Submitting verification for [src/MyERC721Token.sol:MyERC721Token] 0xC39B0eE94143C457449e16829837FD59d722933C.

Submitting verification for [src/MyERC721Token.sol:MyERC721Token] 0xC39B0eE94143C457449e16829837FD59d722933C.
Submitted contract for verification:
        Response: `OK`
        GUID: `q1v8v6kswcqvnzfdifksth4hdk1ss7ukejzxxfuktumivdrr5e`
        URL: https://sepolia.etherscan.io/address/0xc39b0ee94143c457449e16829837fd59d722933c
Contract verification status:
Response: `NOTOK`
Details: `Pending in queue`
Contract verification status:
Response: `OK`
Details: `Pass - Verified`
Contract successfully verified
All (1) contracts were verified!

Transactions saved to: /Users/qiaopengjun/Code/solidity-code/NFTMarketHub/broadcast/MyERC721Token.s.sol/11155111/run-latest.json

Sensitive values saved to: /Users/qiaopengjun/Code/solidity-code/NFTMarketHub/cache/MyERC721Token.s.sol/11155111/run-latest.json


```

### æµè§ˆå™¨æŸ¥çœ‹åˆçº¦

<https://sepolia.etherscan.io/address/0xc39b0ee94143c457449e16829837fd59d722933c>

![image-20240717185002327](/images/image-20240717185002327.png)

### éƒ¨ç½²é—®é¢˜ä¿®æ”¹

```bash
NFTMarketHub on î‚  main [!?] via â¬¢ v22.1.0 via ğŸ…’ base
âœ source .env

NFTMarketHub on î‚  main [!?] via â¬¢ v22.1.0 via ğŸ…’ base
âœ forge script --chain sepolia MyERC721TokenScript --rpc-url $SEPOLIA_RPC_URL --broadcast --verify -vvvv

[â Š] Compiling...
[â ”] Compiling 1 files with Solc 0.8.20
[â ’] Solc 0.8.20 finished in 1.46s
Compiler run successful!
Traces:
  [2120084] MyERC721TokenScript::run()
    â”œâ”€ [0] VM::envUint("PRIVATE_KEY") [staticcall]
    â”‚   â””â”€ â† [Return] <env var value>
    â”œâ”€ [0] VM::envAddress("ACCOUNT_ADDRESS") [staticcall]
    â”‚   â””â”€ â† [Return] <env var value>
    â”œâ”€ [0] VM::startBroadcast(<pk>)
    â”‚   â””â”€ â† [Return]
    â”œâ”€ [2072840] â†’ new MyERC721Token@0x7eA36391c7127A7f40E5c23212A8016d6E494546
    â”‚   â”œâ”€ emit OwnershipTransferred(previousOwner: 0x0000000000000000000000000000000000000000, newOwner: 0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5)
    â”‚   â””â”€ â† [Return] 10002 bytes of code
    â”œâ”€ [0] console::log("MyERC721Token deployed to:", MyERC721Token: [0x7eA36391c7127A7f40E5c23212A8016d6E494546]) [staticcall]
    â”‚   â””â”€ â† [Stop]
    â”œâ”€ [0] VM::stopBroadcast()
    â”‚   â””â”€ â† [Return]
    â””â”€ â† [Stop]


Script ran successfully.

== Logs ==
  MyERC721Token deployed to: 0x7eA36391c7127A7f40E5c23212A8016d6E494546

## Setting up 1 EVM.
==========================
Simulated On-chain Traces:

  [2072840] â†’ new MyERC721Token@0x7eA36391c7127A7f40E5c23212A8016d6E494546
    â”œâ”€ emit OwnershipTransferred(previousOwner: 0x0000000000000000000000000000000000000000, newOwner: 0x750Ea21c1e98CcED0d4557196B6f4a5974CCB6f5)
    â””â”€ â† [Return] 10002 bytes of code


==========================

Chain 11155111

Estimated gas price: 53.318074191 gwei

Estimated total gas used for script: 2990587

Estimated amount required: 0.159452339540640117 ETH

==========================

##### sepolia
âœ…  [Success]Hash: 0x77190a6bbe59f4b98dc06b1219ca34fcf5cc1ace40f6998bb26568fcb93e5380
Contract Address: 0x7eA36391c7127A7f40E5c23212A8016d6E494546
Block: 6355525
Paid: 0.057633696474121704 ETH (2301162 gas * 25.045475492 gwei)

âœ… Sequence #1 on sepolia | Total Paid: 0.057633696474121704 ETH (2301162 gas * avg 25.045475492 gwei)


==========================

ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.
##
Start verification for (1) contracts
Start verifying contract `0x7eA36391c7127A7f40E5c23212A8016d6E494546` deployed on sepolia

Submitting verification for [src/MyERC721Token.sol:MyERC721Token] 0x7eA36391c7127A7f40E5c23212A8016d6E494546.

Submitting verification for [src/MyERC721Token.sol:MyERC721Token] 0x7eA36391c7127A7f40E5c23212A8016d6E494546.

Submitting verification for [src/MyERC721Token.sol:MyERC721Token] 0x7eA36391c7127A7f40E5c23212A8016d6E494546.
Submitted contract for verification:
        Response: `OK`
        GUID: `bgjivlpsttkmre2wq8etbj9gbv6txntfhwwe3rnh3zzduq12pm`
        URL: https://sepolia.etherscan.io/address/0x7ea36391c7127a7f40e5c23212a8016d6e494546
Contract verification status:
Response: `NOTOK`
Details: `Pending in queue`
Contract verification status:
Response: `OK`
Details: `Pass - Verified`
Contract successfully verified
All (1) contracts were verified!

Transactions saved to: /Users/qiaopengjun/Code/solidity-code/NFTMarketHub/broadcast/MyERC721Token.s.sol/11155111/run-latest.json

Sensitive values saved to: /Users/qiaopengjun/Code/solidity-code/NFTMarketHub/cache/MyERC721Token.s.sol/11155111/run-latest.json


NFTMarketHub on î‚  main [!?] via â¬¢ v22.1.0 via ğŸ…’ base took 1m 27.4s
âœ
```

### æµè§ˆå™¨æŸ¥çœ‹

<https://sepolia.etherscan.io/address/0x7ea36391c7127a7f40e5c23212a8016d6e494546#code>

![image-20240722175829014](/images/image-20240722175829014.png)

## æ€»ç»“

é€šè¿‡æœ¬æ¬¡å®æˆ˜ï¼Œæˆ‘ä»¬æˆåŠŸå¼€å‘å¹¶éƒ¨ç½²äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ERC721 NFTåˆçº¦MyERC721Tokenï¼Œåœ¨Sepoliaæµ‹è¯•ç½‘ä¸Šå®ç°æ•°å­—èµ„äº§çš„åˆ›å»ºä¸ç®¡ç†ã€‚ç»“åˆOpenZeppelinçš„æ ‡å‡†åŒ–å·¥å…·å’ŒFoundryçš„éƒ¨ç½²æµç¨‹ï¼ŒWeb3å¼€å‘è€…å¯ä»¥é«˜æ•ˆæ„å»ºå®‰å…¨å¯é çš„NFTé¡¹ç›®ã€‚æœªæ¥ï¼Œä½ å¯ä»¥æ‰©å±•åˆçº¦åŠŸèƒ½ï¼Œæ¥å…¥NFTå¸‚åœºæˆ–æ¢ç´¢è·¨é“¾åº”ç”¨ï¼Œåœ¨Web3çš„æµªæ½®ä¸­æ‰“é€ å±äºè‡ªå·±çš„æ•°å­—èµ„äº§å¸å›½ã€‚

## å‚è€ƒ

- <https://eips.ethereum.org/EIPS/eip-712>
- <https://eips.ethereum.org/EIPS/eip-2612>
- <https://www.openzeppelin.com/contracts>
- <https://github.com/AmazingAng/WTF-Solidity/blob/main/37_Signature/readme.md>
- <https://github.com/AmazingAng/WTF-Solidity/blob/main/52_EIP712/readme.md>
- <https://github.com/jesperkristensen58/ERC712-Permit-Example>
- <https://book.getfoundry.sh/tutorials/testing-eip712>
