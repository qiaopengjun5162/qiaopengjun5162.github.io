+++
title = "Rust `Thread::Builder` ç”¨æ³•è¯¦è§£ï¼šçº¿ç¨‹å‘½åä¸æ ˆå¤§å°è®¾ç½®"
description = "æœ¬ç¯‡è¯¦è§£ Rust ä¸­ Thread::Builder çš„æ ¸å¿ƒç”¨æ³•ã€‚æ–‡ç« å°†å¸¦ä½ æ·±å…¥å­¦ä¹ å¦‚ä½•é€šè¿‡ Builder ä¸ºçº¿ç¨‹è¿›è¡Œå‘½åï¼Œä»è€Œæå¤§åœ°æ–¹ä¾¿è°ƒè¯•å·¥ä½œï¼›åŒæ—¶ï¼Œä½ ä¹Ÿå°†æŒæ¡å¦‚ä½•è®¾ç½®çº¿ç¨‹çš„æ ˆå¤§å°ï¼Œä»¥åº”å¯¹å†…å­˜è¦æ±‚æ›´é«˜çš„ä»»åŠ¡ã€‚æœ¬æ–‡é€šè¿‡æ¸…æ™°çš„ä»£ç ç¤ºä¾‹ï¼ŒåŠ©ä½ ç²¾å‡†æ§åˆ¶çº¿ç¨‹åˆ›å»ºï¼Œç¼–å†™æ›´å¥å£®çš„å¹¶å‘ç¨‹åºã€‚"
date = 2025-07-29T07:45:50Z
[taxonomies]
categories = ["Rust"]
tags = ["Rust"]
+++

<!-- more -->

# Rust `Thread::Builder` ç”¨æ³•è¯¦è§£ï¼šçº¿ç¨‹å‘½åä¸æ ˆå¤§å°è®¾ç½®

åœ¨ Rust å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œ`thread::spawn` æ˜¯æˆ‘ä»¬åˆ›å»ºçº¿ç¨‹æœ€ç›´æ¥çš„æ–¹å¼ã€‚ä½†å½“é»˜è®¤é…ç½®æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶â€”â€”ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤æ‚çš„è°ƒè¯•ä¸­è¯†åˆ«ç‰¹å®šçº¿ç¨‹ï¼Œæˆ–è€…æŸä¸ªä»»åŠ¡éœ€è¦æ›´å¤§çš„æ ˆç©ºé—´æ—¶â€”â€”`spawn` å‡½æ•°å°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒäº†ã€‚

ä¸ºæ­¤ï¼ŒRust æä¾›äº†æ›´ä¸ºå¼ºå¤§çš„ `std::thread::Builder`ã€‚æœ¬ç¯‡æŒ‡å—å°†è¯¦ç»†è§£æ `Thread::Builder` çš„ä½¿ç”¨æ–¹æ³•ï¼Œé‡ç‚¹è®²è§£å¦‚ä½•åˆ©ç”¨å®ƒå®ç° **çº¿ç¨‹å‘½å** ä¸ **è‡ªå®šä¹‰æ ˆå¤§å°** è¿™ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œå¸®åŠ©ä½ æ›´ç²¾å‡†åœ°æŒæ§çº¿ç¨‹ã€‚

## å®æ“

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ `thread::spawn` å¿«é€Ÿåˆ›å»ºï¼ˆåŸºç¡€æ–¹å¼ï¼‰

åœ¨ Rust ä¸­ï¼Œåˆ›å»ºçº¿ç¨‹æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯è°ƒç”¨ `std::thread::spawn` å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªé—­åŒ…ï¼ˆclosureï¼‰ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨ä¸€ä¸ªæ–°çš„çº¿ç¨‹ä¸Šæ‰§è¡Œè¿™ä¸ªé—­åŒ…é‡Œçš„ä»£ç ã€‚è¿™ç§æ–¹å¼éå¸¸é€‚åˆå¿«é€Ÿå¯åŠ¨ä¸€äº›ç®€å•çš„åå°ä»»åŠ¡ã€‚

**ä¼˜ç‚¹ï¼š**

- **ç®€å•å¿«æ·**ï¼šä¸€è¡Œä»£ç å³å¯å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¯­æ³•éå¸¸ç®€æ´ã€‚

**å±€é™æ€§ï¼š**

- **æ— æ³•é…ç½®**ï¼šé€šè¿‡ `thread::spawn` åˆ›å»ºçš„çº¿ç¨‹ä½¿ç”¨çš„æ˜¯ç³»ç»Ÿçš„é»˜è®¤é…ç½®ã€‚æˆ‘ä»¬æ— æ³•ä¸ºå…¶æŒ‡å®šåç§°ï¼Œä¹Ÿæ— æ³•è°ƒæ•´å…¶æ ˆç©ºé—´å¤§å°ã€‚åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œå½“æ•°åä¸ªæ— åçº¿ç¨‹åŒæ—¶è¿è¡Œæ—¶ï¼Œä¸€æ—¦å‡ºç° panicï¼Œè°ƒè¯•èµ·æ¥ä¼šéå¸¸å›°éš¾ã€‚

**å®æ“ä»£ç ï¼š** ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `spawn` åˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ï¼ŒåŒæ—¶ä¸»çº¿ç¨‹ä¹Ÿåœ¨è¿è¡Œã€‚

```rust
use std::thread;
use std::time::Duration;

fn main() {
  // ä½¿ç”¨ spawn åˆ›å»ºä¸€ä¸ªåŒ¿åçº¿ç¨‹
  thread::spawn(|| {
    for i in 1..10 {
      println!("hi number {i} from the spawned thread!");
      thread::sleep(Duration::from_millis(1));
    }
  });

  // ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡
  for i in 1..5 {
    println!("hi number {i} from the main thread!");
    thread::sleep(Duration::from_millis(1));
  }
  // æ³¨æ„ï¼šä¸»çº¿ç¨‹ç»“æŸåï¼Œspawned çº¿ç¨‹å¯èƒ½ä¼šè¢«ç›´æ¥ç»ˆæ­¢
}
```

**æ³¨æ„**ï¼šè¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°å­çº¿ç¨‹çš„æ¶ˆæ¯æ²¡æœ‰æ‰“å°å®Œç¨‹åºå°±é€€å‡ºäº†ã€‚è¿™æ˜¯å› ä¸ºä¸»çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åä¼šç›´æ¥é€€å‡ºï¼Œè€Œä¸ä¼šç­‰å¾…å­çº¿ç¨‹ç»“æŸã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥ç­‰å¾…å­çº¿ç¨‹å®Œæˆï¼Œè¿™å°±è¦ç”¨åˆ° `JoinHandle`ï¼Œå®ƒä¹Ÿæ­£æ˜¯ `Thread::Builder` åˆ›å»ºçº¿ç¨‹åçš„è¿”å›å€¼ä¹‹ä¸€ã€‚

### æ–¹å¼äºŒï¼šä½¿ç”¨ `Thread::Builder` ç²¾å‡†æ„å»ºï¼ˆæ¨èæ–¹å¼ï¼‰

Rust å¤šçº¿ç¨‹ - çº¿ç¨‹å»ºé€ è€…ï¼ˆThread Builder) åˆ›å»ºçº¿ç¨‹

ä¸ºäº†å¼¥è¡¥ `thread::spawn` åœ¨å¯é…ç½®æ€§ä¸Šçš„ä¸è¶³ï¼ŒRust æä¾›äº† `std::thread::Builder`ã€‚å®ƒæ˜¯ä¸€ä¸ªå…¸å‹çš„â€œå»ºé€ è€…æ¨¡å¼â€å®ç°ï¼Œå…è®¸æˆ‘ä»¬åœ¨åˆ›å»ºçº¿ç¨‹å‰ï¼Œé“¾å¼åœ°è°ƒç”¨å„ç§é…ç½®æ–¹æ³•ï¼Œå®ç°å¯¹çº¿ç¨‹çš„ç²¾ç»†åŒ–æ§åˆ¶ã€‚

### çº¿ç¨‹å‘½å

å¯ä»¥ä½¿ç”¨ `std::thread::Builder` æ¥æ„å»ºä¸€ä¸ªå¸¦åå­—çš„çº¿ç¨‹

- å¦‚æœä¸€ä¸ªå‘½åçº¿ç¨‹å‘ç”Ÿ panicï¼ŒRust ä¼šåœ¨ panic æŠ¥é”™ä¿¡æ¯ä¸­æ‰“å°å‡ºè¯¥çº¿ç¨‹çš„åå­—ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿå®šä½é—®é¢˜ã€‚
- åœ¨çº¿ç¨‹è¿è¡Œæ—¶ï¼Œå®ƒçš„åå­—ä¹Ÿä¼šè¢«æä¾›ç»™æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨ç±» Unix ç³»ç»Ÿä¸­ä¼šä½¿ç”¨ pthread_setname_np è®¾ç½®çº¿ç¨‹åã€‚
- Builder::name()

### çº¿ç¨‹æ ˆå¤§å°ï¼ˆStack Sizeï¼‰

Rust ä¸­æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„æ ˆç©ºé—´å¤§å°ï¼Œè¿™ä¸ªå¤§å°æ˜¯å¹³å°ç›¸å…³çš„ã€‚

- å½“å‰é»˜è®¤è®¾ç½®ï¼šç›®å‰åœ¨æ‰€æœ‰ Tier-1 å¹³å°ï¼ˆRust å®˜æ–¹æ”¯æŒçš„ä¸»å¹³å°ï¼‰ä¸Šï¼Œé»˜è®¤çº¿ç¨‹æ ˆå¤§å°æ˜¯ 2 MiBï¼ˆçº¦ 2 å…†å­—èŠ‚ï¼‰

### è®¾ç½®çº¿ç¨‹æ ˆçš„å¤§å°

- Builder::stack_size()
- è®¾ç½®ç¯å¢ƒå˜é‡ RUST_MIN_STACK
  - ä¾‹å¦‚ï¼šRUST_MIN_STACK=4194304./your_program
  - âš ï¸æ³¨æ„ï¼šå¦‚æœä½ åœ¨ä»£ç ä¸­åŒæ—¶ä½¿ç”¨äº† Builder::stack_sizeï¼Œé‚£ä¹ˆå®ƒä¼šè¦†ç›– RUST_MIN_STACK çš„è®¾ç½®
- ä¸»çº¿ç¨‹ï¼ˆmain å‡½æ•°æ‰€åœ¨çš„çº¿ç¨‹ï¼‰çš„æ ˆå¤§å°ä¸æ˜¯ç”± Rust å†³å®šçš„ï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿæˆ–è€…å¯åŠ¨å™¨æ§åˆ¶çš„ã€‚

### å®Œæ•´é¡¹ç›®å®æˆ˜

ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `Builder` åˆ›å»ºä¸€ä¸ªåä¸º "Thread 1"ï¼Œä¸”æ‹¥æœ‰ 4MB æ ˆç©ºé—´çš„çº¿ç¨‹ã€‚

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®

```bash
cargo new thread_builder
    Creating binary (application) `thread_builder` package
note: see more `Cargo.toml` keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html
```

### ç¬¬äºŒæ­¥ï¼šåˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•

```bash
cd thread_builder
```

### ç¬¬ä¸‰æ­¥ï¼šæŸ¥çœ‹é¡¹ç›®ç›®å½•

```bash
RustJourney/thread_builder on î‚  main [?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 on ğŸ³ v28.2.2 (orbstack)
âœ tree . -L 6 -I "target"
.
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â””â”€â”€ src
    â””â”€â”€ main.rs

2 directories, 3 files

```

### ç¬¬å››æ­¥ï¼šç¼–å†™ä»£ç 

### `src/main.rs` æ–‡ä»¶å†…å®¹å¦‚ä¸‹

```rust
use std::thread;

fn main() {
    let handle = thread::Builder::new()
        .name("Thread 1".into())
        .stack_size(1024 * 1024 * 4)
        .spawn(another_thread)
        .unwrap();

    handle.join().unwrap();
}

fn another_thread() {
    println!(
        "Hello from another thread, my name is {}",
        thread::current().name().unwrap()
    );
}

```

### ç¬¬äº”æ­¥ï¼šç¼–è¯‘å¹¶è¿è¡Œ

```bash
RustJourney/thread_builder on î‚  main [?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 on ğŸ³ v28.2.2 (orbstack)
âœ cargo build
   Compiling thread_builder v0.1.0 (/Users/qiaopengjun/Code/Rust/RustJourney/thread_builder)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.63s

RustJourney/thread_builder on î‚  main [?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 on ğŸ³ v28.2.2 (orbstack)
âœ cargo run
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.00s
     Running `target/debug/thread_builder`
Hello from another thread, my name is Thread 1
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬åˆ›å»ºçš„çº¿ç¨‹ä¸ä»…åŠŸèƒ½æ˜ç¡®ï¼Œè€Œä¸”æ›´æ˜“äºç®¡ç†å’Œç»´æŠ¤ï¼Œæ˜¯æ„å»ºå¥å£®å¹¶å‘ç¨‹åºçš„é¦–é€‰ã€‚

## æ€»ç»“

é€šè¿‡æœ¬ç¯‡æŒ‡å—çš„è¯¦ç»†è§£æï¼Œæˆ‘ä»¬æ·±å…¥äº†è§£äº† `Thread::Builder` ç›¸æ¯” `thread::spawn` æ‰€æä¾›çš„å¼ºå¤§æ§åˆ¶åŠ›ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¸¤ä¸ªæ ¸å¿ƒé…ç½®çš„è¦ç‚¹ï¼š

1. **çº¿ç¨‹å‘½å (`Builder::name`)**: ä¸ºçº¿ç¨‹èµ‹äºˆæœ‰æ„ä¹‰çš„åç§°æ˜¯è°ƒè¯•å¤æ‚å¹¶å‘ç¨‹åºçš„å…³é”®ä¸€æ­¥ã€‚å®ƒèƒ½åœ¨ panic å‘ç”Ÿæ—¶æä¾›æ¸…æ™°çš„ä¸Šä¸‹æ–‡ï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½é—®é¢˜ã€‚
2. **æ ˆå¤§å°è®¾ç½® (`Builder::stack_size`)**: å…è®¸æˆ‘ä»¬ä¸ºç‰¹å®šä»»åŠ¡åˆ†é…å……è¶³çš„æ ˆå†…å­˜ï¼Œæœ‰æ•ˆé¿å…å› é»˜è®¤å€¼ä¸è¶³è€Œå¯¼è‡´çš„æ ˆæº¢å‡ºé£é™©ï¼Œå¢å¼ºäº†ç¨‹åºçš„ç¨³å®šæ€§ã€‚

æ€»ä¹‹ï¼Œç†Ÿç»ƒè¿ç”¨ `Thread::Builder` è¿›è¡Œçº¿ç¨‹å‘½åå’Œæ ˆå¤§å°è®¾ç½®ï¼Œæ˜¯ç¼–å†™ä¸“ä¸šã€å¥å£®çš„ Rust å¹¶å‘åº”ç”¨çš„é‡è¦æŠ€èƒ½ã€‚å¸Œæœ›æœ¬æ–‡çš„è¯¦è§£èƒ½å¸®åŠ©ä½ åœ¨å®é™…é¡¹ç›®ä¸­æ›´å¥½åœ°ç®¡ç†å’Œæ§åˆ¶çº¿ç¨‹ã€‚

## å‚è€ƒ

- <https://www.rust-lang.org/zh-CN>
- <https://course.rs/about-book.html>
- <https://lab.cs.tsinghua.edu.cn/rust/>
- <https://www.rust-lang.org/>
