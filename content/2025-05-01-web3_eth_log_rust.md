+++
title = "ç”¨ Rust è§£é” Web3ï¼šä»¥å¤ªåŠäº‹ä»¶è§£æå®æˆ˜"
description = "ç”¨ Rust è§£é” Web3ï¼šä»¥å¤ªåŠäº‹ä»¶è§£æå®æˆ˜"
date = 2025-05-01T13:25:59Z
[taxonomies]
categories = ["Web3", "Rust", "Ethereum"]
tags = ["Web3", "Rust", "Ethereum"]
+++

<!-- more -->

# ç”¨ Rust è§£é” Web3ï¼šä»¥å¤ªåŠäº‹ä»¶è§£æå®æˆ˜

Web3 æµªæ½®å¸­å·å…¨çƒï¼Œä»¥å¤ªåŠä½œä¸ºåŒºå—é“¾æ ¸å¿ƒå¹³å°ï¼Œé©±åŠ¨ç€æ— æ•°å»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆDAppï¼‰ã€‚å¦‚ä½•é«˜æ•ˆã€å®‰å…¨åœ°ä¸ä»¥å¤ªåŠäº¤äº’ï¼Œæˆä¸ºå¼€å‘è€…é¢ä¸´çš„æŒ‘æˆ˜ã€‚Rustï¼Œä»¥å…¶å“è¶Šçš„æ€§èƒ½å’Œå†…å­˜å®‰å…¨ï¼Œæˆä¸ºæ„å»ºé«˜æ€§èƒ½ Web3 åç«¯çš„ç†æƒ³é€‰æ‹©ã€‚æœ¬æ–‡é€šè¿‡ä¸€ä¸ªå®Œæ•´çš„ Rust é¡¹ç›®ï¼Œå¸¦ä½ å®æˆ˜æ‰“é€ ä»¥å¤ªåŠå®¢æˆ·ç«¯å’Œäº‹ä»¶è§£æå™¨ï¼Œæ·±å…¥æ¢ç´¢å¦‚ä½•ä½¿ç”¨ ethers-rs åº“è¿æ¥èŠ‚ç‚¹ã€è·å–äº¤æ˜“æ”¶æ®å¹¶è§£ææ™ºèƒ½åˆçº¦äº‹ä»¶ã€‚é¡¹ç›®é…å¤‡å®Œå–„çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆ100% ä»£ç è¦†ç›–ç‡ï¼‰å’Œè¦†ç›–ç‡åˆ†æï¼ŒåŠ©ä½ å¿«é€Ÿä¸Šæ‰‹ Rust é©±åŠ¨çš„ Web3 å¼€å‘ã€‚æ— è®ºä½ æ˜¯åŒºå—é“¾æ–°æ‰‹è¿˜æ˜¯èµ„æ·±å¼€å‘è€…ï¼Œè¿™ç¯‡å¹²è´§æ»¡æ»¡çš„æ•™ç¨‹éƒ½å°†ä¸ºä½ è§£é” Web3 çš„æ— é™å¯èƒ½ï¼

æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†ä¸€ä¸ªåŸºäº Rust çš„ Web3 åç«¯é¡¹ç›®ï¼Œä¸“æ³¨äºä»¥å¤ªåŠåŒºå—é“¾äº¤äº’ã€‚é¡¹ç›®é€šè¿‡ `client.rs` å®ç°ä»¥å¤ªåŠå®¢æˆ·ç«¯ï¼Œæ”¯æŒè¿æ¥ RPC èŠ‚ç‚¹ã€è·å–äº¤æ˜“æ”¶æ®å’Œæ—¥å¿—ï¼›é€šè¿‡ `event_parser.rs` è§£ææ™ºèƒ½åˆçº¦çš„ `ConfirmDataStore` äº‹ä»¶ã€‚é¡¹ç›®ç»“æ„æ¨¡å—åŒ–ï¼Œæ”¯æŒ YAML å’Œç¯å¢ƒå˜é‡é…ç½®ï¼Œæ ¸å¿ƒé€»è¾‘åœ¨ main.rs ä¸­å®ç°äº¤æ˜“å’Œæ—¥å¿—çš„å¤„ç†æµç¨‹ã€‚ä»£ç é…å¤‡ 83 ä¸ªå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œè¦†ç›–ç‡è¾¾ 100%ï¼Œä½¿ç”¨ `cargo nextest` å’Œ `cargo llvm-cov` è¿›è¡Œé«˜æ•ˆæµ‹è¯•å’Œè¦†ç›–ç‡åˆ†æã€‚æœ¬æ–‡è¿˜å¯¹æ¯”äº† `cargo test` ä¸ `nextest` çš„ä¼˜åŠ£ï¼Œå¹¶æä¾›ç¼–è¯‘ã€è¿è¡ŒåŠç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šçš„è¯¦ç»†æ­¥éª¤ã€‚æ— è®ºæ˜¯æ„å»ºé«˜æ€§èƒ½ Web3 åº”ç”¨ï¼Œè¿˜æ˜¯å­¦ä¹  Rust åœ¨åŒºå—é“¾ä¸­çš„åº”ç”¨ï¼Œè¿™ç¯‡å®æˆ˜æŒ‡å—éƒ½ä¸ºä½ æä¾›åšå®çš„åŸºç¡€ã€‚

## å®æ“

### é¡¹ç›®ç›®å½•ç»“æ„

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 11.9s 
âœ tree . -L 6 -I "__pycache__|python.egg-info|htmlcov|ethertrace.egg-info|target"
.
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ docs
â”‚   â””â”€â”€ note.md
â”œâ”€â”€ rust-toolchain.toml
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ client.rs
â”‚   â”œâ”€â”€ event_parser.rs
â”‚   â”œâ”€â”€ lib.rs
â”‚   â””â”€â”€ main.rs
â””â”€â”€ tests
    â””â”€â”€ integration.rs

4 directories, 9 files

```

### ä»£ç å®ç°

#### `client.rs` æ–‡ä»¶

```rust
// client.rs
use ethers::prelude::*;
use regex::Regex;
use std::sync::Arc;
use url::Url;

lazy_static::lazy_static! {
    static ref DOMAIN_REGEX: Regex = Regex::new(r"^(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.?)+$").unwrap();
}

#[derive(Debug)]
pub struct EthClient {
    client: Arc<Provider<Http>>,
}

impl EthClient {
    pub async fn new(rpc_url: &str) -> Result<Self, anyhow::Error> {
        // éªŒè¯ RPC URL
        if rpc_url.is_empty() {
            return Err(anyhow::anyhow!("Empty RPC URL"));
        }
        // ä½¿ç”¨ url crate å®‰å…¨è§£æ URL
        let parsed_url = Url::parse(rpc_url).map_err(|_| anyhow::anyhow!("Invalid URL"))?;

        // æ”¯æŒçš„åè®®
        static ALLOWED_SCHEMES: &[&str] = &["http", "https", "ws", "wss"];
        let scheme = parsed_url.scheme();

        if !ALLOWED_SCHEMES.contains(&scheme) {
            return Err(anyhow::anyhow!("Unsupported scheme"));
        }

        // è¿æ¥ä»¥å¤ªåŠèŠ‚ç‚¹
        let provider = Provider::<Http>::try_from(rpc_url)?;
        let client = Arc::new(provider);
        Ok(EthClient { client })
    }

    pub async fn get_tx_receipt_by_hash(
        &self,
        tx_hash: &str,
    ) -> Result<TransactionReceipt, anyhow::Error> {
        let hash: H256 = tx_hash.parse()?;
        let receipt = self
            .client
            .get_transaction_receipt(hash)
            .await?
            .ok_or_else(|| anyhow::anyhow!("Transaction receipt not found"))?;
        Ok(receipt)
    }

    pub async fn get_logs(
        &self,
        block_option: FilterBlockOption,
        addresses: Option<Vec<Address>>,
        topics: Option<Vec<H256>>,
    ) -> Result<Vec<Log>, anyhow::Error> {
        let filter = Filter {
            block_option,
            address: addresses.map(ValueOrArray::Array),
            topics: {
                let mut topics_array = [const { None }; 4];
                if let Some(topics_vec) = topics {
                    for (i, topic) in topics_vec.into_iter().take(4).enumerate() {
                        topics_array[i] = Some(topic.into());
                    }
                }
                topics_array
            },
        };
        let logs = self.client.get_logs(&filter).await?;
        Ok(logs)
    }
}

#[cfg(test)]
mod tests {
    use super::*;
    use std::str::FromStr;

    #[tokio::test]
    async fn test_new_eth_client() {
        let client = EthClient::new("https://rpc.mevblocker.io").await;
        assert!(client.is_ok());
    }

    #[tokio::test]
    async fn test_new_eth_client_invalid_url() {
        let client = EthClient::new("").await;
        assert!(client.is_err());
        assert_eq!(client.unwrap_err().to_string(), "Empty RPC URL");
    }

    #[tokio::test]
    async fn test_get_tx_receipt_by_hash() {
        let client = EthClient::new("https://eth.llamarpc.com").await.unwrap();
        let tx_hash = "0xfd26d40e17213bcafcf94bab9af92343302df9df970f20e1c9d515525e86e23e";
        let receipt = client.get_tx_receipt_by_hash(tx_hash).await;
        assert!(receipt.is_ok());
    }

    #[tokio::test]
    async fn test_get_logs_empty() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let block_option = FilterBlockOption::Range {
            from_block: Some(BlockNumber::Number(0.into())),
            to_block: Some(BlockNumber::Number(0.into())),
        };
        let logs = client.get_logs(block_option, None, None).await.unwrap();
        assert!(logs.is_empty());
    }

    #[tokio::test]
    async fn test_get_logs_range() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let addresses =
            vec![Address::from_str("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap()];
        let block_option = FilterBlockOption::Range {
            from_block: Some(BlockNumber::Number(20483831.into())),
            to_block: Some(BlockNumber::Number(20483833.into())),
        };
        let topics = vec![
            H256::from_str("0x4e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0")
                .unwrap(),
        ];
        let logs = client
            .get_logs(block_option, Some(addresses), Some(topics))
            .await;
        assert!(logs.is_ok());
    }

    #[tokio::test]
    async fn test_get_logs_at_block_hash() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let block_hash =
            H256::from_str("0x4e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0")
                .unwrap();
        let block_option = FilterBlockOption::AtBlockHash(block_hash);
        let logs = client.get_logs(block_option, None, None).await;
        assert!(logs.is_ok() || logs.unwrap_err().to_string().contains("not found"));
    }

    #[tokio::test]
    async fn test_new_eth_client_with_valid_url() {
        let client = EthClient::new("https://rpc.mevblocker.io").await;
        assert!(client.is_ok(), "Expected Ok(EthClient), got error");
    }

    #[tokio::test]
    async fn test_new_eth_client_empty_url() {
        let client = EthClient::new("").await;
        assert!(client.is_err(), "Expected error for empty URL");
        assert_eq!(client.unwrap_err().to_string(), "Empty RPC URL");
    }

    #[tokio::test]
    async fn test_new_eth_client_invalid_scheme() {
        let client = EthClient::new("ftp://example.com").await;
        assert!(client.is_err(), "Expected error for unsupported scheme");
        assert_eq!(client.unwrap_err().to_string(), "Unsupported scheme");
    }

    #[tokio::test]
    async fn test_new_eth_client_missing_scheme() {
        let client = EthClient::new("example.com").await;
        assert!(client.is_err(), "Expected error for missing scheme");
        assert_eq!(client.unwrap_err().to_string(), "Invalid URL");
    }

    #[tokio::test]
    async fn test_get_tx_receipt_by_hash_invalid_format() {
        let client = EthClient::new("https://eth.llamarpc.com").await.unwrap();
        let result = client.get_tx_receipt_by_hash("invalid_hash").await;
        assert!(result.is_err(), "Expected error for invalid hash format");
    }

    #[tokio::test]
    async fn test_get_tx_receipt_by_hash_not_found() {
        let client = EthClient::new("https://eth.llamarpc.com").await.unwrap();
        let tx_hash = "0x0000000000000000000000000000000000000000000000000000000000000000";
        let result = client.get_tx_receipt_by_hash(tx_hash).await;
        assert!(
            result.is_err(),
            "Expected error for non-existent transaction"
        );
        assert!(
            result
                .unwrap_err()
                .to_string()
                .contains("Transaction receipt not found")
        );
    }

    #[tokio::test]
    async fn test_get_tx_receipt_by_hash_success() {
        let client = EthClient::new("https://eth.llamarpc.com").await.unwrap();
        let tx_hash = "0xfd26d40e17213bcafcf94bab9af92343302df9df970f20e1c9d515525e86e23e";
        let result = client.get_tx_receipt_by_hash(tx_hash).await;
        assert!(
            result.is_ok(),
            "Expected successful transaction receipt retrieval"
        );
    }

    #[tokio::test]
    async fn test_get_logs_empty_range() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let block_option = FilterBlockOption::Range {
            from_block: Some(BlockNumber::Number(0.into())),
            to_block: Some(BlockNumber::Number(0.into())),
        };
        let logs = client.get_logs(block_option, None, None).await.unwrap();
        assert!(logs.is_empty(), "Expected no logs in block range 0-0");
    }

    #[tokio::test]
    async fn test_get_logs_with_address_and_topic() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let addresses =
            vec![Address::from_str("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap()];
        let block_option = FilterBlockOption::Range {
            from_block: Some(BlockNumber::Number(20483831.into())),
            to_block: Some(BlockNumber::Number(20483833.into())),
        };
        let topics = vec![
            H256::from_str("0x4e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0")
                .unwrap(),
        ];
        let logs = client
            .get_logs(block_option, Some(addresses), Some(topics))
            .await;
        assert!(logs.is_ok(), "Expected logs or success status");
    }

    #[tokio::test]
    async fn test_get_logs_at_block_hash2() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let block_hash =
            H256::from_str("0x4e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0")
                .unwrap();
        let block_option = FilterBlockOption::AtBlockHash(block_hash);
        let logs = client.get_logs(block_option, None, None).await;
        assert!(
            logs.is_ok() || logs.unwrap_err().to_string().contains("not found"),
            "Expected either logs or 'not found' error"
        );
    }

    #[tokio::test]
    async fn test_new_eth_client_invalid_url_format() {
        let result = EthClient::new("htt:/invalid-url").await;
        assert!(result.is_err(), "Expected error for invalid URL format");
        assert_eq!(result.unwrap_err().to_string(), "Unsupported scheme");

        let result = EthClient::new("invalid-url").await;
        assert!(result.is_err(), "Expected error for invalid URL format");
        assert_eq!(result.unwrap_err().to_string(), "Invalid URL");
    }

    #[tokio::test]
    async fn test_new_eth_client_ws_scheme() {
        let client = EthClient::new("ws://example.com").await;
        assert!(client.is_ok(), "Expected Ok for ws scheme");
    }

    #[tokio::test]
    async fn test_new_eth_client_wss_scheme() {
        let client = EthClient::new("wss://example.com").await;
        assert!(client.is_ok(), "Expected Ok for wss scheme");
    }

    #[tokio::test]
    async fn test_new_eth_client_invalid_provider() {
        let client = EthClient::new("https://invalid-rpc.example.com").await;
        assert!(client.is_ok());
    }

    #[tokio::test]
    async fn test_get_logs_single_topic() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let block_option = FilterBlockOption::Range {
            from_block: Some(BlockNumber::Number(20483831.into())),
            to_block: Some(BlockNumber::Number(20483833.into())),
        };
        let topics = vec![
            H256::from_str("0x4e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0")
                .unwrap(),
        ];
        let logs = client.get_logs(block_option, None, Some(topics)).await;
        assert!(logs.is_ok());
    }

    #[tokio::test]
    async fn test_get_logs_no_topics() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let block_option = FilterBlockOption::Range {
            from_block: Some(BlockNumber::Number(20483831.into())),
            to_block: Some(BlockNumber::Number(20483833.into())),
        };
        let logs = client.get_logs(block_option, None, None).await;
        assert!(logs.is_ok());
    }

    #[tokio::test]
    async fn test_new_eth_client_domain_regex() {
        // æµ‹è¯•å¤æ‚åŸŸå
        let client = EthClient::new("https://sub.domain.example.com").await;
        assert!(client.is_ok());
        // æµ‹è¯•æ— æ•ˆåŸŸå
        let client = EthClient::new("https://invalid..domain.com").await;
        assert!(client.is_ok());
    }

    #[tokio::test]
    async fn test_get_logs_four_topics() {
        let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
        let block_option = FilterBlockOption::Range {
            from_block: Some(BlockNumber::Number(20483831.into())),
            to_block: Some(BlockNumber::Number(20483833.into())),
        };
        let topics = vec![
            H256::from_str("0x4e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0").unwrap(),
            H256::from_str("0x5e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0").unwrap(),
            H256::from_str("0x6e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0").unwrap(),
            H256::from_str("0x7e3a3754410177e6937ef1d0c0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0e0d0a0b0").unwrap(),
        ];
        let logs = client.get_logs(block_option, None, Some(topics)).await;
        assert!(logs.is_ok());
    }
}

```

#### `event_parser.rs` æ–‡ä»¶

```rust
use ethers::{
    abi::{Event, EventParam, ParamType, RawLog},
    types::{Address, H256, Log},
};
use std::str::FromStr;
use anyhow::anyhow;

#[derive(Debug, Clone)]
pub struct ConfirmDataStoreData {
    pub data_store_id: u32,
    pub header_hash: H256,
}

#[derive(Debug)]
pub struct EventParser {
    event_abi: Event,
    event_hash: H256,
    contract_addr: Address,
}

impl EventParser {
    pub fn new(contract_addr: &str) -> Result<Self, anyhow::Error> {
        // éªŒè¯åˆçº¦åœ°å€
        if contract_addr.is_empty() {
            return Err(anyhow::anyhow!("Contract address cannot be empty"));
        }
        if !contract_addr.starts_with("0x") || contract_addr.len() != 42 {
            return Err(anyhow::anyhow!("Invalid contract address format"));
        }

        // æ£€æŸ¥æ˜¯å¦æ˜¯æœ‰æ•ˆçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²
        let hex_part = &contract_addr[2..];
        if hex_part.as_bytes().iter().any(|b| !b.is_ascii_hexdigit()) {
            return Err(anyhow::anyhow!("Contract address contains invalid hex characters"));
        }

        let addr = Address::from_str(contract_addr)?;
        if addr == Address::zero() {
            return Err(anyhow::anyhow!("Contract address cannot be zero"));
        }

        // å®šä¹‰ ConfirmDataStore äº‹ä»¶ ABI
        let event_abi = Event {
            name: "ConfirmDataStore".to_string(),
            inputs: vec![
                EventParam {
                    name: "dataStoreId".to_string(),
                    kind: ParamType::Uint(32),
                    indexed: false,
                },
                EventParam {
                    name: "headerHash".to_string(),
                    kind: ParamType::FixedBytes(32),
                    indexed: false,
                },
            ],
            anonymous: false,
        };

        // è®¡ç®—äº‹ä»¶ç­¾åå“ˆå¸Œ
        let event_hash = H256::from(ethers::utils::keccak256("ConfirmDataStore(uint32,bytes32)"));

        Ok(EventParser {
            event_abi,
            event_hash,
            contract_addr: addr,
        })
    }

    pub fn event_hash(&self) -> H256 {
        self.event_hash
    }
    pub fn parse_logs(&self, logs: Vec<Log>) -> Result<Vec<ConfirmDataStoreData>, anyhow::Error> {
        let mut results = Vec::with_capacity(logs.len() / 2);

        for log in logs {
            // æ£€æŸ¥æ—¥å¿—æ˜¯å¦æ¥è‡ªæ­£ç¡®çš„åˆçº¦åœ°å€å’Œäº‹ä»¶å“ˆå¸Œ
            if log.address != self.contract_addr ||
                log.topics.get(0) != Some(&self.event_hash) {
                continue;
            }

            let raw_log = RawLog {
                topics: log.topics,
                data: log.data.to_vec(),
            };

            let tokens = self.event_abi.parse_log(raw_log)?;

            let data_store_id = tokens.params.get(0)
                .ok_or(anyhow!("Missing dataStoreId"))?
                .value.clone()
                .into_uint()
                .ok_or(anyhow!("Invalid dataStoreId type"))?
                .as_u32();

            let bytes = tokens.params.get(1)
                .ok_or(anyhow!("Missing headerHash"))?
                .value.clone()
                .into_fixed_bytes()
                .ok_or(anyhow!("Invalid headerHash type"))?;

            // let mut arr = [0u8; 32];
            // arr.copy_from_slice(&bytes);
            // let header_hash = H256::from(arr);
            let header_hash = H256::from_slice(&bytes);

            results.push(ConfirmDataStoreData {
                data_store_id,
                header_hash,
            });
        }
        Ok(results)
    }
}

#[cfg(test)]
mod tests {
    use super::*;
    use ethers::types::{Address, H256, Log};
    use std::str::FromStr;

    #[test]
    fn test_new_event_parser() {
        let parser = EventParser::new("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1");
        assert!(parser.is_ok());
    }

    #[test]
    fn test_new_event_parser_invalid_address() {
        let parser = EventParser::new("0xInvalidAddress");
        assert!(parser.is_err());
        assert_eq!(parser.unwrap_err().to_string(), "Invalid contract address format");
    }

    #[test]
    fn test_parse_logs_single_valid_log() {
        let parser = EventParser::new("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap();
        let logs = vec![Log {
            address: Address::from_str("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap(),
            topics: vec![parser.event_hash()],
            data: hex::decode("00000000000000000000000000000000000000000000000000000000000089ba27bc30064cc44c6aef26ca2d7e4ee667592949a50f4f01d8d4632461a12f2243").unwrap().into(),
            ..Default::default()
        }];
        let results = parser.parse_logs(logs).unwrap();
        assert_eq!(results.len(), 1);
        assert_eq!(results[0].data_store_id, 35258);
        assert_eq!(
            results[0].header_hash,
            H256::from_str("0x27bc30064cc44c6aef26ca2d7e4ee667592949a50f4f01d8d4632461a12f2243").unwrap()
        );
    }

    #[test]
    fn test_parse_logs_empty() {
        let parser = EventParser::new("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap();
        let logs = vec![].into();
        let results = parser.parse_logs(logs).unwrap();
        assert!(results.is_empty());
    }

    #[test]
    fn test_new_event_parser_missing_prefix() {
        let parser = EventParser::new("InvalidAddress");
        assert!(parser.is_err());
        assert_eq!(parser.unwrap_err().to_string(), "Invalid contract address format");
    }

    #[test]
    fn test_event_hash() {
        let parser = EventParser::new("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap();
        let hash = parser.event_hash();
        assert_eq!(
            hash,
            H256::from(ethers::utils::keccak256("ConfirmDataStore(uint32,bytes32)"))
        );
    }

    #[test]
    fn test_parse_logs_non_matching() {
        let parser = EventParser::new("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap();
        let logs = vec![Log {
            address: Address::from_str("0x0000000000000000000000000000000000000001").unwrap(),
            topics: vec![H256::zero()],
            data: vec![].into(),
            ..Default::default()
        }];
        let results = parser.parse_logs(logs).unwrap();
        assert!(results.is_empty());
    }

    #[test]
    fn test_parse_logs_invalid_data() -> Result<(), anyhow::Error> {
        let parser = EventParser::new("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap();
        let logs = vec![Log {
            address: Address::from_str("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap(),
            topics: vec![parser.event_hash()],
            data: vec![0u8; 32].into(), // æ— æ•ˆæ•°æ®
            ..Default::default()
        }];
        let results = parser.parse_logs(logs);
        println!("results: {:#?}", results);
        assert!(results.is_err());
        assert!(results.unwrap_err().to_string().contains("Invalid data"));
        // assert_eq!(results.unwrap_err().to_string(), "Invalid data");
        Ok(())
    }

    #[test]
    fn test_new_event_parser_empty_address() {
        let parser = EventParser::new("");
        assert!(parser.is_err());
        assert_eq!(parser.unwrap_err().to_string(), "Contract address cannot be empty");
    }

    #[test]
    fn test_new_event_parser_invalid_format() {
        let parser = EventParser::new("0xInvalidAddress");
        assert!(parser.is_err());
        assert_eq!(parser.unwrap_err().to_string(), "Invalid contract address format");
    }

    #[test]
    fn test_new_event_parser_invalid_hex() {
        let parser = EventParser::new("0xGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG");
        assert!(parser.is_err());
        assert_eq!(parser.unwrap_err().to_string(), "Contract address contains invalid hex characters");
    }

    #[test]
    fn test_new_event_parser_zero_address() {
        let parser = EventParser::new("0x0000000000000000000000000000000000000000");
        assert!(parser.is_err());
        assert_eq!(parser.unwrap_err().to_string(), "Contract address cannot be zero");
    }

    #[test]
    fn test_parse_logs_multiple_logs_mixed() {
        let parser = EventParser::new("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap();
        let logs = vec![
            Log {
                address: Address::from_str("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap(),
                topics: vec![parser.event_hash()],
                data: hex::decode("00000000000000000000000000000000000000000000000000000000000089ba27bc30064cc44c6aef26ca2d7e4ee667592949a50f4f01d8d4632461a12f2243").unwrap().into(),
                ..Default::default()
            },
            Log {
                address: Address::from_str("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap(),
                topics: vec![H256::zero()], // éåŒ¹é…ä¸»é¢˜
                data: vec![].into(),
                ..Default::default()
            },
            Log {
                address: Address::from_str("0x0000000000000000000000000000000000000001").unwrap(), // éåŒ¹é…åœ°å€
                topics: vec![parser.event_hash()],
                data: vec![].into(),
                ..Default::default()
            },
            Log {
                address: Address::from_str("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap(),
                topics: vec![parser.event_hash()],
                data: hex::decode("00000000000000000000000000000000000000000000000000000000000089bb27bc30064cc44c6aef26ca2d7e4ee667592949a50f4f01d8d4632461a12f2244").unwrap().into(),
                ..Default::default()
            },
        ];
        let results = parser.parse_logs(logs).unwrap();
        assert_eq!(results.len(), 2);
        assert_eq!(results[0].data_store_id, 35258);
        assert_eq!(results[1].data_store_id, 35259);
    }

}
```

#### `lib.rs` æ–‡ä»¶

```rust
// src/lib.rs
pub mod client;
pub mod event_parser;
```

#### `main.rs` æ–‡ä»¶

```rust
#![feature(coverage_attribute)]

use dotenv::dotenv;
use ethers::types::{Address, BlockNumber, FilterBlockOption};
use log::{debug, info};
use serde::Deserialize;
use std::str::FromStr;
use std::{env, fs};
use tracing::instrument;

mod client;
mod event_parser;

use client::EthClient;
use event_parser::EventParser;

#[derive(Debug, Deserialize)]
struct Config {
    rpc_url: String,
    contract_addr: String,
    tx_hash_example: String,
    start_block: u64,
    end_block: u64,
}

trait ConfigLoader {
    fn load(&self) -> Result<Config, anyhow::Error>;
}

struct YamlConfigLoader;
impl ConfigLoader for YamlConfigLoader {
    fn load(&self) -> Result<Config, anyhow::Error> {
        let content = fs::read_to_string("config.yaml")?;
        serde_yaml::from_str(&content).map_err(Into::into)
    }
}

struct EnvConfigLoader;
impl ConfigLoader for EnvConfigLoader {
    fn load(&self) -> Result<Config, anyhow::Error> {
        dotenv().ok();
        Ok(Config {
            rpc_url: env::var("RPC_URL").map_err(|_| anyhow::anyhow!("RPC_URL not set in .env"))?,
            contract_addr: env::var("CONTRACT_ADDR")
                .unwrap_or("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1".to_string()),
            tx_hash_example: env::var("TX_HASH_EXAMPLE").unwrap_or(
                "0xfd26d40e17213bcafcf94bab9af92343302df9df970f20e1c9d515525e86e23e".to_string(),
            ),
            start_block: env::var("START_BLOCK")
                .map(|s| s.parse::<u64>().expect("Invalid START_BLOCK"))
                .unwrap_or(20483831),
            end_block: env::var("END_BLOCK")
                .map(|s| s.parse::<u64>().expect("Invalid END_BLOCK"))
                .unwrap_or(20483833),
        })
    }
}

fn load_config() -> Result<Config, anyhow::Error> {
    let loader = YamlConfigLoader;
    loader.load().or_else(|_| EnvConfigLoader.load())
}

#[instrument(skip(config, client, parser))]
async fn run(config: Config, client: EthClient, parser: EventParser) -> Result<(), anyhow::Error> {
    info!("Connected to Ethereum node at {}", config.rpc_url);

    // ç¤ºä¾‹ 1: è·å–äº¤æ˜“æ”¶æ®å¹¶è§£ææ—¥å¿—
    let receipt = client
        .get_tx_receipt_by_hash(&config.tx_hash_example)
        .await
        .map_err(|e| {
            anyhow::anyhow!(
                "Failed to get receipt for tx {}: {}",
                config.tx_hash_example,
                e
            )
        })?;
    debug!(
        "Receipt details: logs_len={}, tx_hash={:?}, tx_index={:?}, block_hash={:?}, block_number={:?}",
        receipt.logs.len(),
        receipt.transaction_hash,
        receipt.transaction_index,
        receipt.block_hash,
        receipt.block_number
    );

    let tx_results = parser.parse_logs(receipt.logs)?;
    if tx_results.is_empty() {
        info!(
            "No ConfirmDataStore events found in transaction {}",
            config.tx_hash_example
        );
    } else {
        for (i, result) in tx_results.iter().enumerate() {
            info!(
                "Tx Receipt {} - DataStoreID: {}, HeaderHash: 0x{}",
                i + 1,
                result.data_store_id,
                hex::encode(result.header_hash)
            );
        }
    }

    // ç¤ºä¾‹ 2: è·å–åŒºå—èŒƒå›´å†…çš„æ—¥å¿—å¹¶è§£æ
    let addresses = vec![Address::from_str(&config.contract_addr)?];
    let block_option = FilterBlockOption::Range {
        from_block: Some(BlockNumber::Number(config.start_block.into())),
        to_block: Some(BlockNumber::Number(config.end_block.into())),
    };
    let topics = vec![parser.event_hash()];
    let logs = client
        .get_logs(block_option, Some(addresses), Some(topics))
        .await?;

    debug!("Retrieved {} logs", logs.len());
    let log_results = parser.parse_logs(logs)?;
    if log_results.is_empty() {
        info!(
            "No ConfirmDataStore events found in blocks {} to {}",
            config.start_block, config.end_block
        );
    } else {
        for (i, result) in log_results.iter().enumerate() {
            info!(
                "Log {} - DataStoreID: {}, HeaderHash: 0x{}",
                i + 1,
                result.data_store_id,
                hex::encode(result.header_hash)
            );
        }
    }

    Ok(())
}

#[tokio::main]
#[coverage(off)]
async fn main() -> Result<(), anyhow::Error> {
    tracing_subscriber::fmt::init();
    let config = load_config().map_err(|e| anyhow::anyhow!("Failed to load config: {}", e))?;
    info!("Loaded config: {:?}", config);

    let client = EthClient::new(&config.rpc_url)
        .await
        .map_err(|e| anyhow::anyhow!("Failed to initialize client: {}", e))?;
    let parser = EventParser::new(&config.contract_addr)
        .map_err(|e| anyhow::anyhow!("Failed to initialize parser: {}", e))?;

    run(config, client, parser).await
}

#[cfg(test)]
mod tests {
    use super::*;

    #[tokio::test]
    async fn test_main_run() {
        let config = Config {
            rpc_url: "https://rpc.mevblocker.io".to_string(),
            contract_addr: String::from("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1"),
            tx_hash_example: String::from(
                "0xfd26d40e17213bcafcf94bab9af92343302df9df970f20e1c9d515525e86e23e",
            ),
            start_block: 20483831,
            end_block: 20483833,
        };
        let client = EthClient::new(&config.rpc_url).await.unwrap();
        let parser = EventParser::new(&config.contract_addr).unwrap();
        let result = run(config, client, parser).await;
        assert!(result.is_ok());
    }

    #[test]
    fn test_load_config_from_yaml() {
        let yaml_content = r#"
            rpc_url: "https://rpc.yaml.io"
            contract_addr: "0xabcdef1234567890abcdef1234567890abcdef12"
            tx_hash_example: "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
            start_block: 5000
            end_block: 6000
        "#;
        fs::write("config.yaml", yaml_content).unwrap();
        let config = YamlConfigLoader.load().unwrap();
        println!("config: {:#?}", config);
        assert_eq!(config.rpc_url, "https://rpc.yaml.io");
        assert_eq!(
            config.contract_addr,
            "0xabcdef1234567890abcdef1234567890abcdef12"
        );
        assert_eq!(config.start_block, 5000);
        assert_eq!(config.end_block, 6000);
        fs::remove_file("config.yaml").unwrap();
    }

    #[tokio::test]
    async fn test_run_empty_receipt() {
        let config = Config {
            rpc_url: "https://rpc.mevblocker.io".to_string(),
            contract_addr: "0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1".to_string(),
            tx_hash_example: "0x0000000000000000000000000000000000000000000000000000000000000000"
                .to_string(),
            start_block: 20483831,
            end_block: 20483833,
        };
        let client = EthClient::new(&config.rpc_url).await.unwrap();
        let parser = EventParser::new(&config.contract_addr).unwrap();
        let result = run(config, client, parser).await;
        assert!(result.is_err());
        assert!(
            result
                .unwrap_err()
                .to_string()
                .contains("Transaction receipt not found")
        );
    }

    #[tokio::test]
    async fn test_run_valid_receipt() {
        let config = Config {
            rpc_url: "https://rpc.mevblocker.io".to_string(),
            contract_addr: "0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1".to_string(),
            tx_hash_example: "0xfd26d40e17213bcafcf94bab9af92343302df9df970f20e1c9d515525e86e23e"
                .to_string(),
            start_block: 20483831,
            end_block: 20483833,
        };
        let client = EthClient::new(&config.rpc_url).await.unwrap();
        let parser = EventParser::new(&config.contract_addr).unwrap();
        let result = run(config, client, parser).await;
        assert!(result.is_ok());
    }

    #[tokio::test]
    async fn test_run_empty_logs() {
        let config = Config {
            rpc_url: "https://rpc.mevblocker.io".to_string(),
            contract_addr: "0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1".to_string(),
            tx_hash_example: "0x0000000000000000000000000000000000000000000000000000000000000000"
                .to_string(),
            start_block: 0,
            end_block: 0,
        };
        let client = EthClient::new(&config.rpc_url).await.unwrap();
        let parser = EventParser::new(&config.contract_addr).unwrap();
        let result = run(config, client, parser).await;

        assert!(result.is_err());
        assert!(
            result
                .unwrap_err()
                .to_string()
                .contains("Failed to get receipt for tx")
        );
    }

    #[test]
    fn test_load_config_invalid_yaml() {
        let yaml_content = r#"
            rpc_url: "https://rpc.yaml.io"
            contract_addr: "0xabcdef1234567890abcdef1234567890abcdef12"
            tx_hash_example: "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef"
            start_block: "invalid" # æ— æ•ˆçš„ u64
        "#;
        fs::write("config.yaml", yaml_content).unwrap();
        let result = YamlConfigLoader.load();
        println!("result: {:#?}", result);
        assert!(result.is_err());
        assert!(result.unwrap_err().to_string().contains("invalid type"));
        fs::remove_file("config.yaml").unwrap();
    }

    #[test]
    fn test_load_config() {
        let result = load_config();
        assert!(result.is_ok());
    }

    #[tokio::test]
    async fn test_run_get_logs_error() {
        let config = Config {
            rpc_url: "https://invalid-rpc.example.com".to_string(),
            contract_addr: "0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1".to_string(),
            tx_hash_example: "0x0000000000000000000000000000000000000000000000000000000000000000"
                .to_string(),
            start_block: 20483831,
            end_block: 20483833,
        };
        let client = EthClient::new(&config.rpc_url).await.unwrap();
        let parser = EventParser::new(&config.contract_addr).unwrap();
        let result = run(config, client, parser).await;
        println!("result: {:#?}", result);
        assert!(result.is_err());
        assert!(
            result
                .unwrap_err()
                .to_string()
                .contains("Failed to get receipt")
        );
    }
}

```

#### `integration.rs` æ–‡ä»¶

```rust
// tests/integration.rs
use ethers::types::{Address, BlockNumber, FilterBlockOption};
use std::str::FromStr;
use rust::client::EthClient;
use rust::event_parser::EventParser;

#[tokio::test]
async fn test_client_and_parser_integration() {
    let client = EthClient::new("https://rpc.mevblocker.io").await.unwrap();
    let parser = EventParser::new("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap();
    let addresses = vec![Address::from_str("0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1").unwrap()];
    let block_option = FilterBlockOption::Range {
        from_block: Some(BlockNumber::Number(20483831.into())),
        to_block: Some(BlockNumber::Number(20483833.into())),
    };
    let logs = client.get_logs(block_option, Some(addresses), Some(vec![parser.event_hash()])).await.unwrap();
    let results = parser.parse_logs(logs).unwrap();
    assert!(!results.is_empty());
}

```

### ç¼–è¯‘å¹¶è¿è¡Œå½“å‰é¡¹ç›®

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 4.1s 
âœ cargo run # # é»˜è®¤è¿è¡Œï¼ˆDebug æ¨¡å¼ï¼‰
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.50s
     Running `target/debug/rust`
2025-05-01T03:43:23.436211Z  INFO rust: Loaded config: Config { rpc_url: "https://eth.llamarpc.com", contract_addr: "0x5BD63a7ECc13b955C4F57e3F12A64c10263C14c1", tx_hash_example: "0xfd26d40e17213bcafcf94bab9af92343302df9df970f20e1c9d515525e86e23e", start_block: 20483831, end_block: 20483833 }    
2025-05-01T03:43:23.440658Z  INFO run: rust: Connected to Ethereum node at https://eth.llamarpc.com    
Error: Failed to get receipt for tx 0xfd26d40e17213bcafcf94bab9af92343302df9df970f20e1c9d515525e86e23e: Deserialization Error: expected value at line 1 column 1. Response: error code: 1015

```

### `cargo nextest run` å’Œ `cargo test` çš„åŒºåˆ«

|      ç‰¹æ€§      |    `cargo nextest run`     |      `cargo test`      |
| :------------: | :------------------------: | :--------------------: |
| **æµ‹è¯•å¹¶è¡ŒåŒ–** |    åŠ¨æ€æ™ºèƒ½è°ƒåº¦ï¼ˆæ›´å¿«ï¼‰    |     æŒ‰æ–‡ä»¶é¡ºåºæ‰§è¡Œ     |
|  **è¾“å‡ºæŠ¥å‘Š**  |  å½©è‰²åˆ†çº§å±•ç¤º + è€—æ—¶æ’åº   |      åŸå§‹æ–‡æœ¬è¾“å‡º      |
|  **å¢é‡æµ‹è¯•**  |    æ”¯æŒä»…è¿è¡Œä¿®æ”¹çš„æµ‹è¯•    |    éœ€æ‰‹åŠ¨æŒ‡å®šæµ‹è¯•å    |
|  **è¿›ç¨‹éš”ç¦»**  | æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿›ç¨‹ï¼ˆæ›´ç¨³å®šï¼‰ | é»˜è®¤åŒè¿›ç¨‹å¯èƒ½ç›¸äº’å¹²æ‰° |
|  **ç¼“å­˜æœºåˆ¶**  |    è‡ªåŠ¨è·³è¿‡æœªå˜æ›´çš„æµ‹è¯•    |           æ—            |

### è¿è¡Œæµ‹è¯•

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 
âœ cargo test
   Compiling predicates-core v1.0.9
   Compiling termtree v0.5.1
   Compiling anstyle v1.0.10
   Compiling fragile v2.0.1
   Compiling downcast v0.11.0
   Compiling mockall_derive v0.13.1
   Compiling predicates-tree v1.0.12
   Compiling predicates v3.1.3
   Compiling mockall v0.13.1
   Compiling rust v0.1.0 (/Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 3.53s
     Running unittests src/lib.rs (target/debug/deps/rust-f1e062b72a7ea26e)

running 37 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 37 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 4.87s

     Running unittests src/main.rs (target/debug/deps/rust-d878354c53ba62e3)

running 45 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test tests::test_load_config ... ok
test tests::test_load_config_from_yaml ... ok
test tests::test_load_config_invalid_yaml ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test tests::test_run_empty_logs ... ok
test tests::test_run_get_logs_error ... ok
test tests::test_run_empty_receipt ... ok
test tests::test_main_run ... ok
test tests::test_run_valid_receipt ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 45 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 4.44s

     Running tests/integration.rs (target/debug/deps/integration-aa4dacd5be11cac4)

running 1 test
test test_client_and_parser_integration ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.98s

   Doc-tests rust

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s


ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 15.5s 
âœ cargo nextest run                            
    Finished `test` profile [unoptimized + debuginfo] target(s) in 0.21s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 Nextest run ID 1eafe0f3-9d9f-4385-bf67-752b7db71c2c with nextest profile: default
    Starting 83 tests across 3 binaries
        PASS [   0.120s] rust client::tests::test_get_tx_receipt_by_hash_invalid_format
        PASS [   0.597s] rust client::tests::test_get_tx_receipt_by_hash_not_found
        PASS [   0.601s] rust client::tests::test_get_tx_receipt_by_hash
        PASS [   0.482s] rust client::tests::test_get_tx_receipt_by_hash_success
        PASS [   0.013s] rust client::tests::test_new_eth_client_empty_url
        PASS [   0.053s] rust client::tests::test_new_eth_client_domain_regex
        PASS [   0.056s] rust client::tests::test_new_eth_client
        PASS [   0.045s] rust client::tests::test_new_eth_client_invalid_provider
        PASS [   0.008s] rust client::tests::test_new_eth_client_invalid_url
        PASS [   0.008s] rust client::tests::test_new_eth_client_invalid_scheme
        PASS [   0.007s] rust client::tests::test_new_eth_client_invalid_url_format
        PASS [   0.008s] rust client::tests::test_new_eth_client_missing_scheme
        PASS [   0.037s] rust client::tests::test_new_eth_client_with_valid_url
        PASS [   0.036s] rust client::tests::test_new_eth_client_ws_scheme
        PASS [   0.035s] rust client::tests::test_new_eth_client_wss_scheme
        PASS [   0.007s] rust event_parser::tests::test_event_hash
        PASS [   0.007s] rust event_parser::tests::test_new_event_parser
        PASS [   0.007s] rust event_parser::tests::test_new_event_parser_empty_address
        PASS [   0.006s] rust event_parser::tests::test_new_event_parser_invalid_address
        PASS [   0.006s] rust event_parser::tests::test_new_event_parser_invalid_format
        PASS [   0.006s] rust event_parser::tests::test_new_event_parser_invalid_hex
        PASS [   0.006s] rust event_parser::tests::test_new_event_parser_missing_prefix
        PASS [   0.006s] rust event_parser::tests::test_new_event_parser_zero_address
        PASS [   0.006s] rust event_parser::tests::test_parse_logs_empty
        PASS [   0.006s] rust event_parser::tests::test_parse_logs_invalid_data
        PASS [   0.007s] rust event_parser::tests::test_parse_logs_multiple_logs_mixed
        PASS [   0.006s] rust event_parser::tests::test_parse_logs_non_matching
        PASS [   0.006s] rust event_parser::tests::test_parse_logs_single_valid_log
        PASS [   0.931s] rust client::tests::test_get_logs_at_block_hash2
        PASS [   0.941s] rust client::tests::test_get_logs_range
        PASS [   0.957s] rust client::tests::test_get_logs_empty
        PASS [   0.959s] rust client::tests::test_get_logs_single_topic
        PASS [   0.961s] rust client::tests::test_get_logs_at_block_hash
        PASS [   0.965s] rust client::tests::test_get_logs_empty_range
        PASS [   0.969s] rust client::tests::test_get_logs_four_topics
        PASS [   1.040s] rust client::tests::test_get_logs_with_address_and_topic
        PASS [   0.868s] rust::integration test_client_and_parser_integration
        PASS [   0.889s] rust::bin/rust client::tests::test_get_logs_at_block_hash
        PASS [   0.030s] rust::bin/rust client::tests::test_get_tx_receipt_by_hash_invalid_format
        PASS [   0.927s] rust::bin/rust client::tests::test_get_logs_at_block_hash2
        PASS [   0.023s] rust::bin/rust client::tests::test_new_eth_client
        PASS [   0.022s] rust::bin/rust client::tests::test_new_eth_client_domain_regex
        PASS [   0.007s] rust::bin/rust client::tests::test_new_eth_client_empty_url
        PASS [   0.023s] rust::bin/rust client::tests::test_new_eth_client_invalid_provider
        PASS [   0.007s] rust::bin/rust client::tests::test_new_eth_client_invalid_scheme
        PASS [   0.006s] rust::bin/rust client::tests::test_new_eth_client_invalid_url
        PASS [   0.006s] rust::bin/rust client::tests::test_new_eth_client_invalid_url_format
        PASS [   0.007s] rust::bin/rust client::tests::test_new_eth_client_missing_scheme
        PASS [   0.830s] rust::bin/rust client::tests::test_get_logs_empty_range
        PASS [   0.845s] rust::bin/rust client::tests::test_get_logs_empty
        PASS [   0.027s] rust::bin/rust client::tests::test_new_eth_client_with_valid_url
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_event_hash
        PASS [   0.841s] rust::bin/rust client::tests::test_get_logs_four_topics
        PASS [   0.032s] rust::bin/rust client::tests::test_new_eth_client_ws_scheme
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_new_event_parser
        PASS [   0.006s] rust::bin/rust event_parser::tests::test_new_event_parser_empty_address
        PASS [   0.030s] rust::bin/rust client::tests::test_new_eth_client_wss_scheme
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_new_event_parser_invalid_address
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_new_event_parser_invalid_format
        PASS [   0.006s] rust::bin/rust event_parser::tests::test_new_event_parser_invalid_hex
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_new_event_parser_missing_prefix
        PASS [   0.006s] rust::bin/rust event_parser::tests::test_new_event_parser_zero_address
        PASS [   0.006s] rust::bin/rust event_parser::tests::test_parse_logs_empty
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_parse_logs_invalid_data
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_parse_logs_multiple_logs_mixed
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_parse_logs_non_matching
        PASS [   0.006s] rust::bin/rust event_parser::tests::test_parse_logs_single_valid_log
        PASS [   0.007s] rust::bin/rust tests::test_load_config
        PASS [   0.007s] rust::bin/rust tests::test_load_config_from_yaml
        PASS [   0.006s] rust::bin/rust tests::test_load_config_invalid_yaml
        PASS [   0.884s] rust::bin/rust client::tests::test_get_logs_range
        PASS [   0.881s] rust::bin/rust client::tests::test_get_logs_single_topic
        PASS [   0.883s] rust::bin/rust client::tests::test_get_logs_with_address_and_topic
        PASS [   0.895s] rust::bin/rust client::tests::test_get_tx_receipt_by_hash
        PASS [   0.490s] rust::bin/rust client::tests::test_get_tx_receipt_by_hash_success
        PASS [   0.380s] rust::bin/rust tests::test_run_get_logs_error
        PASS [   0.763s] rust::bin/rust client::tests::test_get_tx_receipt_by_hash_not_found
        PASS [   0.861s] rust::bin/rust tests::test_run_empty_receipt
        PASS [   0.911s] rust::bin/rust tests::test_run_empty_logs
        PASS [   1.206s] rust::bin/rust tests::test_run_valid_receipt
        PASS [   1.244s] rust::bin/rust tests::test_main_run
        PASS [   4.798s] rust client::tests::test_get_logs_no_topics
        PASS [   4.375s] rust::bin/rust client::tests::test_get_logs_no_topics
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Summary [   5.335s] 83 tests run: 83 passed, 0 skipped
```

### `cargo llvm-cov --all-features --workspace --tests` å’Œ `cargo llvm-cov` å…³é”®åŒºåˆ«

| ç‰¹æ€§             | cargo llvm-cov                               | cargo llvm-cov --all-features --workspace --tests |
| ---------------- | -------------------------------------------- | ------------------------------------------------- |
| æµ‹è¯•èŒƒå›´         | å½“å‰ crate çš„æµ‹è¯•                            | å·¥ä½œç©ºé—´ä¸­æ‰€æœ‰ crate çš„æµ‹è¯•                       |
| åŠŸèƒ½ï¼ˆFeaturesï¼‰ | ä»…é»˜è®¤åŠŸèƒ½                                   | æ‰€æœ‰åŠŸèƒ½ï¼ˆé»˜è®¤ + å¯é€‰ï¼‰                           |
| æµ‹è¯•ç±»å‹         | æ‰€æœ‰æµ‹è¯•ï¼ˆå•å…ƒã€é›†æˆã€æ–‡æ¡£ç­‰ï¼Œè§†ä¸Šä¸‹æ–‡è€Œå®šï¼‰ | ä»…å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼ˆç”± --tests æ˜¾å¼æŒ‡å®šï¼‰       |
| è¦†ç›–ç‡æŠ¥å‘ŠèŒƒå›´   | å½“å‰ crate                                   | æ•´ä¸ªå·¥ä½œç©ºé—´ï¼ˆæ‰€æœ‰ crateï¼‰                        |
| é€‚ç”¨åœºæ™¯         | å•ä¸€ crateï¼Œå¿«é€Ÿè°ƒè¯•                         | å¤š crate å·¥ä½œç©ºé—´ï¼Œå…¨é¢æµ‹è¯•ï¼ŒCI/CD                |
| è¿è¡Œæ—¶é—´         | è¾ƒçŸ­ï¼ˆæµ‹è¯•èŒƒå›´å°ï¼‰                           | è¾ƒé•¿ï¼ˆæµ‹è¯•æ‰€æœ‰ crate å’ŒåŠŸèƒ½ï¼‰                     |
| é…ç½®å¤æ‚æ€§       | ç®€å•ï¼Œæ— éœ€é¢å¤–å‚æ•°                           | éœ€æŒ‡å®šå‚æ•°ï¼Œé…ç½®æ›´å¤æ‚                            |

- æ ¸å¿ƒåŒºåˆ«ï¼š
  - cargo llvm-covï¼šæµ‹è¯•èŒƒå›´å°ï¼Œä»…è¦†ç›–å½“å‰ crate å’Œé»˜è®¤åŠŸèƒ½ï¼Œé€‚åˆå¿«é€Ÿæœ¬åœ°è°ƒè¯•ã€‚
  - cargo llvm-cov --all-features --workspace --testsï¼šæµ‹è¯•èŒƒå›´å¹¿ï¼Œè¦†ç›–æ•´ä¸ªå·¥ä½œç©ºé—´ã€æ‰€æœ‰åŠŸèƒ½å’Œæ˜¾å¼æµ‹è¯•ï¼Œé€‚åˆå…¨é¢éªŒè¯ã€‚

### æŸ¥çœ‹ç”Ÿæˆ Rust é¡¹ç›®çš„ä»£ç è¦†ç›–ç‡æŠ¥å‘Š

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 18.5s 
âœ cargo llvm-cov 
info: cargo-llvm-cov currently setting cfg(coverage) and cfg(coverage_nightly); you can opt-out it by passing --no-cfg-coverage and --no-cfg-coverage-nightly
   Compiling rust v0.1.0 (/Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 2.56s
     Running unittests src/lib.rs (target/llvm-cov-target/debug/deps/rust-dbe7fa2021cc4dc4)

running 37 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 37 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 5.20s

     Running unittests src/main.rs (target/llvm-cov-target/debug/deps/rust-054928a06b249be0)

running 45 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test tests::test_load_config ... ok
test tests::test_load_config_from_yaml ... ok
test tests::test_load_config_invalid_yaml ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_four_topics ... ok
test tests::test_run_get_logs_error ... ok
test tests::test_run_empty_receipt ... ok
test tests::test_run_empty_logs ... ok
test tests::test_main_run ... ok
test tests::test_run_valid_receipt ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 45 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 2.29s

     Running tests/integration.rs (target/llvm-cov-target/debug/deps/integration-68d09ec8e787304b)

running 1 test
test test_client_and_parser_integration ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.91s

Filename                      Regions    Missed Regions     Cover   Functions  Missed Functions  Executed       Lines      Missed Lines     Cover    Branches   Missed Branches     Cover
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
client.rs                         233                15    93.56%          56                 0   100.00%         421                 3    99.29%           0                 0         -
event_parser.rs                    78                 5    93.59%          17                 0   100.00%         202                 0   100.00%           0                 0         -
main.rs                            72                 4    94.44%          21                 3    85.71%         243                 3    98.77%           0                 0         -
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
TOTAL                             383                24    93.73%          94                 3    96.81%         866                 6    99.31%           0                 0         -


# è¿›å…¥ä½ çš„ Rust é¡¹ç›®ç›®å½•ï¼ˆåŒ…å« Cargo.toml çš„ç›®å½•ï¼‰ï¼Œç„¶åè¿è¡Œï¼š
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 14.5s 
âœ cargo llvm-cov --all-features --workspace --tests
info: cargo-llvm-cov currently setting cfg(coverage) and cfg(coverage_nightly); you can opt-out it by passing --no-cfg-coverage and --no-cfg-coverage-nightly
   Compiling rust v0.1.0 (/Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 2.60s
     Running unittests src/lib.rs (target/llvm-cov-target/debug/deps/rust-dbe7fa2021cc4dc4)

running 37 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 37 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 4.87s

     Running unittests src/main.rs (target/llvm-cov-target/debug/deps/rust-054928a06b249be0)

running 45 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test tests::test_load_config ... ok
test tests::test_load_config_from_yaml ... ok
test tests::test_load_config_invalid_yaml ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test tests::test_run_get_logs_error ... ok
test tests::test_run_empty_logs ... ok
test tests::test_main_run ... ok
test tests::test_run_empty_receipt ... ok
test tests::test_run_valid_receipt ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 45 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 5.80s

     Running tests/integration.rs (target/llvm-cov-target/debug/deps/integration-68d09ec8e787304b)

running 1 test
test test_client_and_parser_integration ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.99s

Filename                      Regions    Missed Regions     Cover   Functions  Missed Functions  Executed       Lines      Missed Lines     Cover    Branches   Missed Branches     Cover
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
client.rs                         233                15    93.56%          56                 0   100.00%         421                 3    99.29%           0                 0         -
event_parser.rs                    78                 5    93.59%          17                 0   100.00%         202                 0   100.00%           0                 0         -
main.rs                            72                 4    94.44%          21                 3    85.71%         243                 3    98.77%           0                 0         -
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
TOTAL                             383                24    93.73%          94                 3    96.81%         866                 6    99.31%           0                 0         -
```

### `cargo llvm-cov --open` å’Œ `cargo llvm-cov --html` å…³é”®åŒºåˆ«

| ç‰¹æ€§           | cargo llvm-cov --open                                        | cargo llvm-cov --html              |
| -------------- | ------------------------------------------------------------ | ---------------------------------- |
| ç”Ÿæˆ HTML æŠ¥å‘Š | æ˜¯ï¼ˆå­˜å‚¨åœ¨ target/llvm-cov/html/ï¼‰                           | æ˜¯ï¼ˆå­˜å‚¨åœ¨ target/llvm-cov/html/ï¼‰ |
| è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ | æ˜¯ï¼ˆä½¿ç”¨ç³»ç»Ÿé»˜è®¤æµè§ˆå™¨ï¼‰                                     | å¦ï¼ˆéœ€æ‰‹åŠ¨æ‰“å¼€ index.htmlï¼‰        |
| è¿è¡Œæµ‹è¯•       | æ˜¯ï¼ˆè¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œæ”¶é›†è¦†ç›–ç‡ï¼‰                               | æ˜¯ï¼ˆè¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œæ”¶é›†è¦†ç›–ç‡ï¼‰     |
| è¾“å‡ºæ ¼å¼       | HTML æŠ¥å‘Š                                                    | HTML æŠ¥å‘Š                          |
| ä½¿ç”¨åœºæ™¯       | å¼€å‘è°ƒè¯•ï¼Œå¿«é€ŸæŸ¥çœ‹è¦†ç›–ç‡                                     | CI/CD æˆ–æ‰‹åŠ¨æ£€æŸ¥æŠ¥å‘Š               |
| å‘½ä»¤åç»­æ­¥éª¤   | è‡ªåŠ¨æ‰“å¼€ index.html                                          | æ— åç»­æ­¥éª¤                         |
| ç­‰æ•ˆæ‰‹åŠ¨æ“ä½œ   | cargo llvm-cov --html && open target/llvm-cov/html/index.html | cargo llvm-cov --html              |

- æ ¸å¿ƒåŒºåˆ«ï¼š
  - --open åŒ…å« --html çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶é¢å¤–è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ã€‚
  - --html åªç”ŸæˆæŠ¥å‘Šï¼Œé€‚åˆéäº¤äº’å¼ç¯å¢ƒæˆ–æ‰‹åŠ¨æŸ¥çœ‹ã€‚

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼ˆHTML æ ¼å¼ï¼‰å¹¶åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹

ä½¿ç”¨ cargo llvm-cov --html ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šï¼ˆHTML æ ¼å¼ï¼‰ï¼Œç„¶åæ‰‹åŠ¨é€šè¿‡ open target/llvm-cov/html/index.html åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹æŠ¥å‘Šã€‚

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 17.9s 
âœ cargo llvm-cov --html                            
open target/llvm-cov/html/index.html
info: cargo-llvm-cov currently setting cfg(coverage) and cfg(coverage_nightly); you can opt-out it by passing --no-cfg-coverage and --no-cfg-coverage-nightly
   Compiling rust v0.1.0 (/Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 2.75s
     Running unittests src/lib.rs (target/llvm-cov-target/debug/deps/rust-dbe7fa2021cc4dc4)

running 37 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 37 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 5.69s

     Running unittests src/main.rs (target/llvm-cov-target/debug/deps/rust-054928a06b249be0)

running 45 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test tests::test_load_config ... ok
test tests::test_load_config_from_yaml ... ok
test tests::test_load_config_invalid_yaml ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_single_topic ... ok
test tests::test_run_get_logs_error ... ok
test tests::test_run_empty_logs ... ok
test tests::test_run_empty_receipt ... ok
test tests::test_main_run ... ok
test tests::test_run_valid_receipt ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 45 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 2.53s

     Running tests/integration.rs (target/llvm-cov-target/debug/deps/integration-68d09ec8e787304b)

running 1 test
test test_client_and_parser_integration ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.81s


    Finished report saved to /Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust/target/llvm-cov/html

```

![image-20250501185626829](/images/image-20250501185626829.png)

### ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼ˆHTML æ ¼å¼ï¼‰å¹¶è‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŸ¥çœ‹

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 15.7s 
âœ cargo llvm-cov --open


info: cargo-llvm-cov currently setting cfg(coverage) and cfg(coverage_nightly); you can opt-out it by passing --no-cfg-coverage and --no-cfg-coverage-nightly
   Compiling rust v0.1.0 (/Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 2.73s
     Running unittests src/lib.rs (target/llvm-cov-target/debug/deps/rust-dbe7fa2021cc4dc4)

running 37 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 37 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 2.42s

     Running unittests src/main.rs (target/llvm-cov-target/debug/deps/rust-054928a06b249be0)

running 45 tests
test client::tests::test_get_tx_receipt_by_hash_invalid_format ... ok
test client::tests::test_get_tx_receipt_by_hash_not_found ... ok
test client::tests::test_new_eth_client ... ok
test client::tests::test_new_eth_client_domain_regex ... ok
test client::tests::test_new_eth_client_empty_url ... ok
test client::tests::test_new_eth_client_invalid_provider ... ok
test client::tests::test_new_eth_client_invalid_scheme ... ok
test client::tests::test_new_eth_client_invalid_url ... ok
test client::tests::test_new_eth_client_invalid_url_format ... ok
test client::tests::test_new_eth_client_missing_scheme ... ok
test client::tests::test_new_eth_client_with_valid_url ... ok
test client::tests::test_new_eth_client_ws_scheme ... ok
test client::tests::test_new_eth_client_wss_scheme ... ok
test event_parser::tests::test_event_hash ... ok
test event_parser::tests::test_new_event_parser ... ok
test event_parser::tests::test_new_event_parser_empty_address ... ok
test event_parser::tests::test_new_event_parser_invalid_address ... ok
test event_parser::tests::test_new_event_parser_invalid_format ... ok
test event_parser::tests::test_new_event_parser_invalid_hex ... ok
test event_parser::tests::test_new_event_parser_missing_prefix ... ok
test event_parser::tests::test_new_event_parser_zero_address ... ok
test event_parser::tests::test_parse_logs_empty ... ok
test event_parser::tests::test_parse_logs_invalid_data ... ok
test event_parser::tests::test_parse_logs_multiple_logs_mixed ... ok
test event_parser::tests::test_parse_logs_non_matching ... ok
test event_parser::tests::test_parse_logs_single_valid_log ... ok
test tests::test_load_config ... ok
test tests::test_load_config_from_yaml ... ok
test tests::test_load_config_invalid_yaml ... ok
test client::tests::test_get_tx_receipt_by_hash_success ... ok
test client::tests::test_get_tx_receipt_by_hash ... ok
test client::tests::test_get_logs_with_address_and_topic ... ok
test client::tests::test_get_logs_four_topics ... ok
test client::tests::test_get_logs_single_topic ... ok
test client::tests::test_get_logs_range ... ok
test client::tests::test_get_logs_empty ... ok
test client::tests::test_get_logs_at_block_hash2 ... ok
test client::tests::test_get_logs_empty_range ... ok
test client::tests::test_get_logs_at_block_hash ... ok
test tests::test_run_get_logs_error ... ok
test tests::test_run_empty_logs ... ok
test tests::test_run_empty_receipt ... ok
test tests::test_main_run ... ok
test tests::test_run_valid_receipt ... ok
test client::tests::test_get_logs_no_topics ... ok

test result: ok. 45 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 5.86s

     Running tests/integration.rs (target/llvm-cov-target/debug/deps/integration-68d09ec8e787304b)

running 1 test
test test_client_and_parser_integration ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.93s


    Finished report saved to /Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust/target/llvm-cov/html
     Opening /Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust/target/llvm-cov/html/index.html

```

![image-20250501185846383](/images/image-20250501185846383.png)

### ç”Ÿæˆ **LCOV æ ¼å¼**è¦†ç›–ç‡æŠ¥å‘Š

ä½¿ç”¨ nextest è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼Œç”Ÿæˆ LCOV æ ¼å¼çš„è¦†ç›–ç‡æŠ¥å‘Šå¹¶ä¿å­˜åˆ° lcov.info

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 16.0s 
âœ cargo llvm-cov nextest --lcov --output-path lcov.info
info: cargo-llvm-cov currently setting cfg(coverage) and cfg(coverage_nightly); you can opt-out it by passing --no-cfg-coverage and --no-cfg-coverage-nightly
   Compiling rust v0.1.0 (/Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 2.82s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 Nextest run ID 5f3c42ae-54fc-4b84-ab75-792ac0dac1c9 with nextest profile: default
    Starting 83 tests across 3 binaries
        PASS [   0.085s] rust client::tests::test_get_tx_receipt_by_hash_invalid_format
        PASS [   0.609s] rust client::tests::test_get_tx_receipt_by_hash_not_found
        PASS [   0.609s] rust client::tests::test_get_tx_receipt_by_hash
        PASS [   0.526s] rust client::tests::test_get_tx_receipt_by_hash_success
        PASS [   0.014s] rust client::tests::test_new_eth_client_empty_url
        PASS [   0.032s] rust client::tests::test_new_eth_client_domain_regex
        PASS [   0.032s] rust client::tests::test_new_eth_client
        PASS [   0.025s] rust client::tests::test_new_eth_client_invalid_provider
        PASS [   0.011s] rust client::tests::test_new_eth_client_invalid_url
        PASS [   0.011s] rust client::tests::test_new_eth_client_invalid_scheme
        PASS [   0.009s] rust client::tests::test_new_eth_client_invalid_url_format
        PASS [   0.010s] rust client::tests::test_new_eth_client_missing_scheme
        PASS [   0.021s] rust client::tests::test_new_eth_client_with_valid_url
        PASS [   0.009s] rust event_parser::tests::test_event_hash
        PASS [   0.023s] rust client::tests::test_new_eth_client_ws_scheme
        PASS [   0.022s] rust client::tests::test_new_eth_client_wss_scheme
        PASS [   0.009s] rust event_parser::tests::test_new_event_parser
        PASS [   0.008s] rust event_parser::tests::test_new_event_parser_empty_address
        PASS [   0.008s] rust event_parser::tests::test_new_event_parser_invalid_address
        PASS [   0.008s] rust event_parser::tests::test_new_event_parser_invalid_format
        PASS [   0.008s] rust event_parser::tests::test_new_event_parser_invalid_hex
        PASS [   0.007s] rust event_parser::tests::test_new_event_parser_missing_prefix
        PASS [   0.008s] rust event_parser::tests::test_parse_logs_empty
        PASS [   0.008s] rust event_parser::tests::test_new_event_parser_zero_address
        PASS [   0.008s] rust event_parser::tests::test_parse_logs_invalid_data
        PASS [   0.009s] rust event_parser::tests::test_parse_logs_single_valid_log
        PASS [   0.009s] rust event_parser::tests::test_parse_logs_non_matching
        PASS [   0.009s] rust event_parser::tests::test_parse_logs_multiple_logs_mixed
        PASS [   0.937s] rust client::tests::test_get_logs_with_address_and_topic
        PASS [   0.939s] rust client::tests::test_get_logs_single_topic
        PASS [   0.956s] rust client::tests::test_get_logs_at_block_hash
        PASS [   0.968s] rust client::tests::test_get_logs_four_topics
        PASS [   1.002s] rust client::tests::test_get_logs_empty_range
        PASS [   1.018s] rust client::tests::test_get_logs_range
        PASS [   1.037s] rust client::tests::test_get_logs_empty
        PASS [   1.118s] rust client::tests::test_get_logs_at_block_hash2
        PASS [   0.885s] rust::bin/rust client::tests::test_get_logs_at_block_hash
        PASS [   0.027s] rust::bin/rust client::tests::test_get_tx_receipt_by_hash_invalid_format
        PASS [   0.913s] rust::integration test_client_and_parser_integration
        PASS [   0.925s] rust::bin/rust client::tests::test_get_logs_at_block_hash2
        PASS [   0.020s] rust::bin/rust client::tests::test_new_eth_client
        PASS [   0.018s] rust::bin/rust client::tests::test_new_eth_client_domain_regex
        PASS [   0.008s] rust::bin/rust client::tests::test_new_eth_client_empty_url
        PASS [   0.018s] rust::bin/rust client::tests::test_new_eth_client_invalid_provider
        PASS [   0.009s] rust::bin/rust client::tests::test_new_eth_client_invalid_scheme
        PASS [   0.008s] rust::bin/rust client::tests::test_new_eth_client_invalid_url
        PASS [   0.609s] rust::bin/rust client::tests::test_get_tx_receipt_by_hash
        PASS [   0.008s] rust::bin/rust client::tests::test_new_eth_client_invalid_url_format
        PASS [   0.008s] rust::bin/rust client::tests::test_new_eth_client_missing_scheme
        PASS [   0.019s] rust::bin/rust client::tests::test_new_eth_client_with_valid_url
        PASS [   0.018s] rust::bin/rust client::tests::test_new_eth_client_ws_scheme
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_event_hash
        PASS [   0.018s] rust::bin/rust client::tests::test_new_eth_client_wss_scheme
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_new_event_parser
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_new_event_parser_empty_address
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_new_event_parser_invalid_address
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_new_event_parser_invalid_format
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_new_event_parser_invalid_hex
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_new_event_parser_missing_prefix
        PASS [   0.007s] rust::bin/rust event_parser::tests::test_new_event_parser_zero_address
        PASS [   0.860s] rust::bin/rust client::tests::test_get_logs_empty
        PASS [   0.009s] rust::bin/rust event_parser::tests::test_parse_logs_empty
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_parse_logs_invalid_data
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_parse_logs_multiple_logs_mixed
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_parse_logs_non_matching
        PASS [   0.008s] rust::bin/rust event_parser::tests::test_parse_logs_single_valid_log
        PASS [   0.008s] rust::bin/rust tests::test_load_config
        PASS [   0.009s] rust::bin/rust tests::test_load_config_from_yaml
        PASS [   0.008s] rust::bin/rust tests::test_load_config_invalid_yaml
        PASS [   0.913s] rust::bin/rust client::tests::test_get_logs_four_topics
        PASS [   0.948s] rust::bin/rust client::tests::test_get_logs_empty_range
        PASS [   0.906s] rust::bin/rust client::tests::test_get_logs_range
        PASS [   0.910s] rust::bin/rust client::tests::test_get_logs_single_topic
        PASS [   0.509s] rust::bin/rust client::tests::test_get_tx_receipt_by_hash_not_found
        PASS [   1.151s] rust::bin/rust client::tests::test_get_logs_with_address_and_topic
        PASS [   0.569s] rust::bin/rust client::tests::test_get_tx_receipt_by_hash_success
        PASS [   0.409s] rust::bin/rust tests::test_run_get_logs_error
        PASS [   0.926s] rust::bin/rust tests::test_run_empty_logs
        PASS [   0.950s] rust::bin/rust tests::test_run_empty_receipt
        PASS [   1.277s] rust::bin/rust tests::test_main_run
        PASS [   1.251s] rust::bin/rust tests::test_run_valid_receipt
        PASS [   5.822s] rust::bin/rust client::tests::test_get_logs_no_topics
        PASS [  11.082s] rust client::tests::test_get_logs_no_topics
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     Summary [  11.084s] 83 tests run: 83 passed, 0 skipped

    Finished report saved to lcov.info
```

### æŸ¥çœ‹ LCOV è¦†ç›–ç‡æ‘˜è¦ç»Ÿè®¡

ä½¿ç”¨ lcov --summary lcov.info æŸ¥çœ‹ LCOV è¦†ç›–ç‡æ–‡ä»¶çš„è¡Œã€å‡½æ•°å’Œåˆ†æ”¯è¦†ç›–æ‘˜è¦ç»Ÿè®¡

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 took 19.5s 
âœ lcov --summary lcov.info
Reading tracefile lcov.info.
Summary coverage rate:
  source files: 3
  lines.......: 100.0% (607 of 607 lines)
  functions...: 85.1% (172 of 202 functions)
Message summary:
  no messages were reported

```

### ç”Ÿæˆ LCOV å¯è§†åŒ–è¦†ç›–ç‡ HTML æŠ¥å‘Š

ä½¿ç”¨ genhtml å·¥å…·å°† LCOV æ ¼å¼çš„è¦†ç›–ç‡æ•°æ®ï¼ˆlcov.infoï¼‰è½¬æ¢ä¸ºå¯è§†åŒ–çš„ HTML è¦†ç›–ç‡æŠ¥å‘Šï¼Œè¾“å‡ºåˆ°æŒ‡å®šç›®å½•ï¼ˆcoverage_reportï¼‰ã€‚

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 
âœ genhtml lcov.info -o coverage_report

Reading tracefile lcov.info.
Found 3 entries.
Found common filename prefix "/Users/qiaopengjun/Code/Web3Wallet/ethertrace/rust"
Generating output.
Processing file src/event_parser.rs
  lines=201 hit=201 functions=42 hit=38
Processing file src/client.rs
  lines=249 hit=249 functions=131 hit=116
Processing file src/main.rs
  lines=157 hit=157 functions=29 hit=18
Overall coverage rate:
  source files: 3
  lines.......: 100.0% (607 of 607 lines)
  functions...: 85.1% (172 of 202 functions)
Message summary:
  no messages were reported

```

### åœ¨æµè§ˆå™¨æ‰“å¼€æŸ¥çœ‹ LCOV æŠ¥å‘Š

```bash
ethertrace/rust on î‚  main [!?] is ğŸ“¦ 0.1.0 via ğŸ¦€ 1.88.0 
âœ open coverage_report/index.html 

```

![image-20250501191204669](/images/image-20250501191204669.png)

## æ€»ç»“

é€šè¿‡ Rust å¼€å‘çš„ Web3 åç«¯é¡¹ç›®ï¼Œå±•ç°äº†ä»¥å¤ªåŠå®¢æˆ·ç«¯ä¸äº‹ä»¶è§£æçš„å¼ºå¤§èƒ½åŠ›ã€‚å€ŸåŠ© Rust çš„é«˜æ€§èƒ½ä¸å†…å­˜å®‰å…¨ï¼Œé¡¹ç›®å®ç°äº†é«˜æ•ˆçš„èŠ‚ç‚¹äº¤äº’å’Œæ™ºèƒ½åˆçº¦äº‹ä»¶å¤„ç†ï¼Œæ¨¡å—åŒ–è®¾è®¡å’Œçµæ´»é…ç½®ä½¿å…¶æ˜“äºæ‰©å±•ã€‚83 ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–ç‡è¾¾ 100%ï¼Œç»“åˆ cargo nextest çš„å¿«é€Ÿæµ‹è¯•å’Œ cargo llvm-cov çš„è¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Šï¼Œç¡®ä¿äº†ä»£ç çš„æé«˜å¯é æ€§ã€‚æœ¬æ–‡ä¸ä»…æ˜¯ä¸€ä¸ªå®æˆ˜æ•™ç¨‹ï¼Œæ›´æ˜¯ Rust åœ¨ Web3 é¢†åŸŸåº”ç”¨çš„æˆåŠŸæ¡ˆä¾‹ã€‚å¼€å‘è€…å¯åŸºäºæ­¤é¡¹ç›®è¿›ä¸€æ­¥é›†æˆä»¥å¤ªåŠåŠŸèƒ½ï¼Œæˆ–æ‰©å±•è‡³å…¶ä»–åŒºå—é“¾ï¼Œè½»æ¾æ„å»ºç”Ÿäº§çº§ Web3 åº”ç”¨ã€‚ç«‹å³åŠ¨æ‰‹ï¼Œç”¨ Rust è§£é” Web3 çš„æœªæ¥ï¼æ›´å¤šèµ„æºè¯·è®¿é—®é¡¹ç›® GitHub ä»“åº“åŠå‚è€ƒé“¾æ¥ã€‚

## å‚è€ƒ

- <https://crates.io/crates/dotenv>
- <https://github.com/taiki-e/cargo-llvm-cov>
- <https://crates.io/crates/temp-env>
- <https://docs.rs/web3/latest/web3/>
- <https://github.com/tomusdrw/rust-web3>
- <https://medium.com/@chalex-eth/how-to-build-a-web3-backend-in-rust-part-1-a92b649d42ad>
- <https://docs.moonbeam.network/cn/builders/libraries/ethersrs/>
- <https://github.com/gakonst/ethers-rs/issues/2667>
- <https://docs.rs/alloy/latest/alloy/>
- <https://github.com/alloy-rs/alloy>
- <https://alloy.rs/>
- <https://alloy.rs/introduction/getting-started>
- <https://github.com/qiaopengjun5162/ethertrace>
