+++
title = "Goè¯­è¨€ä¹‹ go-redis åŸºæœ¬ä½¿ç”¨"
date = 2023-06-14T23:23:40+08:00
[taxonomies]
tags = ["Go"]
categories = ["Go"]
+++


# Goè¯­è¨€ä¹‹ go-redis åŸºæœ¬ä½¿ç”¨

## Redis ä»‹ç»

[Redis](https://redis.io/)ï¼š<https://redis.io/>

[Redis ä¸­æ–‡ç½‘](https://www.redis.net.cn/)ï¼š<https://www.redis.net.cn/>

REmote DIctionary Server(Redis) æ˜¯ä¸€ä¸ªç”±Salvatore Sanfilippoå†™çš„key-valueå­˜å‚¨ç³»ç»Ÿã€‚

Redisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€éµå®ˆBSDåè®®ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚

å®ƒé€šå¸¸è¢«ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå› ä¸ºå€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯ å­—ç¬¦ä¸²(String), å“ˆå¸Œ(Map), åˆ—è¡¨(list), é›†åˆ(sets) å’Œ æœ‰åºé›†åˆ(sorted sets)ç­‰ç±»å‹ã€‚

### macOS å®‰è£…Redis

```bash
brew install redis
```

### Windows å®‰è£… Redis

**ä¸‹è½½åœ°å€**ï¼š<https://github.com/dmajkic/redis/tags/>

<https://github.com/ServiceStack/redis-windows>

<https://github.com/microsoftarchive/redis/releases>

## go-redis ä½¿ç”¨

å®‰è£… go-redis åº“ <https://github.com/redis/go-redis>

```bash
go get github.com/redis/go-redis/v9
```

[Go-Redis ä¸­æ–‡æ–‡æ¡£](https://redis.uptrace.dev/zh/)ï¼š<https://redis.uptrace.dev/zh/>

### å®‰è£…

go-redis æ”¯æŒ 2 ä¸ªæœ€æ–°çš„ go ç‰ˆæœ¬ä¸”ä¾èµ–[Go modules](https://github.com/golang/go/wiki/Modules)ï¼Œå¦‚æœ ä½ è¿˜æ²¡æœ‰ go modï¼Œä½ éœ€è¦é¦–å…ˆåˆå§‹åŒ–:

```bash
go mod init github.com/my/repo
```

å®‰è£… go-redis/**v9** (æ”¯æŒæ‰€æœ‰çš„ redis ç‰ˆæœ¬):

```bash
go get github.com/redis/go-redis/v9
```

### [#](https://redis.uptrace.dev/zh/guide/go-redis.html#è¿æ¥åˆ°-redis-æœåŠ¡å™¨)è¿æ¥åˆ° Redis æœåŠ¡å™¨

è¿æ¥åˆ° Redis æœåŠ¡å™¨ç¤ºä¾‹ï¼Œæ›´å¤šé…ç½®å‚æ•°ï¼Œè¯·å‚ç…§ [redis.Options](https://redis.uptrace.dev/zh/guide/go-redis-option.html#redis-client):

```go
import "github.com/redis/go-redis/v9"

rdb := redis.NewClient(&redis.Options{
 Addr:   "localhost:6379",
 Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
 DB:    0,  // é»˜è®¤DB 0
})
```

åŒæ—¶ä¹Ÿæ”¯æŒå¦å¤–ä¸€ç§å¸¸è§çš„è¿æ¥å­—ç¬¦ä¸²:

```go
opt, err := redis.ParseURL("redis://<user>:<pass>@localhost:6379/<db>")
if err != nil {
 panic(err)
}

rdb := redis.NewClient(opt)
```

### [#](https://redis.uptrace.dev/zh/guide/go-redis.html#ä½¿ç”¨-tls)ä½¿ç”¨ TLS

ä½ éœ€è¦æ‰‹åŠ¨è®¾ç½® `tls.Config`ï¼Œä½ å¯ä»¥åœ¨ [è¿™é‡Œ](https://pkg.go.dev/crypto/tls#example-LoadX509KeyPair) äº†è§£ç›¸å…³ `tls.Config`æ›´å¤šçš„é…ç½®ä¿¡æ¯ï¼š

```go
rdb := redis.NewClient(&redis.Options{
 TLSConfig: &tls.Config{
  MinVersion: tls.VersionTLS12,
  ServerName: "you domain",
  //Certificates: []tls.Certificate{cert}
 },
})
```

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯åŸŸåè¿æ¥ï¼Œä¸”é‡åˆ°äº†ç±»ä¼¼ `x509: cannot validate certificate for xxx.xxx.xxx.xxx because it doesn't contain any IP SANs`çš„é”™è¯¯ ï¼Œåº”è¯¥åœ¨ ServerName ä¸­æŒ‡å®šä½ çš„åŸŸåï¼š[æ›´å¤šè¯¦æƒ…è¯·å‚è€ƒæœ¬é“¾æ¥](https://github.com/redis/go-redis/discussions/1710)

```go
rdb := redis.NewClient(&redis.Options{
 TLSConfig: &tls.Config{
  MinVersion: tls.VersionTLS12,
  ServerName: "ä½ çš„åŸŸå",
 },
})
```

### [#](https://redis.uptrace.dev/zh/guide/go-redis.html#ssh-æ–¹å¼)SSH æ–¹å¼

ä½¿ç”¨ SSH åè®®è¿æ¥:

```go
sshConfig := &ssh.ClientConfig{
 User:    "root",
 Auth:    []ssh.AuthMethod{ssh.Password("password")},
 HostKeyCallback: ssh.InsecureIgnoreHostKey(),
 Timeout:   15 * time.Second,
}

sshClient, err := ssh.Dial("tcp", "remoteIP:22", sshConfig)
if err != nil {
 panic(err)
}

rdb := redis.NewClient(&redis.Options{
 Addr: net.JoinHostPort("127.0.0.1", "6379"),
 Dialer: func(ctx context.Context, network, addr string) (net.Conn, error) {
  return sshClient.Dial(network, addr)
 },
 // SSHä¸æ”¯æŒè¶…æ—¶è®¾ç½®ï¼Œåœ¨è¿™é‡Œç¦ç”¨
 ReadTimeout:  -1,
 WriteTimeout: -1,
})
```

### [#](https://redis.uptrace.dev/zh/guide/go-redis.html#dial-tcp-i-o-timeout)dial tcp: i/o timeout

å½“ä½ é‡åˆ° `dial tcp: i/o timeout` é”™è¯¯æ—¶ï¼Œè¡¨ç¤º go-redis æ— æ³•è¿æ¥ Redis æœåŠ¡å™¨ï¼Œæ¯”å¦‚ redis æœåŠ¡å™¨æ²¡æœ‰ æ­£å¸¸è¿è¡Œæˆ–ç›‘å¬äº†å…¶ä»–ç«¯å£ï¼Œä»¥åŠå¯èƒ½è¢«é˜²ç«å¢™æ‹¦æˆªç­‰ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸€äº›ç½‘ç»œå‘½ä»¤æ’æŸ¥é—®é¢˜ï¼Œä¾‹å¦‚ `telnet`:

```bash
telnet localhost 6379
Trying 127.0.0.1...
telnet: Unable to connect to remote host: Connection refused
```

å¦‚æœä½ ä½¿ç”¨ Dockerã€Kubernetesã€Istioã€Service Meshã€Sidecar æ–¹å¼è¿è¡Œï¼Œåº”è¯¥ç¡®ä¿æœåŠ¡åœ¨å®¹å™¨å®Œå…¨å¯ç”¨åå¯ åŠ¨ï¼Œä½ å¯ä»¥é€šè¿‡[å‚è€ƒè¯¥åœ°å€](https://docs.docker.com/engine/reference/run/#healthcheck)ã€Readiness Gateã€Istio `holdApplicationUntilProxyStarts`ç­‰ã€‚

### Context ä¸Šä¸‹æ–‡

go-redis æ”¯æŒ Contextï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ§åˆ¶ [è¶…æ—¶](https://redis.uptrace.dev/zh/guide/go-redis-debugging.html#timeouts) æˆ–è€…ä¼ é€’ä¸€äº›æ•°æ®, ä¹Ÿå¯ä»¥ [ç›‘æ§](https://redis.uptrace.dev/zh/guide/go-redis-monitoring.html) go-redis æ€§èƒ½ã€‚

```go
ctx := context.Background()
```

## [go-redis å®æ“](https://pkg.go.dev/github.com/go-redis/redis) <https://pkg.go.dev/github.com/go-redis/redis>

### å®‰è£…

```bash
Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ go get github.com/redis/go-redis/v9
go: downloading github.com/redis/go-redis/v9 v9.0.5
go: downloading github.com/redis/go-redis v6.15.9+incompatible
go: downloading github.com/cespare/xxhash/v2 v2.2.0
go: downloading github.com/dgryski/go-rendezvous v0.0.0-20200823014737-9f7001d12a5f
go: added github.com/cespare/xxhash/v2 v2.2.0
go: added github.com/dgryski/go-rendezvous v0.0.0-20200823014737-9f7001d12a5f
go: added github.com/redis/go-redis/v9 v9.0.5

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base took 2.4s 
âœ 

```

### è¿æ¥ Redis æœåŠ¡å™¨å¹¶åˆå§‹åŒ–

```go
package main

import (
 "context"
 "fmt"
 "github.com/redis/go-redis/v9"
)

// å£°æ˜ä¸€ä¸ªå…¨å±€çš„ rdb å˜é‡
var rdb *redis.Client

// åˆå§‹åŒ–è¿æ¥
func initRedisClient() (err error) {
 // NewClientå°†å®¢æˆ·ç«¯è¿”å›ç»™OptionsæŒ‡å®šçš„Redis Serverã€‚
 // Optionsä¿ç•™è®¾ç½®ä»¥å»ºç«‹redisè¿æ¥ã€‚
 rdb = redis.NewClient(&redis.Options{
  Addr:     "localhost:6379",
  Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
  DB:       0,  // é»˜è®¤DB 0 è¿æ¥åˆ°æœåŠ¡å™¨åè¦é€‰æ‹©çš„æ•°æ®åº“ã€‚
  PoolSize: 20, // æœ€å¤§å¥—æ¥å­—è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå¯ç”¨CPUæœ‰10ä¸ªè¿æ¥ï¼Œç”±runtime.GOMAXPROCSæŠ¥å‘Šã€‚
 })

 // Backgroundè¿”å›ä¸€ä¸ªéç©ºçš„Contextã€‚å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚
 // å®ƒé€šå¸¸ç”±mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡
 ctx := context.Background()

 _, err = rdb.Ping(ctx).Result()
 if err != nil {
  return err
 }
 return nil
}

func main() {
 if err := initRedisClient(); err != nil {
  fmt.Printf("initRedisClient failed: %v\n", err)
  return
 }
 fmt.Println("initRedisClient started successfully")
 defer rdb.Close() // Close å…³é—­å®¢æˆ·ç«¯ï¼Œé‡Šæ”¾æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚å…³é—­å®¢æˆ·ç«¯æ˜¯å¾ˆå°‘è§çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶åœ¨è®¸å¤šä¾‹ç¨‹ä¹‹é—´å…±äº«ã€‚
}

```

### è¿è¡Œ

```bash
Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base took 2.1s 
âœ go run main.go
initRedisClient started successfully

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ 
```

### æ‰§è¡Œ Redis å‘½ä»¤

æ‰§è¡Œ Redis å‘½ä»¤:

```go
val, err := rdb.Get(ctx, "key").Result()
fmt.Println(val)
```

ä½ ä¹Ÿå¯ä»¥åˆ†åˆ«è®¿é—®å€¼å’Œé”™è¯¯ï¼š

```go
get := rdb.Get(ctx, "key")
fmt.Println(get.Val(), get.Err())
```

### æ‰§è¡Œå°šä¸æ”¯æŒçš„å‘½ä»¤

å¯ä»¥ä½¿ç”¨ `Do()` æ–¹æ³•æ‰§è¡Œå°šä¸æ”¯æŒæˆ–è€…ä»»æ„å‘½ä»¤:

```go
val, err := rdb.Do(ctx, "get", "key").Result()
if err != nil {
 if err == redis.Nil {
  fmt.Println("key does not exists")
  return
 }
 panic(err)
}
fmt.Println(val.(string))
```

`Do()` æ–¹æ³•è¿”å› [Cmd](https://pkg.go.dev/github.com/redis/go-redis/v9#Cmd) ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒè·å–ä½  æƒ³è¦çš„ç±»å‹ï¼š

```go
// Text is a shortcut for get.Val().(string) with proper error handling.
val, err := rdb.Do(ctx, "get", "key").Text()
fmt.Println(val, err)
```

æ–¹æ³•åˆ—è¡¨:

```go
s, err := cmd.Text()
flag, err := cmd.Bool()

num, err := cmd.Int()
num, err := cmd.Int64()
num, err := cmd.Uint64()
num, err := cmd.Float32()
num, err := cmd.Float64()

ss, err := cmd.StringSlice()
ns, err := cmd.Int64Slice()
ns, err := cmd.Uint64Slice()
fs, err := cmd.Float32Slice()
fs, err := cmd.Float64Slice()
bs, err := cmd.BoolSlice()
```

### [#](https://redis.uptrace.dev/zh/guide/go-redis.html#redis-nil)redis.Nil

`redis.Nil` æ˜¯ä¸€ç§ç‰¹æ®Šçš„é”™è¯¯ï¼Œä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´å®ƒå¹¶ä¸æ˜¯é”™è¯¯ï¼Œè€Œæ˜¯ä»£è¡¨ä¸€ç§çŠ¶æ€ï¼Œä¾‹å¦‚ä½ ä½¿ç”¨ Get å‘½ä»¤è·å– key çš„å€¼ï¼Œå½“ key ä¸å­˜åœ¨æ—¶ï¼Œè¿”å› `redis.Nil`ã€‚åœ¨å…¶ä»–æ¯”å¦‚ `BLPOP` ã€ `ZSCORE` ä¹Ÿæœ‰ç±»ä¼¼çš„å“åº”ï¼Œä½ éœ€è¦åŒº åˆ†é”™è¯¯ï¼š

```go
val, err := rdb.Get(ctx, "key").Result()
switch {
case err == redis.Nil:
 fmt.Println("keyä¸å­˜åœ¨")
case err != nil:
 fmt.Println("é”™è¯¯", err)
case val == "":
 fmt.Println("å€¼æ˜¯ç©ºå­—ç¬¦ä¸²")
}
```

### [Conn](https://redis.uptrace.dev/zh/guide/go-redis.html#conn)

redis.Conn æ˜¯ä»è¿æ¥æ± ä¸­å–å‡ºçš„å•ä¸ªè¿æ¥ï¼Œé™¤éä½ æœ‰ç‰¹æ®Šçš„éœ€è¦ï¼Œå¦åˆ™å°½é‡ä¸è¦ä½¿ç”¨å®ƒã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒå‘ redis å‘é€ä»»ä½•æ•°æ®å¹¶è¯»å– redis çš„å“åº”ï¼Œå½“ä½ ä½¿ç”¨å®Œæ¯•æ—¶ï¼Œåº”è¯¥æŠŠå®ƒè¿”å›ç»™ go-redisï¼Œå¦åˆ™è¿æ¥æ± ä¼šæ°¸è¿œä¸¢å¤±ä¸€ä¸ªè¿ æ¥ã€‚

```go
cn := rdb.Conn(ctx)
defer cn.Close()

if err := cn.ClientSetName(ctx, "myclient").Err(); err != nil {
 panic(err)
}

name, err := cn.ClientGetName(ctx).Result()
if err != nil {
 panic(err)
}
fmt.Println("client name", name)
```

## åŸºæœ¬ä½¿ç”¨ æ‰§è¡Œå‘½ä»¤

```go
package main

import (
 "context"
 "fmt"
 "github.com/redis/go-redis/v9"
 "time"
)

// å£°æ˜ä¸€ä¸ªå…¨å±€çš„ rdb å˜é‡
var rdb *redis.Client

// åˆå§‹åŒ–è¿æ¥
func initRedisClient() (err error) {
 // NewClientå°†å®¢æˆ·ç«¯è¿”å›ç»™OptionsæŒ‡å®šçš„Redis Serverã€‚
 // Optionsä¿ç•™è®¾ç½®ä»¥å»ºç«‹redisè¿æ¥ã€‚
 rdb = redis.NewClient(&redis.Options{
  Addr:     "localhost:6379",
  Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
  DB:       0,  // é»˜è®¤DB 0 è¿æ¥åˆ°æœåŠ¡å™¨åè¦é€‰æ‹©çš„æ•°æ®åº“ã€‚
  PoolSize: 20, // æœ€å¤§å¥—æ¥å­—è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå¯ç”¨CPUæœ‰10ä¸ªè¿æ¥ï¼Œç”±runtime.GOMAXPROCSæŠ¥å‘Šã€‚
 })

 // Backgroundè¿”å›ä¸€ä¸ªéç©ºçš„Contextã€‚å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚
 // å®ƒé€šå¸¸ç”±mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡
 ctx := context.Background()

 _, err = rdb.Ping(ctx).Result()
 if err != nil {
  return err
 }
 return nil
}

// doCommand go-redisåŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
func redisCommand() {
 ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)
 defer cancel()

 // è·å–Redisçš„â€œGet keyâ€å‘½ä»¤ã€‚å®ƒè¿”å›redisã€‚å½“é”®ä¸å­˜åœ¨æ—¶å‡ºç°Nilé”™è¯¯ã€‚
 val, err := rdb.Get(ctx, "key").Result()
 if err != nil {
  fmt.Printf("redis command failed: %v\n", err)
 }
 fmt.Printf("redis command get key %v\n", val)

 // åˆ†åˆ«è®¿é—®å€¼å’Œé”™è¯¯ï¼š
 get := rdb.Get(ctx, "key")
 fmt.Println("redis command get value: ", get.Val()) // è·å–å€¼
 fmt.Println("redis command get err: ", get.Err())   // è·å–é”™è¯¯

 // è®¾ç½®Redis ' Set key value [expiration] 'å‘½ä»¤ã€‚
 err = rdb.Set(ctx, "key", 10, time.Hour).Err()
 fmt.Printf("rdb set err: %v\n", err)

 // è·å–Redisçš„â€œGet keyâ€å‘½ä»¤ã€‚å®ƒè¿”å›redisã€‚å½“é”®ä¸å­˜åœ¨æ—¶å‡ºç°Nilé”™è¯¯ã€‚
 value := rdb.Get(ctx, "key").Val()
 fmt.Printf("rdb get value: %v\n", value)
}

func main() {
 if err := initRedisClient(); err != nil {
  fmt.Printf("initRedisClient failed: %v\n", err)
  return
 }
 fmt.Println("initRedisClient started successfully")
 defer rdb.Close() // Close å…³é—­å®¢æˆ·ç«¯ï¼Œé‡Šæ”¾æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚å…³é—­å®¢æˆ·ç«¯æ˜¯å¾ˆå°‘è§çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶åœ¨è®¸å¤šä¾‹ç¨‹ä¹‹é—´å…±äº«ã€‚

 redisCommand()
}

```

è¿è¡Œ

```bash
Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ go run main.go
initRedisClient started successfully
redis command failed: redis: nil
redis command get key 
redis command get value:  
redis command get err:  redis: nil
rdb set err: <nil>
rdb get value: 10

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ 
```

## Go Redis é…ç½®

## Redis Client

```go
type Options struct {
    // è¿æ¥ç½‘ç»œç±»å‹ï¼Œå¦‚: tcpã€udpã€unixç­‰æ–¹å¼
    // å¦‚æœä¸ºç©ºé»˜è®¤tcp
    Network string
 
    // redisæœåŠ¡å™¨åœ°å€ï¼Œip:portæ ¼å¼ï¼Œæ¯”å¦‚ï¼š192.168.1.100:6379
    // é»˜è®¤ä¸º :6379
    Addr string
    
    // ClientName æ˜¯å¯¹ç½‘ç»œè¿æ¥è®¾ç½®ä¸€ä¸ªåå­—ï¼Œä½¿ç”¨ "CLIENT LIST" å‘½ä»¤
    // å¯ä»¥æŸ¥çœ‹redisæœåŠ¡å™¨å½“å‰çš„ç½‘ç»œè¿æ¥åˆ—è¡¨
    // å¦‚æœè®¾ç½®äº†ClientNameï¼Œgo-rediså¯¹æ¯ä¸ªè¿æ¥è°ƒç”¨ `CLIENT SETNAME ClientName` å‘½ä»¤
    // æŸ¥çœ‹: https://redis.io/commands/client-setname/
    // é»˜è®¤ä¸ºç©ºï¼Œä¸è®¾ç½®å®¢æˆ·ç«¯åç§°
    ClientName string
 
    // å¦‚æœä½ æƒ³è‡ªå®šä¹‰è¿æ¥ç½‘ç»œçš„æ–¹å¼ï¼Œå¯ä»¥è‡ªå®šä¹‰ `Dialer` æ–¹æ³•ï¼Œ
    // å¦‚æœä¸æŒ‡å®šï¼Œå°†ä½¿ç”¨é»˜è®¤çš„æ–¹å¼è¿›è¡Œç½‘ç»œè¿æ¥ `redis.NewDialer`
    Dialer func(ctx context.Context, network, addr string) (net.Conn, error)
    
    // å»ºç«‹äº†æ–°è¿æ¥æ—¶è°ƒç”¨æ­¤å‡½æ•°
    // é»˜è®¤ä¸ºnil
    OnConnect func(ctx context.Context, cn *Conn) error
 
    // å½“redisæœåŠ¡å™¨ç‰ˆæœ¬åœ¨6.0ä»¥ä¸Šæ—¶ï¼Œä½œä¸ºACLè®¤è¯ä¿¡æ¯é…åˆå¯†ç ä¸€èµ·ä½¿ç”¨ï¼Œ
    // ACLæ˜¯redis 6.0ä»¥ä¸Šç‰ˆæœ¬æä¾›çš„è®¤è¯åŠŸèƒ½ï¼Œ6.0ä»¥ä¸‹ç‰ˆæœ¬ä»…æ”¯æŒå¯†ç è®¤è¯ã€‚
    // é»˜è®¤ä¸ºç©ºï¼Œä¸è¿›è¡Œè®¤è¯ã€‚
    Username string

    // å½“redisæœåŠ¡å™¨ç‰ˆæœ¬åœ¨6.0ä»¥ä¸Šæ—¶ï¼Œä½œä¸ºACLè®¤è¯ä¿¡æ¯é…åˆå¯†ç ä¸€èµ·ä½¿ç”¨ï¼Œ
    // å½“redisæœåŠ¡å™¨ç‰ˆæœ¬åœ¨6.0ä»¥ä¸‹æ—¶ï¼Œä»…ä½œä¸ºå¯†ç è®¤è¯ã€‚
    // ACLæ˜¯redis 6.0ä»¥ä¸Šç‰ˆæœ¬æä¾›çš„è®¤è¯åŠŸèƒ½ï¼Œ6.0ä»¥ä¸‹ç‰ˆæœ¬ä»…æ”¯æŒå¯†ç è®¤è¯ã€‚
    // é»˜è®¤ä¸ºç©ºï¼Œä¸è¿›è¡Œè®¤è¯ã€‚
    Password string
 
    // å…è®¸åŠ¨æ€è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼Œgo-redisåœ¨è¿›è¡Œç½‘ç»œè¿æ¥æ—¶ä¼šè·å–ç”¨æˆ·åå’Œå¯†ç ï¼Œ
    // è¿™å¯¹ä¸€äº›è®¤è¯é‰´æƒæœ‰æ—¶æ•ˆæ€§çš„ç³»ç»Ÿæ¥è¯´å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ä¸€äº›äº‘æœåŠ¡å•†æä¾›è®¤è¯ä¿¡æ¯æœ‰æ•ˆæœŸä¸º12å°æ—¶ã€‚
    // é»˜è®¤ä¸ºnil
    CredentialsProvider func() (username string, password string)
    
    // redis DB æ•°æ®åº“ï¼Œé»˜è®¤ä¸º0
    DB int
    
    // å‘½ä»¤æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œ é»˜è®¤ä¸º3
    MaxRetries int
 
    // æ¯æ¬¡é‡è¯•æœ€å°é—´éš”æ—¶é—´
    // é»˜è®¤ 8 * time.Millisecond (8æ¯«ç§’) ï¼Œè®¾ç½®-1ä¸ºç¦ç”¨
    MinRetryBackoff time.Duration

    // æ¯æ¬¡é‡è¯•æœ€å¤§é—´éš”æ—¶é—´
    // é»˜è®¤ 512 * time.Millisecond (512æ¯«ç§’) ï¼Œè®¾ç½®-1ä¸ºç¦ç”¨
    MaxRetryBackoff time.Duration
    
    // å»ºç«‹æ–°ç½‘ç»œè¿æ¥æ—¶çš„è¶…æ—¶æ—¶é—´
    // é»˜è®¤5ç§’
    DialTimeout time.Duration
 
    // ä»ç½‘ç»œè¿æ¥ä¸­è¯»å–æ•°æ®è¶…æ—¶æ—¶é—´ï¼Œå¯èƒ½çš„å€¼ï¼š
    //  0 - é»˜è®¤å€¼ï¼Œ3ç§’
    // -1 - æ— è¶…æ—¶ï¼Œæ— é™æœŸçš„é˜»å¡
    // -2 - ä¸è¿›è¡Œè¶…æ—¶è®¾ç½®ï¼Œä¸è°ƒç”¨ SetReadDeadline æ–¹æ³•
    ReadTimeout time.Duration
 
    // æŠŠæ•°æ®å†™å…¥ç½‘ç»œè¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå¯èƒ½çš„å€¼ï¼š
    //  0 - é»˜è®¤å€¼ï¼Œ3ç§’
    // -1 - æ— è¶…æ—¶ï¼Œæ— é™æœŸçš„é˜»å¡
    // -2 - ä¸è¿›è¡Œè¶…æ—¶è®¾ç½®ï¼Œä¸è°ƒç”¨ SetWriteDeadline æ–¹æ³•
    WriteTimeout time.Duration
 
    // æ˜¯å¦ä½¿ç”¨context.Contextçš„ä¸Šä¸‹æ–‡æˆªæ­¢æ—¶é—´ï¼Œ
    // æœ‰äº›æƒ…å†µä¸‹ï¼Œcontext.Contextçš„è¶…æ—¶å¯èƒ½å¸¦æ¥é—®é¢˜ã€‚
    // é»˜è®¤ä¸ä½¿ç”¨
    ContextTimeoutEnabled bool

    // è¿æ¥æ± çš„ç±»å‹ï¼Œæœ‰ LIFO å’Œ FIFO ä¸¤ç§æ¨¡å¼ï¼Œ
    // PoolFIFO ä¸º false æ—¶ä½¿ç”¨ LIFO æ¨¡å¼ï¼Œä¸º true ä½¿ç”¨ FIFO æ¨¡å¼ã€‚
    // å½“ä¸€ä¸ªè¿æ¥ä½¿ç”¨å®Œæ¯•æ—¶ä¼šæŠŠè¿æ¥å½’è¿˜ç»™è¿æ¥æ± ï¼Œè¿æ¥æ± ä¼šæŠŠè¿æ¥æ”¾å…¥é˜Ÿå°¾ï¼Œ
    // LIFO æ¨¡å¼æ—¶ï¼Œæ¯æ¬¡å–ç©ºé—²è¿æ¥ä¼šä»"é˜Ÿå°¾"å–ï¼Œå°±æ˜¯åˆšæ”¾å…¥é˜Ÿå°¾çš„ç©ºé—²è¿æ¥ï¼Œ
    // ä¹Ÿå°±æ˜¯è¯´ LIFO æ¯æ¬¡ä½¿ç”¨çš„éƒ½æ˜¯çƒ­è¿æ¥ï¼Œè¿æ¥æ± æœ‰æœºä¼šå…³é—­"é˜Ÿå¤´"çš„é•¿æœŸç©ºé—²è¿æ¥ï¼Œ
    // å¹¶ä¸”ä»æ¦‚ç‡ä¸Šï¼Œåˆšæ”¾å…¥çš„çƒ­è¿æ¥å¥åº·çŠ¶æ€ä¼šæ›´å¥½ï¼›
    // è€Œ FIFO æ¨¡å¼åˆ™ç›¸åï¼Œæ¯æ¬¡å–ç©ºé—²è¿æ¥ä¼šä»"é˜Ÿå¤´"å–ï¼Œç›¸æ¯”è¾ƒäº LIFO æ¨¡å¼ï¼Œ
    // ä¼šä½¿æ•´ä¸ªè¿æ¥æ± çš„è¿æ¥ä½¿ç”¨æ›´åŠ å¹³å‡ï¼Œæœ‰ç‚¹ç±»ä¼¼äºè´Ÿè½½å‡è¡¡å¯»è½®æ¨¡å¼ï¼Œä¼šå¾ªç¯çš„ä½¿ç”¨
    // è¿æ¥æ± çš„æ‰€æœ‰è¿æ¥ï¼Œå¦‚æœä½ ä½¿ç”¨ go-redis å½“åšä»£ç†è®©åç«¯ redis èŠ‚ç‚¹è´Ÿè½½æ›´å¹³å‡çš„è¯ï¼Œ
    // FIFO æ¨¡å¼å¯¹ä½ å¾ˆæœ‰ç”¨ã€‚
    // å¦‚æœä½ ä¸ç¡®å®šä½¿ç”¨ä»€ä¹ˆæ¨¡å¼ï¼Œè¯·ä¿æŒé»˜è®¤ PoolFIFO = false
    PoolFIFO bool

    // è¿æ¥æ± æœ€å¤§è¿æ¥æ•°é‡ï¼Œæ³¨æ„ï¼šè¿™é‡Œä¸åŒ…æ‹¬ pub/subï¼Œpub/sub å°†ä½¿ç”¨ç‹¬ç«‹çš„ç½‘ç»œè¿æ¥
    // é»˜è®¤ä¸º 10 * runtime.GOMAXPROCS
    PoolSize int
 
    // PoolTimeout ä»£è¡¨å¦‚æœè¿æ¥æ± æ‰€æœ‰è¿æ¥éƒ½åœ¨ä½¿ç”¨ä¸­ï¼Œç­‰å¾…è·å–è¿æ¥æ—¶é—´ï¼Œè¶…æ—¶å°†è¿”å›é”™è¯¯
    // é»˜è®¤æ˜¯ 1ç§’+ReadTimeout
    PoolTimeout time.Duration
 
    // è¿æ¥æ± ä¿æŒçš„æœ€å°ç©ºé—²è¿æ¥æ•°ï¼Œå®ƒå—åˆ°PoolSizeçš„é™åˆ¶
    // é»˜è®¤ä¸º0ï¼Œä¸ä¿æŒ
    MinIdleConns int
 
    // è¿æ¥æ± ä¿æŒçš„æœ€å¤§ç©ºé—²è¿æ¥æ•°ï¼Œå¤šä½™çš„ç©ºé—²è¿æ¥å°†è¢«å…³é—­
    // é»˜è®¤ä¸º0ï¼Œä¸é™åˆ¶
    MaxIdleConns int

    // ConnMaxIdleTime æ˜¯æœ€å¤§ç©ºé—²æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°†è¢«å…³é—­ã€‚
    // å¦‚æœ ConnMaxIdleTime <= 0ï¼Œåˆ™è¿æ¥ä¸ä¼šå› ä¸ºç©ºé—²è€Œè¢«å…³é—­ã€‚
    // é»˜è®¤å€¼æ˜¯30åˆ†é’Ÿï¼Œ-1ç¦ç”¨
    ConnMaxIdleTime time.Duration

    // ConnMaxLifetime æ˜¯ä¸€ä¸ªè¿æ¥çš„ç”Ÿå­˜æ—¶é—´ï¼Œ
    // å’Œ ConnMaxIdleTime ä¸åŒï¼ŒConnMaxLifetime è¡¨ç¤ºè¿æ¥æœ€å¤§çš„å­˜æ´»æ—¶é—´
    // å¦‚æœ ConnMaxLifetime <= 0ï¼Œåˆ™è¿æ¥ä¸ä¼šæœ‰ä½¿ç”¨æ—¶é—´é™åˆ¶
    // é»˜è®¤å€¼ä¸º0ï¼Œä»£è¡¨è¿æ¥æ²¡æœ‰æ—¶é—´é™åˆ¶
    ConnMaxLifetime time.Duration
    
    // å¦‚æœä½ çš„redisæœåŠ¡å™¨éœ€è¦TLSè®¿é—®ï¼Œå¯ä»¥åœ¨è¿™é‡Œé…ç½®TLSè¯ä¹¦ç­‰ä¿¡æ¯
    // å¦‚æœé…ç½®äº†è¯ä¹¦ä¿¡æ¯ï¼Œgo-rediså°†ä½¿ç”¨TLSå‘èµ·è¿æ¥ï¼Œ
    // å¦‚æœä½ è‡ªå®šä¹‰äº† `Dialer` æ–¹æ³•ï¼Œä½ éœ€è¦è‡ªå·±å®ç°ç½‘ç»œè¿æ¥
    TLSConfig *tls.Config
    
    // é™æµå™¨çš„é…ç½®ï¼Œå‚ç…§ `Limiter` æ¥å£
    Limiter Limiter
    
    // è®¾ç½®å¯ç”¨åœ¨å‰¯æœ¬èŠ‚ç‚¹åªè¯»æŸ¥è¯¢ï¼Œé»˜è®¤ä¸ºfalseä¸å¯ç”¨
    // å‚ç…§ï¼šhttps://redis.io/commands/readonly
    readOnly bool
}
```

## è·å– Redis å€¼ GET Key

```go
package main

import (
 "context"
 "fmt"
 "github.com/redis/go-redis/v9"
 "time"
)

// å£°æ˜ä¸€ä¸ªå…¨å±€çš„ rdb å˜é‡
var rdb *redis.Client

// åˆå§‹åŒ–è¿æ¥
func initRedisClient() (err error) {
 // NewClientå°†å®¢æˆ·ç«¯è¿”å›ç»™OptionsæŒ‡å®šçš„Redis Serverã€‚
 // Optionsä¿ç•™è®¾ç½®ä»¥å»ºç«‹redisè¿æ¥ã€‚
 rdb = redis.NewClient(&redis.Options{
  Addr:     "localhost:6379",
  Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
  DB:       0,  // é»˜è®¤DB 0 è¿æ¥åˆ°æœåŠ¡å™¨åè¦é€‰æ‹©çš„æ•°æ®åº“ã€‚
  PoolSize: 20, // æœ€å¤§å¥—æ¥å­—è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå¯ç”¨CPUæœ‰10ä¸ªè¿æ¥ï¼Œç”±runtime.GOMAXPROCSæŠ¥å‘Šã€‚
 })

 // Backgroundè¿”å›ä¸€ä¸ªéç©ºçš„Contextã€‚å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚
 // å®ƒé€šå¸¸ç”±mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡
 ctx := context.Background()

 _, err = rdb.Ping(ctx).Result()
 if err != nil {
  return err
 }
 return nil
}


func redisGetKey(key string) (string, error) {
 ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)
 defer cancel()

 val, err := rdb.Get(ctx, key).Result()
 if err != nil {
  if err == redis.Nil {
   return "", nil
   // DeadlineExceededæ˜¯Contextè¿”å›çš„é”™è¯¯ã€‚å½“ä¸Šä¸‹æ–‡çš„æˆªæ­¢æ—¥æœŸè¿‡å»æ—¶å‘ç”Ÿé”™è¯¯ã€‚
  } else if err == context.DeadlineExceeded {
   return "", fmt.Errorf("è·å–å€¼è¶…æ—¶")
  } else {
   return "", fmt.Errorf("è·å–å€¼å¤±è´¥: %v", err)
  }
 }

 if val == "" {
  return "", nil
 }

 return val, nil
}

func main() {
 if err := initRedisClient(); err != nil {
  fmt.Printf("initRedisClient failed: %v\n", err)
  return
 }
 fmt.Println("initRedisClient started successfully")
 defer rdb.Close() // Close å…³é—­å®¢æˆ·ç«¯ï¼Œé‡Šæ”¾æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚å…³é—­å®¢æˆ·ç«¯æ˜¯å¾ˆå°‘è§çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶åœ¨è®¸å¤šä¾‹ç¨‹ä¹‹é—´å…±äº«ã€‚

 //redisCommand()

 // get key
 value, _ := redisGetKey("key")
 fmt.Printf("get key: %v\n", value)
}

```

è¿è¡Œ

```bash
Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ go run main.go
initRedisClient started successfully
get key: 10

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ 
```

## è®¾ç½®å€¼ SET

```go
package main

import (
 "context"
 "fmt"
 "github.com/redis/go-redis/v9"
 "time"
)

// å£°æ˜ä¸€ä¸ªå…¨å±€çš„ rdb å˜é‡
var rdb *redis.Client

// åˆå§‹åŒ–è¿æ¥
func initRedisClient() (err error) {
 // NewClientå°†å®¢æˆ·ç«¯è¿”å›ç»™OptionsæŒ‡å®šçš„Redis Serverã€‚
 // Optionsä¿ç•™è®¾ç½®ä»¥å»ºç«‹redisè¿æ¥ã€‚
 rdb = redis.NewClient(&redis.Options{
  Addr:     "localhost:6379",
  Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
  DB:       0,  // é»˜è®¤DB 0 è¿æ¥åˆ°æœåŠ¡å™¨åè¦é€‰æ‹©çš„æ•°æ®åº“ã€‚
  PoolSize: 20, // æœ€å¤§å¥—æ¥å­—è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå¯ç”¨CPUæœ‰10ä¸ªè¿æ¥ï¼Œç”±runtime.GOMAXPROCSæŠ¥å‘Šã€‚
 })

 // Backgroundè¿”å›ä¸€ä¸ªéç©ºçš„Contextã€‚å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚
 // å®ƒé€šå¸¸ç”±mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡
 ctx := context.Background()

 _, err = rdb.Ping(ctx).Result()
 if err != nil {
  return err
 }
 return nil
}


func redisSetKey(key string, val string) error {
 ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)
 defer cancel()

 // è®¾ç½®Redis ' Set key value [expiration] 'å‘½ä»¤ã€‚
 err := rdb.Set(ctx, key, val, time.Hour).Err()
 if err != nil {
  fmt.Printf("redis set failed, err: %v\n", err)
  return err
 }
 return nil

}

func main() {
 if err := initRedisClient(); err != nil {
  fmt.Printf("initRedisClient failed: %v\n", err)
  return
 }
 fmt.Println("initRedisClient started successfully")
 defer rdb.Close() // Close å…³é—­å®¢æˆ·ç«¯ï¼Œé‡Šæ”¾æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚å…³é—­å®¢æˆ·ç«¯æ˜¯å¾ˆå°‘è§çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶åœ¨è®¸å¤šä¾‹ç¨‹ä¹‹é—´å…±äº«ã€‚

 // set value
 err := redisSetKey("name", "xia")
 if err != nil {
  fmt.Printf("redisSetKey failed: %v\n", err)
  return
 }
 fmt.Println("redisSetKey succeeded")
}

```

è¿è¡Œ

```bash
Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ go run main.go
initRedisClient started successfully
redisSetKey succeeded
```

## HGetAll HSET

```bash
127.0.0.1:6379> hset user name "lixia"
(integer) 1
127.0.0.1:6379> hgetall user
1) "name"
2) "lixia"
127.0.0.1:6379> hset user age 14
(integer) 1
127.0.0.1:6379> hgetall user
1) "name"
2) "lixia"
3) "age"
4) "14"
127.0.0.1:6379>

```

main.go

```go
package main

import (
 "context"
 "fmt"
 "github.com/redis/go-redis/v9"
 "time"
)

// å£°æ˜ä¸€ä¸ªå…¨å±€çš„ rdb å˜é‡
var rdb *redis.Client

// åˆå§‹åŒ–è¿æ¥
func initRedisClient() (err error) {
 // NewClientå°†å®¢æˆ·ç«¯è¿”å›ç»™OptionsæŒ‡å®šçš„Redis Serverã€‚
 // Optionsä¿ç•™è®¾ç½®ä»¥å»ºç«‹redisè¿æ¥ã€‚
 rdb = redis.NewClient(&redis.Options{
  Addr:     "localhost:6379",
  Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
  DB:       0,  // é»˜è®¤DB 0 è¿æ¥åˆ°æœåŠ¡å™¨åè¦é€‰æ‹©çš„æ•°æ®åº“ã€‚
  PoolSize: 20, // æœ€å¤§å¥—æ¥å­—è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå¯ç”¨CPUæœ‰10ä¸ªè¿æ¥ï¼Œç”±runtime.GOMAXPROCSæŠ¥å‘Šã€‚
 })

 // Backgroundè¿”å›ä¸€ä¸ªéç©ºçš„Contextã€‚å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚
 // å®ƒé€šå¸¸ç”±mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡
 ctx := context.Background()

 _, err = rdb.Ping(ctx).Result()
 if err != nil {
  return err
 }
 return nil
}


func hGetDemo(key string) (map[string]string, error) {
 ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)
 defer cancel()

 val, err := rdb.HGetAll(ctx, key).Result()
 if err != nil {
  // redis.Nil
  // å…¶å®ƒé”™è¯¯
  fmt.Printf("hgetall failed, err: %v\n", err)
  return nil, err
 }
 return val, nil
}

func main() {
 if err := initRedisClient(); err != nil {
  fmt.Printf("initRedisClient failed: %v\n", err)
  return
 }
 fmt.Println("initRedisClient started successfully")
 defer rdb.Close() // Close å…³é—­å®¢æˆ·ç«¯ï¼Œé‡Šæ”¾æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚å…³é—­å®¢æˆ·ç«¯æ˜¯å¾ˆå°‘è§çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶åœ¨è®¸å¤šä¾‹ç¨‹ä¹‹é—´å…±äº«ã€‚

 // hgetall()
 value, err := hGetDemo("user")
 if err != nil {
  fmt.Printf("hGetDem failed with error: %v\n", err)
  return
 }
 fmt.Printf("hgetall successful, value: %v\n", value)
}

```

è¿è¡Œ

```bash
Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base took 3.8s 
âœ go run main.go 
initRedisClient started successfully
hgetall successful, value: map[age:14 name:lixia]

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ 
```

### HMGet HGet

```go
package main

import (
 "context"
 "fmt"
 "github.com/redis/go-redis/v9"
 "time"
)

// å£°æ˜ä¸€ä¸ªå…¨å±€çš„ rdb å˜é‡
var rdb *redis.Client

// åˆå§‹åŒ–è¿æ¥
func initRedisClient() (err error) {
 // NewClientå°†å®¢æˆ·ç«¯è¿”å›ç»™OptionsæŒ‡å®šçš„Redis Serverã€‚
 // Optionsä¿ç•™è®¾ç½®ä»¥å»ºç«‹redisè¿æ¥ã€‚
 rdb = redis.NewClient(&redis.Options{
  Addr:     "localhost:6379",
  Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
  DB:       0,  // é»˜è®¤DB 0 è¿æ¥åˆ°æœåŠ¡å™¨åè¦é€‰æ‹©çš„æ•°æ®åº“ã€‚
  PoolSize: 20, // æœ€å¤§å¥—æ¥å­—è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå¯ç”¨CPUæœ‰10ä¸ªè¿æ¥ï¼Œç”±runtime.GOMAXPROCSæŠ¥å‘Šã€‚
 })

 // Backgroundè¿”å›ä¸€ä¸ªéç©ºçš„Contextã€‚å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚
 // å®ƒé€šå¸¸ç”±mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡
 ctx := context.Background()

 _, err = rdb.Ping(ctx).Result()
 if err != nil {
  return err
 }
 return nil
}


func hMGetDemo() {
 ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)
 defer cancel()

 val := rdb.HMGet(ctx, "user", "name", "age").Val()
 fmt.Printf("redis HMGet %v\n", val)

 value := rdb.HGet(ctx, "user", "age").Val()
 fmt.Printf("redis HGet value: %v\n", value)
}

func main() {
 if err := initRedisClient(); err != nil {
  fmt.Printf("initRedisClient failed: %v\n", err)
  return
 }
 fmt.Println("initRedisClient started successfully")
 defer rdb.Close() // Close å…³é—­å®¢æˆ·ç«¯ï¼Œé‡Šæ”¾æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚å…³é—­å®¢æˆ·ç«¯æ˜¯å¾ˆå°‘è§çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶åœ¨è®¸å¤šä¾‹ç¨‹ä¹‹é—´å…±äº«ã€‚

 hMGetDemo()
}

```

è¿è¡Œ

```bash
Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ go run main.go 
initRedisClient started successfully
redis HMGet [lixia 14]
redis HGet value: 14

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ 
```

## ZSET ä½¿ç”¨

```go
package main

import (
 "context"
 "fmt"
 "github.com/redis/go-redis/v9"
 "time"
)

// å£°æ˜ä¸€ä¸ªå…¨å±€çš„ rdb å˜é‡
var rdb *redis.Client

// åˆå§‹åŒ–è¿æ¥
func initRedisClient() (err error) {
 // NewClientå°†å®¢æˆ·ç«¯è¿”å›ç»™OptionsæŒ‡å®šçš„Redis Serverã€‚
 // Optionsä¿ç•™è®¾ç½®ä»¥å»ºç«‹redisè¿æ¥ã€‚
 rdb = redis.NewClient(&redis.Options{
  Addr:     "localhost:6379",
  Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
  DB:       0,  // é»˜è®¤DB 0 è¿æ¥åˆ°æœåŠ¡å™¨åè¦é€‰æ‹©çš„æ•°æ®åº“ã€‚
  PoolSize: 20, // æœ€å¤§å¥—æ¥å­—è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå¯ç”¨CPUæœ‰10ä¸ªè¿æ¥ï¼Œç”±runtime.GOMAXPROCSæŠ¥å‘Šã€‚
 })

 // Backgroundè¿”å›ä¸€ä¸ªéç©ºçš„Contextã€‚å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚
 // å®ƒé€šå¸¸ç”±mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡
 ctx := context.Background()

 _, err = rdb.Ping(ctx).Result()
 if err != nil {
  return err
 }
 return nil
}


// zset Demo æ“ä½œ zset ç¤ºä¾‹
func zSetDemo() {
 // key
 zSetKey := "language_rank"
 // value Zè¡¨ç¤ºæœ‰åºé›†åˆçš„æˆå‘˜ã€‚
 languages := []redis.Z{
  {Score: 90.0, Member: "Golang"},
  {Score: 95.0, Member: "Python"},
  {Score: 97.0, Member: "Rust"},
  {Score: 99.0, Member: "C/C++"},
  {Score: 88.0, Member: "Java"},
 }
 // WithTimeoutè¿”å›WithDeadline(parent, time.Now(). add (timeout))ã€‚
 ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)
 defer cancel()

 // ZAdd Redis `ZADD key score member [score member ...]` command.
 num, err := rdb.ZAdd(ctx, zSetKey, languages...).Result()
 if err != nil {
  fmt.Printf("zadd failed, err:%v\n", err)
  return
 }
 fmt.Printf("zadd successful num: %v\n", num)

 // ZIncrBy ç»™æŸä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ†æ•°å€¼ æŠŠGolangçš„åˆ†æ•°åŠ  10
 newScore, err := rdb.ZIncrBy(ctx, zSetKey, 10.0, "Golang").Result()
 if err != nil {
  fmt.Printf("ZIncrBy failed, err:%v\n", err)
  return
 }
 fmt.Printf("ZIncrBy success Golang's score is %f now.\n", newScore)

 // å–åˆ†æ•°æœ€é«˜çš„3ä¸ª  é€‚ç”¨äº æ’è¡Œæ¦œã€å……å€¼æ¦œ...
 // ZRevRangeWithScores according to the Redis documentation, if member does not exist
 // in the sorted set or key does not exist, it will return a redis.Nil error.
 ret, err := rdb.ZRevRangeWithScores(ctx, zSetKey, 0, 2).Result()
 if err != nil {
  fmt.Printf("zRevRangeWithScores failed, err: %v\n", err)
  return
 }
 for _, z := range ret {
  fmt.Printf("z.Member: %v, z.Score: %v\n", z.Member, z.Score)
 }

 // å–95~100åˆ†çš„
 op := &redis.ZRangeBy{
  Min: "95",
  Max: "100",
 }
 ret, err = rdb.ZRangeByScoreWithScores(ctx, zSetKey, op).Result()
 if err != nil {
  fmt.Printf("zrangebyscore failed, err:%v\n", err)
  return
 }
 fmt.Printf("zrangebyscore returned %v\n", ret)
 for _, z := range ret {
  fmt.Printf("ZRangeByScoreWithScores success Member: %v, Score: %v\n", z.Member, z.Score)
 }
}

func main() {
 if err := initRedisClient(); err != nil {
  fmt.Printf("initRedisClient failed: %v\n", err)
  return
 }
 fmt.Println("initRedisClient started successfully")
 defer rdb.Close() // Close å…³é—­å®¢æˆ·ç«¯ï¼Œé‡Šæ”¾æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚å…³é—­å®¢æˆ·ç«¯æ˜¯å¾ˆå°‘è§çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶åœ¨è®¸å¤šä¾‹ç¨‹ä¹‹é—´å…±äº«ã€‚

 zSetDemo()
}

```

è¿è¡Œ

```bash
Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ go run main.go
initRedisClient started successfully
zadd successful num: 5
ZIncrBy success Golang's score is 100.000000 now.
z.Member: Golang, z.Score: 100
z.Member: C/C++, z.Score: 99
z.Member: Rust, z.Score: 97
zrangebyscore returned [{95 Python} {97 Rust} {99 C/C++} {100 Golang}]
ZRangeByScoreWithScores success Member: Python, Score: 95
ZRangeByScoreWithScores success Member: Rust, Score: 97
ZRangeByScoreWithScores success Member: C/C++, Score: 99
ZRangeByScoreWithScores success Member: Golang, Score: 100

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ 
```

### Redis æŸ¥è¯¢

```bash
127.0.0.1:6379> ZREVRANGE language_rank 0 2
1) "Golang"
2) "C/C++"
3) "Rust"
127.0.0.1:6379> ZREVRANGE language_rank 0 2 withscores
1) "Golang"
2) "100"
3) "C/C++"
4) "99"
5) "Rust"
6) "97"
127.0.0.1:6379> ZRANDMEMBER language_rank
"Rust"
127.0.0.1:6379> ZRANGE language_rank 0 2
1) "Java"
2) "Python"
3) "Rust"
127.0.0.1:6379> ZRANGE language_rank 0 2 withscores
1) "Java"
2) "88"
3) "Python"
4) "95"
5) "Rust"
6) "97"
127.0.0.1:6379> ZINCRBY language_rank 1 "Python"
"96"
127.0.0.1:6379> ZRANGE language_rank 0 2 withscores
1) "Java"
2) "88"
3) "Python"
4) "96"
5) "Rust"
6) "97"
127.0.0.1:6379>
```

## Scan æ ¹æ®å‰ç¼€æŸ¥è¯¢ Key

```go
package main

import (
 "context"
 "fmt"
 "github.com/redis/go-redis/v9"
 "time"
)

// å£°æ˜ä¸€ä¸ªå…¨å±€çš„ rdb å˜é‡
var rdb *redis.Client

// åˆå§‹åŒ–è¿æ¥
func initRedisClient() (err error) {
 // NewClientå°†å®¢æˆ·ç«¯è¿”å›ç»™OptionsæŒ‡å®šçš„Redis Serverã€‚
 // Optionsä¿ç•™è®¾ç½®ä»¥å»ºç«‹redisè¿æ¥ã€‚
 rdb = redis.NewClient(&redis.Options{
  Addr:     "localhost:6379",
  Password: "", // æ²¡æœ‰å¯†ç ï¼Œé»˜è®¤å€¼
  DB:       0,  // é»˜è®¤DB 0 è¿æ¥åˆ°æœåŠ¡å™¨åè¦é€‰æ‹©çš„æ•°æ®åº“ã€‚
  PoolSize: 20, // æœ€å¤§å¥—æ¥å­—è¿æ¥æ•°ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå¯ç”¨CPUæœ‰10ä¸ªè¿æ¥ï¼Œç”±runtime.GOMAXPROCSæŠ¥å‘Šã€‚
 })

 // Backgroundè¿”å›ä¸€ä¸ªéç©ºçš„Contextã€‚å®ƒæ°¸è¿œä¸ä¼šè¢«å–æ¶ˆï¼Œæ²¡æœ‰å€¼ï¼Œä¹Ÿæ²¡æœ‰æˆªæ­¢æ—¥æœŸã€‚
 // å®ƒé€šå¸¸ç”±mainå‡½æ•°ã€åˆå§‹åŒ–å’Œæµ‹è¯•ä½¿ç”¨ï¼Œå¹¶ä½œä¸ºä¼ å…¥è¯·æ±‚çš„é¡¶çº§ä¸Šä¸‹æ–‡
 ctx := context.Background()

 _, err = rdb.Ping(ctx).Result()
 if err != nil {
  return err
 }
 return nil
}

func scanKeyDemo(match string) {
 // WithTimeoutè¿”å›WithDeadline(parent, time.Now(). add (timeout))ã€‚
 ctx, cancel := context.WithTimeout(context.Background(), 500*time.Millisecond)
 defer cancel()
 // æ ¹æ®å‰ç¼€æŸ¥è¯¢ Key
 iter := rdb.Scan(ctx, 0, match, 0).Iterator()

 for iter.Next(ctx) {
  fmt.Printf("key value: %v\n", iter.Val())
 }

 if err := iter.Err(); err != nil {
  fmt.Printf("rdb scan failed, err: %v\n", err)
  return
 }
}

func main() {
 if err := initRedisClient(); err != nil {
  fmt.Printf("initRedisClient failed: %v\n", err)
  return
 }
 fmt.Println("initRedisClient started successfully")
 defer rdb.Close() // Close å…³é—­å®¢æˆ·ç«¯ï¼Œé‡Šæ”¾æ‰€æœ‰æ‰“å¼€çš„èµ„æºã€‚å…³é—­å®¢æˆ·ç«¯æ˜¯å¾ˆå°‘è§çš„ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ˜¯é•¿æœŸå­˜åœ¨çš„ï¼Œå¹¶åœ¨è®¸å¤šä¾‹ç¨‹ä¹‹é—´å…±äº«ã€‚

 scanKeyDemo("l*")
}

```

è¿è¡Œ

```bash

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ go run main.go
initRedisClient started successfully
key value: language_rank

Code/go/redis_demo via ğŸ¹ v1.20.3 via ğŸ…’ base 
âœ 
```
